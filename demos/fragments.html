<!doctype html>
<html>
<head>
	<title>fragments</title>
	<script src="../dist/nano/domvm.nano.js"></script>
	<script src="../test/dominstr.js"></script>
</head>
<body>
	<style>
		a {
			display: block;
		}
	</style>

	<script>
		var instr = new DOMInstr();

		var el = domvm.defineElement,
			vw = domvm.defineView,
			fr = domvm.defineFragment;

		var reverse = false;
		var reverse2 = false;

		function frBody() {
			return [
				el("em", "big"),
				el("span", "cruel"),
			];
		}

		function View() {
			return function() {
				return (
					el("div", [
					//	el("strong", "hello"),
						fr(reverse ? frBody().reverse() : frBody()),
						// adjacent fragment
						fr(reverse ? frBody().reverse() : frBody()),
						// nested fragments
						fr([				// fr(type, attrs, body)
							fr([
								el("div", 1),
								el("div", 2),
							]),
							fr([
								el("div", 3),
								el("div", 4),
							]),
							fr([
								vw(View2)
							]),
						]),
						el("i", "world"),
						fr([
							el("div", "test"),
							reverse ? el("div", "hahahaha") : null
						])
					])
				);
			};
		}

		var i = 0;

		function View2() {
			return function() {
				return el("#foo", [
					vw(View3),
					el("#incr", i++),
				]);
			}
		}

		function View3() {
			return () =>
				fr([
					el("#bar", "bar" + i++),
					el("#baz", "baz" + i++),
					vw(View4),
					vw(View4),
				])
		}

		function View4(vm) {
			function reverse2AndRedraw() {
				reverse2 = !reverse2;
				vm.redraw();
			};

			return () =>
				reverse2
				? fr([
					el("a#moo", {href: "#", onclick: reverse2AndRedraw}, "moo" + i++),
					el("#cow", "cow" + i++)
				])
				: fr([
					el("#cow", "cow" + i++),
					el("a#moo", {href: "#", onclick: reverse2AndRedraw}, "moo" + i++),
				])
		}

		var vm = domvm.createView(View).mount(document.body);
	//	var vm = domvm.createView(View2).mount(document.body);

		setTimeout(function() {
			instr.start();
			reverse = true;
		//	frBody.push(el("span", "moo"));
		//	frBody.pop();
			vm.redraw(true);
			var callCounts = instr.end();
			console.log(callCounts);
		}, 1000)
	</script>
</body>
</html>