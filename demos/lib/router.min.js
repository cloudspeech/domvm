function createRouter(k){function w(a){p.href=a;""==p.host&&(p.href=p.href);var b={};G.forEach(function(a){b[a]=p[a]});return b}function H(a){var b=encodeURIComponent,c=Object.keys(a).map(function(c){return b(c)+"="+b(a[c])}).join("&");return c.length?"?"+c:""}function q(a){a=w(a);if(m){var b=a.hash;a=w(a.protocol+"//"+a.hostname+"/"+a.hash.substr(n.length))}var b=m?b||n:a.pathname+a.search+a.hash,c=m?a.pathname.substr(1):a.pathname.substr(n.length),f;if(""!=a.search){f={};for(var d=a.search.substr(1).split("&"),
e=0;e<d.length;e++){var g=d[e].split("=");f[decodeURIComponent(g[0])]=decodeURIComponent(g[1]||"")}}else f=null;return{href:b,path:c,query:f,hash:a.hash}}function r(a){if(null!=a.route)return a;for(var b,c,f,d=0;d<h.length;d++){c=h[d];var e=c.path;if(b=a.path.match(c.regexPath)){a.route=c;-1!==e.indexOf(":")&&(f={},b.shift(),e.replace(/:([^\/]+)/g,function(a,c){f[c]=b.shift()}));a.segs=f;break}}return a}function x(a){if(null==a)return r(q(location.href));for(var b=0;b<h.length;b++)if(h[b].name==a)return h[b]}
function t(a,b,c){r(a);if(null==a.route)if(y)y(a);else throw"Could not find route: "+a.href;else{for(var f=null,d=0;d<l.length;d++)if(l[d].href===a.href){f=d;break}null===f&&(l.splice(u+1,1E4),l.push(a),f=l.length-1);d=l[u];a=l[f];var e=!0,g=!0;null!==u&&(z&&(e=c||z(d,a)),!1!==e&&(e=(e=d.route.onexit)?c||e.apply(null,(d?[d.segs,d.query,d.hash]:[]).concat(a)):!0,A&&A(d,a)));!1!==e&&(B&&(g=c||B(a,d)),!1!==g&&(g=a.route.onenter,g=c||g.apply(null,(a?[a.segs,a.query,a.hash]:[]).concat(d)),C&&C(a,d)),!1!==
g&&(m?(c=a.href,location.hash!==c&&(v=!0,b?location.replace(c):location.hash=c)):(v=!0,history[b?"replaceState":"pushState"](null,"title",a.href)),b=a.route.title,null!=b&&(document.title="function"==typeof b?b(a.segs,a.query,a.hash):b),u=f))}}function D(a,b,c,f,d){var e={route:a,segs:b||{},query:c||{},hash:f||"",repl:d||!1,href:"",path:"",toString:function(){return e.href}},g=a.path,h=a.vars||{};-1!==g.indexOf(":")&&(e.path=g.replace(/:([^\/]+)/g,function(a,b){var c=null==e.segs[b]?"":e.segs[b];
if((h[b]||/^[^\/]+$/).test(c))return c+"";throw Error("Invalid value for route '"+g+"' segment '"+b+"': '"+e.segs[b]+"'");}));e.href=n+e.path+H(e.query)+e.hash;return e}function E(a){null==a.regexPath&&(a.regexPath=new RegExp("^"+a.path.replace(/:([^\/]+)/g,function(b,c){var f=""+((a.vars||{})[c]||/[^\/]+/);return"("+f.substring(1,f.lastIndexOf("/"))+")"})+"$"))}function I(a){m&&"popstate"==a.type||(m&&v?v=!1:t(r(q(location.href)),!0))}var l=[],u=null,h=k.routes||[],B=k.willEnter,z=k.willExit,C=k.didEnter,
A=k.didExit,y=k.notFound,n=k.prefix||"#/",m="#"==n[0],v=!1,p=document.createElement("a"),G="href protocol username password origin hostname host port pathname search hash".split(" "),F={boot:function(a){h.forEach(E);try{t(r(q(location.href)),!0)}catch(f){if(a){a=!1;for(var b=0;b<h.length;b++){var c=h[b].path;if(""==c||"/"==c){t(q(n+c),!0);a=!0;break}}if(!a)throw"No root route found";}else throw f;}window.onhashchange=window.onpopstate=I},add:function(a,b){h.splice(b,0,a);E(a);return F},get:x,set:t,
build:D,href:function(a,b,c,f,d){return D(x(a),b,c,f,d)}};return F};