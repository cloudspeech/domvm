<html>
<head>
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="body">
	<button onclick="redraw()">GO</button>
	<button onclick="step()">Step</button>
	<div id="body2"></div>
</div>

<script src="junkola-copied-from-ember.js"></script>
<script src="../../../src/domvm.js"></script>
<script src="../../../test/lib/dominstr.js"></script>

<script>
	var ROWS = 100;
	var TIMEOUT = 0;

	domvm.useRaf = false;

 	var dbs = getDatabases();

	function Table() {
		return {
			render: function() {
				return ["table", {"class": "table table-striped latest-data"}, [
					["tbody", dbs.map(function(db) {
						var top5 = db.topFiveQueries.map(function(q) {
							return ["td", {"class": "Query " + q.className}, [
								q.elapsed,
								["div", {"class": "popover left"}, [
									["div", {"class": "popover-content"}, q.query],
									["div", {"class": "arrow"}]
								]],
							]];
						});

						return ["tr", [
							["td", {"class": "dbname"}, db.name],
							["td", {"class": "query-count"}, [
								["span", {"class": db.countClassName}, db.queries.length]
							]]
						].concat(top5)];
					})]
				]];
			}
		};
	}

	var vw = domvm(Table).mount(document.getElementById("body2"));

/*  isomorphic test
	var vw = domvm(Table);
	var html = vw.html();
	var body2 = document.getElementById("body2");
	body2.innerHTML = html;
	vw.attach(body2.firstChild);
*/
	var instr = new DOMInstr(true);

	function step() {
		dbs = getDatabases();
		instr.start();
		vw.redraw();
		console.log(instr.end());
	}

	function redraw() {
		dbs = getDatabases();
		vw.redraw();
		setTimeout(redraw, TIMEOUT);
	}

//	redraw();
</script>

</body>
</html>