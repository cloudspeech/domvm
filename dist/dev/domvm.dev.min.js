// https://github.com/leeoniya/domvm (3.x-dev, dev build)
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.domvm=t()}(this,function(){"use strict";var e=1,t=2,n=3,l=4,r=5,o="undefined"!=typeof window,i=o?window:{},a=o?document:{},u=i.requestAnimationFrame,s={};function d(){}var f=Array.isArray;function c(e){return null!=e&&e.constructor===Object}function v(e){return"function"==typeof e}function h(e){for(var t=arguments,n=1;n<t.length;n++)for(var l in t[n])e[l]=t[n][l];return e}function y(e,t){for(var n=[],l=t;l<e.length;l++)n.push(e[l]);return n}function p(e,t){for(var n in e)if(e[n]!==t[n])return!1;return!0}function m(e,t){var n=e.length;if(t.length!==n)return!1;for(var l=0;l<n;l++)if(e[l]!==t[l])return!1;return!0}function g(e){if(!u)return e;var t,n,l;function r(){t=0,e.apply(n,l)}return function(){n=this,l=arguments,t||(t=u(r))}}function b(e){return"o"===e[0]&&"n"===e[1]}function _(e){return"_"===e[0]}function w(e){return"style"===e}function k(e){e&&e.el&&e.el.offsetHeight}function E(e){return null!=e.node&&null!=e.node.el}function x(e,t){switch(t){case"value":case"checked":case"selected":return!0}return!1}function A(e){for(e=e||s;null==e.vm&&e.parent;)e=e.parent;return e.vm}function T(){}var N=T.prototype={constructor:T,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,_dead:!1,_lis:!1,idx:null,parent:null};function D(e){var n=new T;return n.type=t,n.body=e,n}var R=function(){return!1},C=d,S=d,M=d;function L(e,t){var n=S(e,function(e){n&&(null!=t.node&&t.redraw(),M(n))});return C(e)}function I(e,t){var n=S(e,function(e){n&&null!=t.node&&t.redraw()});return n}var O={},H=/\[(\w+)(?:=(\w+))?\]/g;var Y={warnings:!0,verbose:!0,mutations:!0,DATA_REPLACED:function(e,t,n){if(v(e.view)&&e.view.length>1){return["A view's data was replaced. The data originally passed to the view closure during init is now stale. You may want to rely only on the data passed to render() or vm.data.",e,t,n]}},UNKEYED_INPUT:function(e){return["Unkeyed <input> detected. Consider adding a name, id, _key, or _ref attr to avoid accidental DOM recycling between different <input> types.",e]},UNMOUNTED_REDRAW:function(e){return["Invoking redraw() of an unmounted (sub)view may result in errors.",e]},INLINE_HANDLER:function(e,t,n){return["Anonymous event handlers get re-bound on each redraw, consider defining them outside of templates for better reuse.",e,t,n]},MISMATCHED_HANDLER:function(e,t,n){return["Patching of different event handler styles is not fully supported for performance reasons. Ensure that handlers are defined using the same style.",e,t,n]},SVG_WRONG_FACTORY:function(e){return["<svg> defined using domvm.defineElement. Use domvm.defineSvgElement for <svg> & child nodes.",e]},FOREIGN_ELEMENT:function(e){return["domvm stumbled upon an element in its DOM that it didn't create, which may be problematic. You can inject external elements into the vtree using domvm.injectElement.",e]},REUSED_ATTRS:function(e){return["Attrs objects may only be reused if they are truly static, as a perf optimization. Mutating & reusing them will have no effect on the DOM due to 0 diff.",e]},ADJACENT_TEXT:function(e,t,n){return["Adjacent text nodes will be merged. Consider concatentating them yourself in the template for improved perf.",e,t,n]},ARRAY_FLATTENED:function(e,t){return["Arrays within templates will be flattened. When they are leading or trailing, it's easy and more performant to just .concat() them in the template.",e,t]},ALREADY_HYDRATED:function(e){return["A child view failed to mount because it was already hydrated. Make sure not to invoke vm.redraw() or vm.update() on unmounted views.",e]},ATTACH_IMPLICIT_TBODY:function(e,t){return["<table><tr> was detected in the vtree, but the DOM will be <table><tbody><tr> after HTML's implicit parsing. You should create the <tbody> vnode explicitly to avoid SSR/attach() failures.",e,t]}};function U(e,t){if(Y.warnings&&v(Y[e])){var n=Y[e].apply(null,t);n&&(n[0]=e+": "+(Y.verbose?n[0]:""),console.warn.apply(console,n))}}var V=1,j=2,F=4,P=8;function G(t,n,l,r){var o=new T;o.type=e,o.flags=r||0,o.attrs=n||null;var i=function(e){var t=O[e];if(null==t){var n,l,r,o;for(O[e]=t={tag:(n=e.match(/^[-\w]+/))?n[0]:"div",id:(l=e.match(/#([-\w]+)/))?l[1]:null,class:(r=e.match(/\.([-\w.]+)/))?r[1].replace(/\./g," "):null,attrs:null};o=H.exec(e);)null==t.attrs&&(t.attrs={}),t.attrs[o[1]]=o[2]||""}return t}(t);o.tag=i.tag;var a=null!=i.id,u=null!=i.class,s=null!=i.attrs;if(a||u||s){var d=o.attrs||{};if(a&&null==d.id&&(d.id=i.id),u&&(o._class=i.class,d.class=i.class+(null!=d.class?" "+d.class:"")),s)for(var f in i.attrs)null==d[f]&&(d[f]=i.attrs[f]);o.attrs=d}var c=o.attrs;return null!=c&&(null!=c._key&&(o.key=c._key),null!=c._ref&&(o.ref=c._ref),null!=c._hooks&&(o.hooks=c._hooks),null!=c._data&&(o.data=c._data),null!=c._flags&&(o.flags=c._flags),null==o.key&&(null!=o.ref?o.key=o.ref:null!=c.id?o.key=c.id:null!=c.name&&(o.key=c.name+("radio"===c.type||"checkbox"===c.type?c.value:"")))),null!=l&&(o.body=l),"svg"===o.tag?setTimeout(function(){null==o.ns&&U("SVG_WRONG_FACTORY",[o])},16):/^(?:input|textarea|select|datalist|keygen|output)$/.test(o.tag)&&null==o.key&&U("UNKEYED_INPUT",[o]),o}function W(e,n,o,i){if(e.type!==r&&e.type!==l){e.parent=n,e.idx=o,e.vm=i,null!=e.ref&&(a=A(e),u=e.ref,s=e,function(e,t,n){for(var l;l=t.shift();)0===t.length?e[l]=n:e[l]=e=e[l]||{}}(a,["refs"].concat(u.split(".")),s));var a,u,s,d=e.hooks,c=i&&i.hooks;(d&&(d.willRemove||d.didRemove)||c&&(c.willUnmount||c.didUnmount))&&function(e){for(;e=e.parent;)e.flags|=V}(e),f(e.body)?function(e){for(var n=e.body,l=0;l<n.length;l++){var r=n[l];!1===r||null==r?n.splice(l--,1):f(r)?(0!==l&&l!==n.length-1||U("ARRAY_FLATTENED",[e,r]),i=r,a=l--,u=1,(o=n).splice.apply(o,[a,u].concat(i))):(null==r.type&&(n[l]=r=D(""+r)),r.type===t?null==r.body||""===r.body?n.splice(l--,1):l>0&&n[l-1].type===t?(U("ADJACENT_TEXT",[e,n[l-1].body,r.body]),n[l-1].body+=r.body,n.splice(l--,1)):W(r,e,l,null):W(r,e,l,null))}var o,i,a,u}(e):""===e.body?e.body=null:R(e.body)&&(e.body=L(e.body,A(e)))}}var z={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,order:!0,lineClamp:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function B(e,t){return isNaN(t)||z[e]?t:t+"px"}function K(e,t){var n=(e.attrs||s).style,l=t?(t.attrs||s).style:null;if(null==n||function(e){var t=typeof e;return"string"===t||"number"===t}(n))e.el.style.cssText=n;else{for(var r in n){var o=n[r];R(o)&&(n[r]=o=L(o,A(e))),(null==l||null!=o&&o!==l[r])&&(e.el.style[r]=B(r,o))}if(l)for(var i in l)null==n[i]&&(e.el.style[i]="")}}var X=[];function $(e,t,n,l,r){if(null!=e){var o=n.hooks[t];if(o){if("d"!==t[0]||"i"!==t[1]||"d"!==t[2])return o(n,l);r?k(n.parent)&&o(n,l):X.push([o,n,l])}}}function q(e){if(X.length){k(e.node);for(var t;t=X.shift();)t[0](t[1],t[2])}}function J(e){return e.nextSibling}function Z(e,t,n){var l=t._node,r=l.vm;if(f(l.body))if((l.flags&V)===V)for(var o=0;o<l.body.length;o++)Z(t,l.body[o].el);else ee(l);delete t._node,e.removeChild(t),$(l.hooks,"didRemove",l,null,n),null!=r&&($(r.hooks,"didUnmount",r,r.data,n),r.node=null)}function Q(e,t){var n=t._node;if(!n._dead){var l=function e(t){var n=t.vm,l=null!=n&&$(n.hooks,"willUnmount",n,n.data),r=$(t.hooks,"willRemove",t);if((t.flags&V)===V&&f(t.body))for(var o=0;o<t.body.length;o++)e(t.body[o]);return l||r}(n);null!=l&&(a=l,"object"==typeof a&&v(a.then))?(n._dead=!0,l.then((r=Z,o=[e,t,!0],i=void 0,function(){return r.apply(i,o)}))):Z(e,t);var r,o,i,a}}function ee(e){for(var t=e.body,n=0;n<t.length;n++){var l=t[n];delete l.el._node,null!=l.vm&&(l.vm.node=null),f(l.body)&&ee(l)}}function te(e){var t=e.el;if(0==(e.flags&V))f(e.body)&&ee(e),t.textContent=null;else{var n=t.firstChild;do{var l=J(n);Q(t,n)}while(n=l)}}function ne(e,t,n){var l=t._node,r=null!=t.parentNode,o=t!==n&&r?null:l.vm;null!=o&&$(o.hooks,"willMount",o,o.data),$(l.hooks,r?"willReinsert":"willInsert",l),e.insertBefore(t,n),$(l.hooks,r?"didReinsert":"didInsert",l),null!=o&&$(o.hooks,"didMount",o,o.data)}function le(e,t,n){ne(e,t,n?J(n):null)}var re={};var oe=d,ie=!1;function ae(e,t,n){e[t]=n}function ue(e,t,n,l,r){var o=e.apply(r,t.concat([n,l,r,r.data]));r.onevent(n,l,r,r.data,t),oe.call(null,n,l,r,r.data,t),!1===o&&(n.preventDefault(),n.stopPropagation())}function se(e){var t,n,l=function(e){for(;null==e._node;)e=e.parentNode;return e._node}(e.target),r=A(l),o=e.currentTarget._node.attrs["on"+e.type];if(f(o))ue(t=o[0],n=o.slice(1),e,l,r);else for(var i in o)if(e.target.matches(i)){var a=o[i];f(a)?(t=a[0],n=a.slice(1)):(t=a,n=[]),ue(t,n,e,l,r)}}function de(e,t,n,l){if(n!==l){v(n)&&v(l)&&l.name==n.name&&U("INLINE_HANDLER",[e,l,n]),null==l||null==n||f(l)==f(n)&&c(l)==c(n)&&v(l)==v(n)||U("MISMATCHED_HANDLER",[e,l,n]);var r=e.el;null==n||v(n)?ae(r,t,n):null==l&&ae(r,t,se)}}function fe(e,t,n,l,r){var o=e.el;null!=e.ns?o.setAttribute(t,n):"class"===t?o.className=n:"id"===t||"boolean"==typeof n||l?o[t]=n:"."===t[0]?o[t.substr(1)]=n:o.setAttribute(t,n)}function ce(e,t,n){var l=e.attrs||s,r=t.attrs||s;if(l===r)U("REUSED_ATTRS",[e]);else{for(var o in l){var i=l[o];if(null!=i){var a=x(e.tag,o),u=a?e.el[o]:r[o];R(i)&&(l[o]=i=L(i,A(e))),i===u||(w(o)?K(e,t):_(o)||(b(o)?de(e,o,i,u):fe(e,o,i,a)))}}for(var o in r)null==l[o]&&!_(o)&&(d=e,f=o,c=x(e.tag,o)||b(o),"."===f[0]&&(f=f.substr(1),c=!0),c?d.el[f]="":d.el.removeAttribute(f))}var d,f,c}function ve(e,t,n,r){return e.type===l&&(t=e.data,n=e.key,r=e.opts,e=e.view),new De(e,t,n,r)}function he(e){for(var t=0;t<e.body.length;t++){var o=e.body[t],i=o.type;if(i<=n)ne(e.el,ye(o));else if(i===l){i=(a=ve(o.view,o.data,o.key,o.opts)._redraw(e,t,!1)).node.type,ne(e.el,ye(a.node))}else if(i===r){var a;(a=o.vm)._redraw(e,t),i=a.node.type,ne(e.el,a.node.el)}}}function ye(l,r){null==l.el&&(l.type===e?(l.el=r||(u=l.tag,d=l.ns,null!=d?a.createElementNS(d,u):a.createElement(u)),null!=l.attrs&&ce(l,s),(l.flags&P)===P&&l.body.body(l),f(l.body)?he(l):null!=l.body&&(l.el.textContent=l.body)):l.type===t?l.el=r||(i=l.body,a.createTextNode(i)):l.type===n&&(l.el=r||(o=l.body,a.createComment(o))));var o,i,u,d;return l.el._node=l,l.el}var pe=1,me=2;function ge(e,t,n,l,r,o,i,a){return function(u,s,d,f,c,v){var h,y;if(null!=f[l]){if(null==(h=f[l]._node))return U("FOREIGN_ELEMENT",[f[l]]),void(f[l]=e(f[l]));if(h.parent!==u)return y=e(f[l]),null!=h.vm?h.vm.unmount(!0):Q(s,f[l]),void(f[l]=y)}if(f[r]==c)return me;if(null==f[r].el)n(s,ye(f[r]),f[l]),f[r]=t(f[r],d);else if(f[r].el===f[l])f[r]=t(f[r],d),f[l]=e(f[l]);else{if(v||h!==f[i])return null!=f[r].vm&&U("ALREADY_HYDRATED",[f[r].vm]),v&&null!=f[l]?function(e,t,n,l,r,o,i,a,u){if(a._lis)n(o,u[r].el,u[l]),u[r]=t(u[r],i);else{var s=function(e,t){var n,l=0,r=t.length-1;if(r<=2147483647)for(;l<=r;){if(t[n=l+r>>1]===e)return n;t[n]<e?l=n+1:r=n-1}else for(;l<=r;){if(t[n=Math.floor((l+r)/2)]===e)return n;t[n]<e?l=n+1:r=n-1}return l==t.length?null:l}(a.idx,u.tombs);a._lis=!0;var d=e(u[l]);n(o,u[l],null!=s?i[u.tombs[s]].el:s),null==s?u.tombs.push(a.idx):u.tombs.splice(s,0,a.idx),u[l]=d}}(e,t,n,l,r,s,d,h,f):pe;y=f[l],f[l]=e(y),a(s,y,f[o]),f[o]=y}}}var be=ge(J,function(e,t){return t[e.idx+1]},ne,"lftSib","lftNode","rgtSib","rgtNode",le),_e=ge(function(e){return e.previousSibling},function(e,t){return t[e.idx-1]},le,"rgtSib","rgtNode","lftSib","lftNode",ne);function we(e,t,n,l){for(var r=Array.prototype.slice.call(t.childNodes),o=[],i=0;i<r.length;i++){var a=r[i]._node;a.parent===e&&o.push(a.idx)}for(var u=function(e){var t=e.slice(),n=[];n.push(0);for(var l,r,o=0,i=e.length;o<i;++o){var a=n[n.length-1];if(e[a]<e[o])t[o]=a,n.push(o);else{for(l=0,r=n.length-1;l<r;){var u=(l+r)/2|0;e[n[u]]<e[o]?l=u+1:r=u}e[o]<e[n[l]]&&(l>0&&(t[o]=n[l-1]),n[l]=o)}}for(r=n[(l=n.length)-1];l-- >0;)n[l]=r,r=t[r];return n}(o).map(function(e){return o[e]}),s=0;s<u.length;s++)n[u[s]]._lis=!0;for(l.tombs=u;;){if(be(e,t,n,l,null,!0)===me)break}}function ke(e){return e.el._node.parent!==e.parent}function Ee(e,t,n){return t[n]}function xe(e,t,n){for(;n<t.length;n++){var o=t[n];if(null!=o.vm){if(e.type===l&&o.vm.view===e.view&&o.vm.key===e.key||e.type===r&&o.vm===e.vm)return o}else if(!ke(o)&&e.tag===o.tag&&e.type===o.type&&e.key===o.key&&(e.flags&~V)==(o.flags&~V))return o}return null}function Ae(e,t,n){if(null==t._keys){if(t[n].key===e.key)return t[n];for(var l={},r=0;r<t.length;r++)l[t[r].key]=r;t._keys=l}return t[t._keys[e.key]]}function Te(o,i){$(i.hooks,"willRecycle",i,o);var a=o.el=i.el,u=i.body,c=o.body;if(a._node=o,o.type!==t||c===u){null==o.attrs&&null==i.attrs||ce(o,i);var v=f(u),h=f(c),y=(o.flags&P)===P;v?h||y?function(t,o){var i=t.body,a=i.length,u=o.body,f=u.length,c=(t.flags&P)===P,v=(t.flags&j)===j,h=(t.flags&F)===F,y=!v&&t.type===e,p=!0,m=0===f?d:h?Ae:v||c?Ee:xe;if(y&&0===a)return te(o),void(c&&(t.body=[]));var g,b,_=0,w=!1,k=0;if(c)var x={key:null},A=Array(a);for(var T=0;T<a;T++){if(c){var N=!1,D=null;p&&(h&&(x.key=i.key(T)),g=m(x,u,k)),null!=g?(b=g.idx,!0===(D=i.diff(T,g))?((R=g).parent=t,R.idx=T,R._lis=!1):N=!0):N=!0,N&&(W(R=i.tpl(T),t,T),R._diff=null!=D?D:i.diff(T),null!=g&&Te(R,g)),A[T]=R}else{var R=i[T],C=R.type;if(C<=n)(g=p&&m(R,u,k))&&(Te(R,g),b=g.idx);else if(C===l){if(g=p&&m(R,u,k)){b=g.idx;var S=g.vm._update(R.data,t,T)}else var S=ve(R.view,R.data,R.key,R.opts)._redraw(t,T,!1);C=S.node.type}else if(C===r){var M=E(R.vm),S=R.vm._update(R.data,t,T,M);C=S.node.type}}if(null!=g&&(b===k?++k===f&&a>f&&(g=null,p=!1):w=!0,!h&&f>100&&w&&++_%10==0))for(;k<f&&ke(u[k]);)k++}c&&(t.body=A);y&&function(e,t){var n=t.body,l=e.el,r=e.body,o={lftNode:r[0],rgtNode:r[r.length-1],lftSib:(n[0]||s).el,rgtSib:(n[n.length-1]||s).el};e:for(;;){for(;;){var i=be(e,l,r,o,null,!1);if(i===pe)break;if(i===me)break e}for(;;){var a=_e(e,l,r,o,o.lftNode,!1);if(a===pe)break;if(a===me)break e}we(e,l,r,o);break}}(t,o)}(o,i):c!==u&&(null!=c?a.textContent=c:te(i)):h?(te(i),he(o)):c!==u&&(null!=c&&null!=u?a.firstChild.nodeValue=c:a.textContent=c),$(i.hooks,"didRecycle",i,o)}else a.nodeValue=c}var Ne=null;Y.mutations&&(Ne=new function(e){navigator.userAgent.indexOf("Edge");var t=-1!==navigator.userAgent.indexOf("Trident/"),n=Object.getOwnPropertyDescriptor,l=Object.defineProperty,r=Node.prototype,o=n(r,"textContent"),i=n(r,"nodeValue"),a=HTMLElement.prototype,u=n(a,"innerText"),s=Element.prototype,d=n(t?a:s,"innerHTML"),f=n(t?a:s,"className"),c=n(t?a:s,"id"),v=CSSStyleDeclaration.prototype,h=n(v,"cssText"),y=HTMLInputElement.prototype,p=HTMLTextAreaElement.prototype,m=HTMLSelectElement.prototype,g=HTMLOptionElement.prototype,b=n(y,"checked"),_=n(y,"value"),w=n(p,"value"),k=n(m,"value"),E=n(m,"selectedIndex"),x=n(g,"selected"),A={"document.createElement":null,"document.createElementNS":null,"document.createTextNode":null,"document.createComment":null,"document.createDocumentFragment":null,"DocumentFragment.prototype.insertBefore":null,"Element.prototype.appendChild":null,"Element.prototype.removeChild":null,"Element.prototype.insertBefore":null,"Element.prototype.replaceChild":null,"Element.prototype.remove":null,"Element.prototype.setAttribute":null,"Element.prototype.setAttributeNS":null,"Element.prototype.removeAttribute":null,"Element.prototype.removeAttributeNS":null},T={},N=null;function D(e){for(var t=e.split("."),n=window;t.length>1;)n=n[t.shift()];return{ctx:n,last:t[0]}}for(var R in A){var C=D(R);null===A[R]&&(A[R]=C.ctx[C.last]),function(e,t){T[t]=0,C.ctx[t]=function(){return T[t]++,A[e].apply(this,arguments)}}(R,C.last)}T.textContent=0,l(r,"textContent",{set:function(e){T.textContent++,o.set.call(this,e)}}),T.nodeValue=0,l(r,"nodeValue",{set:function(e){T.nodeValue++,i.set.call(this,e)}}),T.innerText=0,l(a,"innerText",{set:function(e){T.innerText++,u.set.call(this,e)}}),T.innerHTML=0,l(t?a:s,"innerHTML",{set:function(e){T.innerHTML++,d.set.call(this,e)}}),T.className=0,l(t?a:s,"className",{set:function(e){T.className++,f.set.call(this,e)}}),T.cssText=0,l(v,"cssText",{set:function(e){T.cssText++,h.set.call(this,e)}}),T.id=0,l(t?a:s,"id",{set:function(e){T.id++,c.set.call(this,e)}}),T.checked=0,l(y,"checked",{set:function(e){T.checked++,b.set.call(this,e)}}),T.value=0,l(y,"value",{set:function(e){T.value++,_.set.call(this,e)}}),l(p,"value",{set:function(e){T.value++,w.set.call(this,e)}}),l(m,"value",{set:function(e){T.value++,k.set.call(this,e)}}),T.selectedIndex=0,l(m,"selectedIndex",{set:function(e){T.selectedIndex++,E.set.call(this,e)}}),T.selected=0,l(g,"selected",{set:function(e){T.selected++,x.set.call(this,e)}}),this.start=function(){N=+new Date},this.end=function(){var t=+new Date-N;N=null;var n={};for(var l in T)T[l]>0&&(n[l]=T[l]);return function(){for(var e in T)T[e]=0}(),e&&(n._time=t),n}}(!0));function De(e,t,n,l){var r=this;r.view=e,r.data=t,r.key=n,R(t)&&(r._stream=I(t,r)),l&&(r.opts=l,r.config(l));var o=c(e)?e:e.call(r,r,t,n,l);v(o)?r.render=o:(r.render=o.render,r.config(o)),r._redrawAsync=g(function(e){return r.redraw(!0)}),r._updateAsync=g(function(e){return r.update(e,!0)}),r.init&&r.init.call(r,r,r.data,r.key,l)}var Re=De.prototype={constructor:De,_diff:null,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,onevent:d,refs:null,render:null,mount:function(e,t){Y.mutations&&Ne.start();t?(te({el:e,flags:0}),this._redraw(null,null,!1),e.nodeName.toLowerCase()!==this.node.tag?(ye(this.node),ne(e.parentNode,this.node.el,e),e.parentNode.removeChild(e)):ne(e.parentNode,ye(this.node,e),e)):(this._redraw(null,null),e&&ne(e,this.node.el));e&&q(this);Y.mutations&&console.log(Ne.end());return this},unmount:function(e){R(this._stream)&&M(this._stream);var t=this.node;Q(t.el.parentNode,t.el),e||q(this)},config:function(e){e.init&&(this.init=e.init),e.diff&&(this.diff=e.diff),e.onevent&&(this.onevent=e.onevent),e.hooks&&(this.hooks=h(this.hooks||{},e.hooks)),e.onemit&&(this.onemit=h(this.onemit||{},e.onemit))},parent:function(){return A(this.node.parent)},root:function(){for(var e=this.node;e.parent;)e=e.parent;return e.vm},redraw:function(e){null==e&&(e=ie);return e?this._redraw(null,null,E(this)):this._redrawAsync(),this},update:function(e,t){null==t&&(t=ie);return t?this._update(e,null,null,E(this)):this._updateAsync(e),this},_update:function(e,t,n,l){null!=e&&this.data!==e&&(U("DATA_REPLACED",[this,this.data,e]),$(this.hooks,"willUpdate",this,e),this.data=e,R(this._stream)&&M(this._stream),R(e)&&(this._stream=I(e,this)));return this._redraw(t,n,l)},_redraw:function(e,t,n){var l=null==e,r=this.node&&this.node.el&&this.node.el.parentNode;l&&this.node&&this.node.el&&!this.node.el.parentNode&&U("UNMOUNTED_REDRAW",[this]);l&&Y.mutations&&r&&Ne.start();var o,i,a=this.node;if(null!=this.diff&&(o=this._diff,this._diff=i=this.diff(this,this.data),null!=a)){var u=f(o)?m:p,s=o===i||u(o,i);if(s)return Ce(this,a,e,t)}r&&$(this.hooks,"willRedraw",this,this.data);var d=this.render.call(this,this,this.data,o,i);if(d===a)return Ce(this,a,e,t);this.refs=null,null!=this.key&&d.key!==this.key&&(d.key=this.key);this.node=d,e?(W(d,e,t,this),e.body[t]=d):a&&a.parent?(W(d,a.parent,a.idx,this),a.parent.body[a.idx]=d):W(d,null,null,this);if(!1!==n)if(a)if(a.tag!==d.tag||a.key!==d.key){a.vm=d.vm=null;var c=a.el.parentNode,v=J(a.el);Q(c,a.el),ne(c,ye(d),v),a.el=d.el,d.vm=this}else Te(d,a);else ye(d);r&&$(this.hooks,"didRedraw",this,this.data),l&&r&&q(this);l&&Y.mutations&&r&&console.log(Ne.end());return this},_redrawAsync:null,_updateAsync:null};function Ce(e,t,n,l){return null!=n&&(n.body[l]=t,t.idx=l,t.parent=n,t._lis=!1),e}function Se(e,t,n,l){var r,o;return null==n?c(t)?r=t:o=t:(r=t,o=n),G(e,r,o,l)}var Me="http://www.w3.org/2000/svg";function Le(e,t,n,l){this.view=e,this.data=t,this.key=n,this.opts=l}Le.prototype={constructor:Le,type:l,view:null,data:null,key:null,opts:null};function Ie(e){this.vm=e}Ie.prototype={constructor:Ie,type:r,vm:null};var Oe={config:function(e){oe=e.onevent||oe,null!=e.syncRedraw&&(ie=e.syncRedraw),e.onemit&&(t=e.onemit,h(re,t));var t;e.stream&&(n=e.stream,R=n.is,C=n.val,S=n.sub,M=n.unsub);var n},ViewModel:De,VNode:T,createView:ve,defineElement:Se,defineSvgElement:function(e,t,n,l){var r=Se(e,t,n,l);return r.ns=Me,r},defineText:D,defineComment:function(e){var t=new T;return t.type=n,t.body=e,t},defineView:function(e,t,n,l){return new Le(e,t,n,l)},injectView:function(e){return new Ie(e)},injectElement:function(t){var n=new T;return n.type=e,n.el=n.key=t,n},lazyList:function(e,t){var n=e.length,l={items:e,length:n,key:function(n){return t.key(e[n],n)},diff:function(n,l){var r=t.diff(e[n],n);if(null==l)return r;var o=l._diff;return(r===o||f(o)?m(r,o):p(r,o))||r},tpl:function(n){return t.tpl(e[n],n)},map:function(e){return t.tpl=e,l},body:function(e){for(var t=Array(n),r=0;r<n;r++){var o=l.tpl(r);o._diff=l.diff(r),t[r]=o,W(o,e,r)}e.body=t}};return l},FIXED_BODY:j,DEEP_REMOVE:V,KEYED_LIST:F,LAZY_LIST:P};N.patch=function(e,t){!function(e,t,n){if(null!=t.type){if(null!=e.vm)return;W(t,e.parent,e.idx,null),e.parent.body[e.idx]=t,Te(t,e),n&&k(t),q(A(t))}else{var l=Object.create(e);l.attrs=h({},e.attrs);var r=h(e.attrs,t);if(null!=e._class){var o=r.class;r.class=null!=o&&""!==o?e._class+" "+o:e._class}ce(e,l),n&&k(e)}}(this,e,t)};function He(e){var t,n,l=arguments,r=l.length;if(r>1){var o=1;c(l[1])&&(n=l[1],o=2),t=r!==o+1||l[o]instanceof T||l[o]instanceof Le||l[o]instanceof Ie?y(l,o):l[o]}return G(e,n,t)}Re.emit=function(e){var t=this,n=t,l=y(arguments,1).concat(n,n.data);do{var r=t.onemit,o=r?r[e]:null;if(o){o.apply(t,l);break}}while(t=t.parent());re[e]&&re[e].apply(t,l)},Re.onemit=null,Re.body=function(){return function e(t,n){var l=t.body;if(f(l))for(var r=0;r<l.length;r++){var o=l[r];null!=o.vm?n.push(o.vm):e(o,n)}return n}(this.node,[])},Oe.defineElementSpread=He,Oe.defineSvgElementSpread=function(){var e=He.apply(null,arguments);return e.ns=Me,e},Re._stream=null;function Ye(e){var t="";for(var n in e)null!=e[n]&&(t+=(l=n,l.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+": "+B(n,e[n])+"; "));var l;return t}function Ue(e){return null==e?"":""+e}var Ve={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function je(e){e=Ue(e);for(var t=0,n="";t<e.length;t++)switch(e[t]){case"&":n+="&amp;";break;case"<":n+="&lt;";break;case">":n+="&gt;";break;default:n+=e[t]}return n}function Fe(e){e=Ue(e);for(var t=0,n="";t<e.length;t++)n+='"'===e[t]?"&quot;":e[t];return n}function Pe(e,t){for(var n="",l=0;l<e.length;l++)n+=We(e[l],t);return n}var Ge=".innerHTML";function We(o,i){var a,u;switch(o.type){case l:a=ve(o.view,o.data,o.key,o.opts).html(i);break;case r:a=o.vm.html();break;case e:if(null!=o.el&&null==o.tag){a=o.el.outerHTML;break}var s="";s+="<"+o.tag;var d=o.attrs,c=null!=d;if(c){for(var v in d)if(!(b(v)||"."===v[0]||"_"===v[0]||!1===i&&x(o.tag,v))){var h=d[v];"style"!==v||null==h?!0===h?s+=" "+je(v)+'=""':!1===h||null!=h&&(s+=" "+je(v)+'="'+Fe(h)+'"'):u="object"==typeof h?Ye(h):h}null!=u&&(s+=' style="'+Fe(u.trim())+'"')}if(null==o.body&&null!=o.ns&&"svg"!==o.tag)return s+"/>";s+=">",Ve[o.tag]||(c&&null!=d[Ge]?s+=d[Ge]:f(o.body)?s+=Pe(o.body,i):(o.flags&P)===P?(o.body.body(o),s+=Pe(o.body,i)):s+=je(o.body),s+="</"+o.tag+">"),a=s;break;case t:a=je(o.body);break;case n:a="\x3c!--"+je(o.body)+"--\x3e"}return a}return Re.attach=function(e){return null==this.node&&this._redraw(null,null,!1),function e(t,n){t.el=n,n._node=t;var o=t.attrs;for(var i in o){var a=o[i],u=x(t.tag,i);w(i)||_(i)||(b(i)?de(t,i,a):null!=a&&u&&fe(t,i,a,u))}if((t.flags&P)===P&&t.body.body(t),f(t.body)&&t.body.length>0){var s=n.firstChild,d=0,c=t.body[d];do{c.type===l?c=ve(c.view,c.data,c.key,c.opts)._redraw(t,d,!1).node:c.type===r&&(c=c.node||c._redraw(t,d,!1).node),"table"===t.tag&&"tr"===c.tag&&U("ATTACH_IMPLICIT_TBODY",[t,c]),e(c,s)}while((s=s.nextSibling)&&(c=t.body[++d]))}}(this.node,e),this},Re.html=function(e){return null==this.node&&this._redraw(null,null,!1),We(this.node,e)},N.html=function(e){return We(this,e)},Oe.DEVMODE=Y,Oe});