// https://github.com/leeoniya/domvm (2.x-dev, client)
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.domvm=e()}(this,function(){"use strict";function n(){}function e(n){return null!=n}function t(n){return null!=n&&n.constructor===Object}function r(n,e,t,r){n.splice.apply(n,[t,r].concat(e))}function l(n){var e=typeof n;return"string"===e||"number"===e}function o(n){return"function"==typeof n}function i(n){return"object"==typeof n&&o(n.then)}function u(n){for(var e=arguments,t=1;t<e.length;t++)for(var r in e[t])n[r]=e[t][r];return n}function f(n,e,t){for(var r;r=e.shift();)0===e.length?n[r]=t:n[r]=n=n[r]||{}}function a(n,e){for(var t=[],r=e;r<n.length;r++)t.push(n[r]);return t}function d(n,e){for(var t in n)if(n[t]!==e[t])return!1;return!0}function s(n,e){var t=n.length;if(e.length!==t)return!1;for(var r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}function c(n){function e(){t=0,n.apply(r,l)}if(!Wn)return n;var t,r,l;return function(){r=this,l=arguments,t||(t=Wn(e))}}function y(n,e,t){return function(){return n.apply(t,e)}}function v(n,e,t,r){return function(l,i){return void 0!==l&&l!==n&&(n=l,!1!==i&&o(e)&&e.apply(t,r)),n}}function p(n,e){var t,r=0,l=n.length-1;if(l<=2147483647)for(;r<=l;){if(t=r+l>>1,n[t].key===e)return t;n[t].key<e?r=t+1:l=t-1}else for(;r<=l;){if(t=Math.floor((r+l)/2),n[t].key===e)return t;n[t].key<e?r=t+1:l=t-1}return-1}function h(){}function m(n){var e=new h;return e.type=Yn,e.body=n,e}function k(n){return"o"===n[0]&&"n"===n[1]}function b(n){return"_"===n[0]}function w(n){return"style"===n}function g(n){n&&n.el&&n.el.offsetHeight}function _(n,e){switch(e){case"value":case"checked":case"selected":return!0}return!1}function x(n){for(n=n||Xn;null==n.vm&&n.parent;)n=n.parent;return n.vm}function C(n,e){return isNaN(e)||Qn[n]?e:e+"px"}function A(n){var e=$n[n];if(null==e){var t,r,l,o;for($n[n]=e={tag:(t=n.match(/^[-\w]+/))?t[0]:"div",id:(r=n.match(/#([-\w]+)/))?r[1]:null,class:(l=n.match(/\.([-\w.]+)/))?l[1].replace(/\./g," "):null,attrs:null};o=ne.exec(n);)null==e.attrs&&(e.attrs={}),e.attrs[o[1]]=o[2]||""}return e}function N(n){ee=n.is,te=n.val,re=n.sub,le=n.unsub}function S(n,e){var t=re(n,function(n){t&&(null!=e.node&&e.redraw(),le(t))});return te(n)}function E(n,t,r,l){var o=new h;o.type=Un,e(l)&&(o.flags=l),o.attrs=t;var i=A(n);if(o.tag=i.tag,i.id||i.class||i.attrs){var u=o.attrs||{};if(i.id&&!e(u.id)&&(u.id=i.id),i.class&&(o._class=i.class,u.class=i.class+(e(u.class)?" "+u.class:"")),i.attrs)for(var f in i.attrs)e(u[f])||(u[f]=i.attrs[f]);o.attrs=u}var a=o.attrs;return e(a)&&(e(a._key)&&(o.key=a._key),e(a._ref)&&(o.ref=a._ref),e(a._hooks)&&(o.hooks=a._hooks),e(a._raw)&&(o.raw=a._raw),e(a._data)&&(o.data=a._data),e(a._flags)&&(o.flags=a._flags),e(o.key)||(e(o.ref)?o.key=o.ref:e(a.id)?o.key=a.id:e(a.name)&&(o.key=a.name))),null!=r&&(o.body=r),o}function R(n,e,t){f(n,["refs"].concat(e.split(".")),t)}function I(n){for(;n=n.parent;)n.flags|=ie}function M(n,e,t,r){n.type!==qn&&n.type!==Gn&&(n.parent=e,n.idx=t,n.vm=r,null!=n.ref&&R(x(n),n.ref,n),(n.hooks&&n.hooks.willRemove||r&&r.hooks&&r.hooks.willUnmount)&&I(n),Zn(n.body)?V(n):ee(n.body)&&(n.body=S(n.body,x(n))))}function V(n){for(var e=n.body,t=0;t<e.length;t++){var l=e[t];!1===l||null==l?e.splice(t--,1):Zn(l)?r(e,l,t--,1):(null==l.type&&(e[t]=l=m(""+l)),l.type===Yn?null==l.body||""===l.body?e.splice(t--,1):t>0&&e[t-1].type===Yn?(e[t-1].body+=l.body,e.splice(t--,1)):M(l,n,t,null):M(l,n,t,null))}}function O(n,e){var t=(n.attrs||Xn).style,r=e?(e.attrs||Xn).style:null;if(null==t||l(t))n.el.style.cssText=t;else{for(var o in t){var i=t[o];ee(i)&&(i=S(i,x(n))),(null==r||null!=i&&i!==r[o])&&(n.el.style[o]=C(o,i))}if(r)for(var u in r)null==t[u]&&(n.el.style[u]="")}}function T(n,e,t,r,l){if(!n)return e(t,r);l?g(t.parent)&&e(t,r):ae.push([e,t,r])}function j(n,e,t,r){var l=e.hooks[n];if(l){var o="d"===n[0]&&"i"===n[1]&&"d"===n[2];return Zn(l)?l.map(function(n){return T(o,n,e,t)}):T(o,l,e,t,r)}}function D(n){for(;null==n._node;)n=n.parentNode;return n._node}function L(n,e){return null!=e?de.createElementNS(e,n):de.createElement(n)}function H(n){return de.createTextNode(n)}function z(n){return de.createComment(n)}function B(n){return n.nextSibling}function F(n){return n.previousSibling}function U(n){var e=n.hooks,t=n.vm;t&&t.hooks&&j("willUnmount",t);var r=e&&j("willRemove",n);if((n.flags&ie)===ie&&Zn(n.body))for(var l=0;l<n.body.length;l++)U(n.body[l]);return r}function Y(n,e,t){var r=e._node,l=r.hooks,o=r.vm;if((r.flags&ie)===ie&&Zn(r.body))for(var i=0;i<r.body.length;i++)Y(e,r.body[i].el);n.removeChild(e),l&&j("didRemove",r,null,t),o&&o.hooks&&j("didUnmount",o,null,t)}function P(n,e){var t=e._node,r=(t.hooks,U(t));null!=r&&i(r)?r.then(y(Y,[n,e,!0])):Y(n,e)}function G(n){var e=n.el;if(0==(n.flags&ie))e.textContent=null;else for(;e.firstChild;)P(e,e.firstChild)}function q(n,e,t){var r=e._node,l=r.hooks,o=null!=e.parentNode,i=(e===t||!o)&&r.vm;i&&i.hooks&&j("willMount",i),l&&j(o?"willReinsert":"willInsert",r),n.insertBefore(e,t),l&&j(o?"didReinsert":"didInsert",r),i&&i.hooks&&j("didMount",i)}function K(n,e,t){q(n,e,t?B(t):null)}function W(n){u(se,n)}function X(n,e,t){n[e]=t}function Z(n,e,t){var r=D(n.target),l=x(r),o=e.apply(null,t.concat(n,r,l));se.onevent.apply(null,[n,r,l].concat(t)),!1===o&&(n.preventDefault(),n.stopPropagation())}function J(n,e){return function(t){Z(t,n,e)}}function Q(n){return function(e){for(var t in n)if(e.target.matches(t)){var r=n[t],l=Zn(r);Z(e,l?r[0]:r,l?r.slice(1):[])}}}function $(n,e,t,r){if(t!==r){var l=n.el;Zn(t)?(null==r||!s(t,r))&&X(l,e,J(t[0],t.slice(1))):o(t)&&t!==r?X(l,e,J(t,[])):X(l,e,Q(t))}}function nn(n,e,t){t?n.el[e]="":n.el.removeAttribute(e)}function en(n,e,t,r,l){var o=n.el;null==t?!l&&nn(n,e):null!=n.ns?o.setAttribute(e,t):"class"===e?o.className=t:"id"===e||"boolean"==typeof t||r?o[e]=t:"."===e[0]?o[e.substr(1)]=t:o.setAttribute(e,t)}function tn(n,e,t){var r=n.attrs||Xn,l=e.attrs||Xn;if(r===l);else{for(var o in r){var i=r[o],u=_(n.tag,o),f=u?n.el[o]:l[o];ee(i)&&(r[o]=i=S(i,x(n))),i===f||(w(o)?O(n,e):b(o)||(k(o)?$(n,o,i,f):en(n,o,i,u,t)))}for(var o in l)!(o in r)&&!b(o)&&nn(n,o,_(n.tag,o)||k(o))}}function rn(n,e,t,r){if(n.type===Gn)e=n.model,t=n.key,r=n.opts,n=n.view;else if(n.prototype._isClass)return new n(e,t,r);return new xn(n,e,t,r)}function ln(n){for(var e=0;e<n.body.length;e++){var t=n.body[e],r=t.type;if(r<=Pn)q(n.el,on(t));else if(r===Gn)r=(l=rn(t.view,t.model,t.key,t.opts)._redraw(n,e,!1)).node.type,q(n.el,on(l.node));else if(r===qn){var l=t.vm;l._redraw(n,e),r=l.node.type,q(n.el,l.node.el)}}}function on(n,e){return null==n.el&&(n.type===Un?(n.el=e||L(n.tag,n.ns),null!=n.attrs&&tn(n,Xn,!0),(n.flags&fe)===fe&&n.body.body(n),Zn(n.body)?ln(n):null!=n.body&&""!==n.body&&(n.raw?n.el.innerHTML=n.body:n.el.textContent=n.body)):n.type===Yn?n.el=e||H(n.body):n.type===Pn&&(n.el=e||z(n.body))),n.el._node=n,n.el}function un(n,e){return e[n.idx+1]}function fn(n,e){return e[n.idx-1]}function an(n){return n.parent}function dn(n,e,t,r){var l=F(t),o=B(r);return n(l,o),{lftSib:l?B(l):e.firstChild,rgtSib:o?F(o):e.lastChild}}function sn(n,e,t,r,l){var o=l.idx===t.idx+1,i=!o&&e._node===l,u=!!o||r._node===t;return i||u?dn(function(t,l){u&&q(n,r,e),i&&q(n,e,l)},n,e,r):null}function cn(n,e,t,r){return dn(function(t,l){for(var o,i=e;i!==l;i=B(i)){e=o=i;for(var u=B(i);u!==l;u=B(u))r(o,u)>0&&(o=u);o!==i&&(q(n,o,e),i=o)}},n,e,t)}function yn(n,e){return n._node.idx-e._node.idx}function vn(n,e){var t,r,l,o,i=n.el,u=n.body,f=e.body,a=u[0],d=u[u.length-1],s=(f[0]||Xn).el,c=(f[f.length-1]||Xn).el;n:for(;;){for(;;){if(s){if(null==(l=s._node)){s=B(s);continue}if(an(l)!==n){r=B(s),null!=l.vm?l.vm.unmount(!0):P(i,s),s=r;continue}}if(null==a)break n;if(null==a.el)q(i,on(a),s),a=un(a,u);else{if(a.el!==s)break;a=un(a,u),s=B(s)}}for(;;){if(c){if(null==(o=c._node)){c=F(c);continue}if(an(o)!==n){r=F(c),null!=o.vm?o.vm.unmount(!0):P(i,c),c=r;continue}}if(d===a)break n;if(null==d.el)K(i,on(d),c),d=fn(d,u);else{if(d.el!==c)break;d=fn(d,u),c=F(c)}}(t=sn(i,s,a,c,d))?(s=t.lftSib,c=t.rgtSib):(s=(t=cn(i,s,c,yn)).lftSib,c=t.rgtSib)}}function pn(n,e){return new hn(n,e.key,e.diff,e.tpl)}function hn(n,e,t,r){this.items=n,this.length=n.length,this.key=function(t){return e(n[t],t)},this.diff=function(e,r){var l=t(n[e],e);if(null==r)return l;var o=r._diff;return(l===o||Zn(o)?s(l,o):d(l,o))||l},this.map(r)}function mn(n,e,t,r){for(;t<e.length;t++){var l=e[t];if(n.type===Gn&&null!=l.vm){var o=l.vm;if(o.view===n.view&&o.key===n.key)return l}if(l.el._node===l&&n.tag===l.tag&&n.type===l.type&&n.vm===l.vm){if(n.key===l.key)return l;if(null==l.key)return l}}return null}function kn(n,e){var t=p(e,n.key);return t>-1?e[t]:null}function bn(n,e,t){for(;t<e.length;t++){var r=e[t];if(r.key===n.key)return r}return null}function wn(n,e){e.hooks&&j("willRecycle",e,n);var t=n.el=e.el,r=e.body,l=n.body;if(t._node=n,n.type!==Yn||l===r){null==n.attrs&&null==e.attrs||tn(n,e);var o=Zn(r),i=Zn(l);o?i||(n.flags&fe)===fe?_n(n,e):l!==r&&(null!=l?n.raw?t.innerHTML=l:t.textContent=l:G(e)):i?(G(e),ln(n)):l!==r&&(n.raw?t.innerHTML=l:e.raw?t.textContent=l:t.firstChild?t.firstChild.nodeValue=l:t.textContent=l),e.hooks&&j("didRecycle",e,n)}else t.nodeValue=l}function gn(n,e){return n.key>e.key?1:n.key<e.key?-1:0}function _n(n,e){var t=n.body,r=t.length,l=e.body.length,o=(e.flags&oe)===oe,i=e.type===Un&&!o;if(i&&0===r)return G(e),void((n.flags&fe)===fe&&(n.body=[]));var u=(e.flags&ue)===ue;if(u&&!o&&l>ce){(f=e.body.slice()).sort(gn);a=kn}else var f=e.body,a=mn;var d,s,c,y,v,p=0;if(u&&(e.flags&fe)===fe){a=bn;for(var h={key:null},m=Array(t.length),k=0;k<r;k++)y=!1,c=null,h.key=t.key(k),null!=(d=a(h,f,p))&&!0===(c=t.diff(k,d))?((s=d).parent=n,s.idx=k):y=!0,y&&(M(s=t.tpl(k),n,k),s._diff=null!=c?c:t.diff(k),null!=d&&wn(s,d)),m[k]=s,a!==kn&&null!=d&&d.idx===p&&p++;n.body=m}else for(k=0;k<r;k++){if((v=(s=t[k]).type)<=Pn)(d=a(s,f,p))&&wn(s,d);else if(v===Gn){if(d=a(s,f,p))b=d.vm._update(s.model,n,k);else var b=rn(s.view,s.model,s.key,s.opts)._redraw(n,k,!1);v=b.node.type}else v===qn&&(v=(b=s.vm._update(s.model,n,k)).node.type);a!==kn&&null!=d&&d.idx===p&&p++}i&&vn(n,e)}function xn(n,e,t,r){var l=this;if(l.view=n,l.model=e,l.key=null==t?e:t,n.prototype._isClass){var i=l.diff;null!=i&&i!==ye.diff&&(l.diff=ye.diff.bind(l),l.diff(i))}else{var f=n.call(l,l,e,t,r);o(f)?l.render=f:(f.diff&&(l.diff(f.diff),delete f.diff),u(l,f))}r&&(l.opts=r,r.hooks&&l.hook(r.hooks),r.diff&&l.diff(r.diff)),l._redrawAsync=c(function(n){return l._redraw()}),l._updateAsync=c(function(n){return l._update(n)});var a=l.hooks;a&&a.didInit&&a.didInit.call(l,l,e,t,r)}function Cn(n){if(ae.length){g(n.node);for(var e;e=ae.shift();)e[0](e[1],e[2])}}function An(n,e){var t=this;return e?(G({el:n,flags:0}),t._redraw(null,null,!1),n.nodeName.toLowerCase()!==t.node.tag?(on(t.node),q(n.parentNode,t.node.el,n),n.parentNode.removeChild(n)):q(n.parentNode,on(t.node,n),n)):(t._redraw(null,null),n&&q(n,t.node.el)),n&&Cn(t),t}function Nn(n){var e=this,t=e.node;P(t.el.parentNode,t.el),n||Cn(e)}function Sn(n,e,t){var r=null==n,l=this,o=l.node&&l.node.el&&l.node.el.parentNode,i=l.node;if(o&&null!=l._diff&&l._diff())return i&&n&&(n.body[e]=i,i.idx=e,i.parent=n),l;o&&l.hooks&&j("willRedraw",l),l.refs=null;var u=l.render.call(l,l,l.model,l.key);if(!1!==l.key&&null!=l.key&&u.key!==l.key&&(u.key=l.key),l.node=u,n?(M(u,n,e,l),n.body[e]=u):i&&i.parent?(M(u,i.parent,i.idx,l),i.parent.body[i.idx]=u):M(u,null,null,l),!1!==t)if(i)if(i.tag!==u.tag){i.vm=u.vm=null;var f=i.el.parentNode,a=B(i.el);P(f,i.el),q(f,on(u),a),i.el=u.el,u.vm=l}else wn(u,i);else on(u);return o&&l.hooks&&j("didRedraw",l),r&&o&&Cn(l),l}function En(n,e,t,r){var l=this;return null!=n&&l.model!==n&&(l.hooks&&j("willUpdate",l,n),l.model=n),l._redraw(e,t,r)}function Rn(n,e,r,l){var o,i;return null==r?t(e)?o=e:i=e:(o=e,i=r),E(n,o,i,l)}function In(n,e,t,r){var l=Rn(n,e,t,r);return l.ns=ve,l}function Mn(n){var e=new h;return e.type=Pn,e.body=n,e}function Vn(n,e,t,r){this.view=n,this.model=e,this.key=null==t?e:t,this.opts=r}function On(n,e,t,r){return new Vn(n,e,t,r)}function Tn(n){this.vm=n}function jn(n){return new Tn(n)}function Dn(n){var e=new h;return e.type=Un,e.el=e.key=n,e}function Ln(n,e){if(null!=e.type){if(null!=n.vm)return;M(e,n.parent,n.idx,null),n.parent.body[n.idx]=e,wn(e,n),Cn(x(e))}else{var t=Object.create(n);t.attrs=u({},n.attrs);var r=u(n.attrs,e);if(null!=n._class){var l=r.class;r.class=null!=l&&""!==l?n._class+" "+l:n._class}tn(n,t)}}function Hn(n){var e=arguments,t=this;do{var r=t.events,l=r?r[n]:null;if(l){l.apply(null,a(e,1));break}}while(t=t.parent())}function zn(n,e){var t=this;if(null==t.events&&(t.events={}),l(n))t.events[n]=e;else{var r=n;for(var n in r)t.on(n,r[n])}}function Bn(n,e){var t=n.body;if(Zn(t))for(var r=0;r<t.length;r++){var l=t[r];null!=l.vm?e.push(l.vm):Bn(l,e)}return e}function Fn(n,e){n.el=e,e._node=n;var t=n.attrs;for(var r in t){var l=t[r],o=_(n.tag,r);w(r)||b(r)||(k(r)?$(n,r,l):null!=l&&o&&en(n,r,l,o))}if(Zn(n.body)){var i=e.firstChild,u=0,f=n.body[u];do{f.type===Gn?f=rn(f.view,f.model,f.key,f.opts)._redraw(n,u,!1).node:f.type===qn&&(f=f.node||f._redraw(n,u,!1).node),Fn(f,i)}while((i=i.nextSibling)&&(f=n.body[++u]))}}var Un=1,Yn=2,Pn=3,Gn=4,qn=5,Kn="undefined"!=typeof window,Wn=(Kn?window:{}).requestAnimationFrame,Xn={},Zn=Array.isArray,Jn=h.prototype={constructor:h,type:null,vm:null,key:null,ref:null,data:null,hooks:null,raw:!1,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,idx:null,parent:null},Qn={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,columnCount:!0,counterIncrement:!0,flex:!0,flexGrow:!0,flexOrder:!0,flexPositive:!0,flexShrink:!0,float:!0,fontWeight:!0,gridColumn:!0,lineHeight:!0,lineClamp:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,transform:!0,transformOrigin:!0,widows:!0,zIndex:!0,zoom:!0},$n={},ne=/\[(\w+)(?:=(\w+))?\]/g,ee=function(){return!1},te=null,re=null,le=null,oe=1,ie=2,ue=4,fe=8,ae=[],de=Kn?document:null,se={onevent:n};hn.prototype={constructor:hn,items:null,length:null,key:null,diff:null,tpl:null,map:function(n){return this.tpl=function(e){return n(this.items[e])},this},body:function(n){for(var e=this,t=this.items,r=Array(t.length),l=0;l<t.length;l++){var o=e.tpl(l);o._diff=e.diff(l),r[l]=o,M(o,n,l)}n.body=r}};var ce=100,ye=xn.prototype={constructor:xn,_isClass:!1,view:null,key:null,model:null,opts:null,node:null,hooks:null,render:null,parent:function(){return x(this.node.parent)},root:function(){for(var n=this.node;n.parent;)n=n.parent;return n.vm},api:null,refs:null,mount:An,unmount:Nn,redraw:function(n){var e=this;return n?e._redraw():e._redrawAsync(),e},update:function(n,e){var t=this;return e?t._update(n):t._updateAsync(n),t},_update:En,_redraw:Sn,_redrawAsync:null,_updateAsync:null,hook:function(n){this.hooks=this.hooks||u({},this.hooks,n)}},ve="http://www.w3.org/2000/svg";Vn.prototype={constructor:Vn,type:Gn,view:null,model:null,key:null,opts:null},Tn.prototype={constructor:Tn,type:qn,vm:null};var pe={config:W,ViewModel:xn,VNode:h,createView:rn,defineElement:Rn,defineSvgElement:In,defineText:m,defineComment:Mn,defineView:On,injectView:jn,injectElement:Dn,lazyBody:pn,FIXED_BODY:oe,DEEP_REMOVE:ie,KEYED_LIST:ue,LAZY_BODY:fe};return ye._diff=null,ye.diff=function(n){var e=this;if(o(n))t=n;else var t=n.vals,r=n.then;var l=t.call(e,e,e.model,e.key,e.opts),i=Zn(l)?s:d;e._diff=function(){var n=t.call(e,e,e.model,e.key,e.opts),o=l===n||i(l,n);return o||(null!=r&&!1===r.call(e,e,l,n)&&(o=!0),l=n),o}},Jn.patch=function(n){return Ln(this,n)},ye.events=null,ye.emit=Hn,ye.on=zn,ye.body=function(){return Bn(this.node,[])},"undefined"!=typeof flyd&&N({is:function(n){return flyd.isStream(n)},val:function(n){return n()},sub:function(n,e){return flyd.on(e,n)},unsub:function(n){return n.end(!0)}}),pe.streamCfg=N,pe.prop=v,ye.attach=function(n){var e=this;return null==e.node&&e._redraw(null,null,!1),Fn(e.node,n),e},pe});
//# sourceMappingURL=domvm.client.min.js.map
