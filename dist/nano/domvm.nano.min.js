// https://github.com/domvm/domvm (v3.4.7-dev, nano build)
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(n.domvm={})}(this,function(n){"use strict";var A=1,o=2,C=3,R=4,S=5,e="undefined"!=typeof window,t=e?document:{},u=(e?window:{}).requestAnimationFrame,f={};function E(){}var s=Array.isArray;function i(n){return null!=n&&n.constructor===Object}function r(n,e,t,l){n.splice.apply(n,[t,l].concat(e))}function a(n){var e=typeof n;return"string"===e||"number"===e}function d(n){return"function"==typeof n}function c(n){return"object"==typeof n&&d(n.then)}function v(n){for(var e=arguments,t=1;t<e.length;t++)for(var l in e[t])n[l]=e[t][l];return n}function l(n,e,t){var l;while(l=e.shift())0===e.length?n[l]=t:n[l]=n=n[l]||{}}function y(n,e){for(var t in n)if(n[t]!==e[t])return false;return true}function p(n,e){var t=n.length;if(e.length!==t)return false;for(var l=0;l<t;l++)if(n[l]!==e[l])return false;return true}function h(n,e){return!(n===e||(s(n)?p(n,e):!!i(n)&&y(n,e)))}function w(n){if(!u)return n;var e,t,l;function r(){e=0,n.apply(t,l)}return function(){t=this,l=arguments,e||(e=u(r))}}function m(n,e,t){return function(){return n.apply(t,e)}}function b(n){for(var e,t,l,r=n.slice(),u=[0],i=0,a=0;a<n.length;++a){var o=n[a];if(-1!==o)if(n[l=u[i]]<o)r[a]=l,u[++i]=a;else{e=0,t=i;while(e<t)n[u[l=(e+t)/2|0]]<o?e=l+1:t=l;o<n[u[e]]&&(0<e&&(r[a]=u[e-1]),u[e]=a)}}t=u[i];while(0<=i)t=r[u[i--]=t];return u}function g(n,e){var t,l=0,r=e.length-1;if(r<=2147483647)while(l<=r){if(e[t=l+r>>1]===n)return t;e[t]<n?l=t+1:r=t-1}else while(l<=r){if(e[t=Math.floor((l+r)/2)]===n)return t;e[t]<n?l=t+1:r=t-1}return l==e.length?null:l}function k(n){return"."===n[0]}function _(n){return"o"===n[0]&&"n"===n[1]}function x(n){return"_"===n[0]}function N(n){return"style"===n}function V(n){n&&n.el&&n.el.offsetHeight}function j(n){return null!=n.node&&null!=n.node.el}function U(n,e){switch(e){case"value":case"checked":case"selected":return true}return false}function D(n){n=n||f;while(null==n.vm&&n.parent)n=n.parent;return n.vm}function I(){}var L=I.prototype={constructor:I,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_diff:null,_dead:false,_lis:false,idx:null,parent:null};function M(n){var e=new I;return e.type=o,e.body=n,e}L._class=null;var T={},O=/\[(\w+)(?:=(\w+))?\]/g;function B(n){var e=T[n];if(null==e){var t,l,r,u;T[n]=e={tag:(t=n.match(/^[-\w]+/))?t[0]:"div",id:(l=n.match(/#([-\w]+)/))?l[1]:null,class:(r=n.match(/\.([-\w.]+)/))?r[1].replace(/\./g," "):null,attrs:null};while(u=O.exec(n))null==e.attrs&&(e.attrs={}),e.attrs[u[1]]=u[2]||""}return e}var F=1,Y=2,q=4,H=8;function K(n,e,t,l){var r=new I;r.type=A,r.flags=l||0,r.attrs=e||null;var u=B(n);n=u.tag;var i=null!=u.id,a=null!=u.class,o=null!=u.attrs;if(i||a||o){var f=r.attrs||{};if(i&&null==f.id&&(f.id=u.id),a&&(r._class=u.class,f.class=u.class+(null!=f.class?" "+f.class:"")),o)for(var s in u.attrs)null==f[s]&&(f[s]=u.attrs[s]);r.attrs=f}if(r.tag=n,null!=r.attrs){var d=r.attrs;null!=d._key&&(r.key=d._key),null!=d._ref&&(r.ref=d._ref),null!=d._hooks&&(r.hooks=d._hooks),null!=d._data&&(r.data=d._data),null!=d._flags&&(r.flags=d._flags),null==r.key&&(null!=r.ref?r.key=r.ref:null!=d.id?r.key=d.id:null!=d.name&&(r.key=d.name+("radio"===d.type||"checkbox"===d.type?d.value:"")))}return null!=t&&(r.body=t)instanceof P&&(r.flags=t.flags),r}function P(t,l,e){var r,u=this,i=t.length;u.flags=H,u.items=t,u.length=i,u.key=function(){return null},u.diff={val:function(n,e){return l.val(t[n],e)},cmp:function(n,e){return l.cmp(e._diff,u.diff.val(n))}},u.tpl=function(n){return r(t[n],n)},u.map=function(n){return r=n,u},u.body=function(n){for(var e=[],t=0;t<i;t++){var l=u.tpl(t);l.type!=R&&(l._diff=u.diff.val(t,n)),e.push(l)}n.body=e,J(n)},null!=e&&(u.flags|=q,u.key=function(n){return e(t[n],n)}),d(l)&&(u.diff={val:function(n){return l(t[n])},cmp:function(n,e){return h(e._diff,u.diff.val(n))}})}function X(n,e,t){l(n,("refs."+e).split("."),t)}function z(n){while(n=n.parent)n.flags|=F}function G(n,e,t,l){if(n.type!==S&&n.type!==R){n.parent=e,n.idx=t,n.vm=l,null!=n.ref&&X(D(n),n.ref,n);var r=n.hooks,u=l&&l.hooks;(r&&(r.willRemove||r.didRemove)||u&&(u.willUnmount||u.didUnmount))&&z(n),s(n.body)?J(n):""===n.body?n.body=null:null==n.body||n.body instanceof P||(n.body=""+n.body)}}function J(n){for(var e=n.body,t=0;t<e.length;t++){var l=e[t];false===l||null==l?e.splice(t--,1):s(l)?r(e,l,t--,1):(null==l.type&&(e[t]=l=M(""+l)),l.type===o?null==l.body||""===l.body?e.splice(t--,1):0<t&&e[t-1].type===o?(e[t-1].body+=l.body,e.splice(t--,1)):G(l,n,t,null):G(l,n,t,null))}}function Q(n,e){return e}function W(n,e){var t=(n.attrs||f).style,l=e?(e.attrs||f).style:null;if(null==t||a(t))n.el.style.cssText=t;else{for(var r in t){var u=t[r];(null==l||null!=u&&u!==l[r])&&(n.el.style[r]=Q(0,u))}if(l)for(var i in l)null==t[i]&&(n.el.style[i]="")}}var Z=E,$=false;var nn={};function en(n){nn[n]||(nn[n]=true,ln(t,n,an,true))}function tn(n,e,t,l){n.removeEventListener(e.slice(2),t,l)}function ln(n,e,t,l){n.addEventListener(e.slice(2),t,l)}function rn(n,e,t,l,r){var u,i,a=n.apply(r,e.concat([t,l,r,r.data]));if(u=r.onevent(t,l,r,r.data,e),i=Z.call(null,t,l,r,r.data,e),false===a||false===u||false===i)return t.preventDefault(),t.stopPropagation(),false}function un(n,e){var t,l,r="on"+n,u=[];while(e)(l=e.attrs)&&(t=l[r])&&s(t)&&u.unshift(t),e=e.parent;return u}function an(n){var e=n.target._node;if(null!=e)for(var t=un(n.type,e),l=D(e),r=0;r<t.length;r++){if(false===rn(t[r][0],t[r].slice(1),n,e,l))break}}function on(n,e,t,l){if(t!=l){var r=n.el;d(t)?ln(r,e,t,false):null!=t&&en(e),d(l)&&tn(r,e,l,false)}}function fn(n,e,t){k(e)&&(e=e.substr(1),t=true),t?n.el[e]="":n.el.removeAttribute(e)}function sn(n,e,t,l){var r=n.el;null!=n.ns?r.setAttribute(e,t):"class"===e?r.className=t:"id"===e||"boolean"==typeof t||l?r[e]=t:"."===e[0]?r[e.substr(1)]=t:r.setAttribute(e,t)}function dn(n,e){var t=n.attrs||f,l=e.attrs||f;if(t===l);else{for(var r in t){var u=t[r];if(null!=u){var i=U(n.tag,r),a=i?n.el[r]:l[r];u===a||(N(r)?W(n,e):x(r)||(_(r)?on(n,r,u,a):sn(n,r,u,i)))}}for(var r in l)null==t[r]&&(_(r)?on(n,r,t[r],l[r]):x(r)||fn(n,r,U(n.tag,r)))}}function cn(n,e,t,l){return n.type===R&&(e=n.data,t=n.key,l=n.opts,n=n.view),new Kn(n,e,t,l)}var vn=[];function yn(n,e,t,l,r){if(null!=n){var u=t.hooks[e];if(u){if("d"!==e[0]||"i"!==e[1]||"d"!==e[2])return u(t,l);r?(V(t.parent),u(t,l)):vn.push([u,t,l])}}}function pn(n){if(vn.length){var e;V(n.node);while(e=vn.shift())e[0](e[1],e[2])}}function hn(n,e){return null!=e?t.createElementNS(e,n):t.createElement(n)}function wn(n){return t.createTextNode(n)}function mn(n){return t.createComment(n)}function bn(n){return n.nextSibling}function gn(n){var e=n.vm,t=null!=e&&yn(e.hooks,"willUnmount",e,e.data),l=yn(n.hooks,"willRemove",n);if((n.flags&F)===F&&s(n.body))for(var r=0;r<n.body.length;r++)gn(n.body[r]);return t||l}function kn(n,e){if(e){var t=n.vm;null!=t&&(t.node=t.refs=null)}var l=n.body;if(s(l))for(var r=0;r<l.length;r++)kn(l[r],true)}function _n(n,e,t){var l=e._node,r=l.vm;if(kn(l,true),(l.flags&F)===F)for(var u=0;u<l.body.length;u++)_n(e,l.body[u].el);delete e._node,n.removeChild(e),yn(l.hooks,"didRemove",l,null,t),null!=r&&(yn(r.hooks,"didUnmount",r,r.data,t),r.node=null)}function xn(n,e){var t=e._node;if(!t._dead){var l=gn(t);null!=l&&c(l)?(t._dead=true,l.then(m(_n,[n,e,true]))):_n(n,e)}}function Nn(n){var e=n.el;if(0==(n.flags&F))kn(n,false),e.textContent=null;else{var t=e.firstChild;if(null!=t)do{var l=bn(t);xn(e,t)}while(t=l)}}function An(n,e,t){var l=e._node,r=null!=e.parentNode,u=e!==t&&r?null:l.vm;null!=u&&yn(u.hooks,"willMount",u,u.data),yn(l.hooks,r?"willReinsert":"willInsert",l),n.insertBefore(e,t),yn(l.hooks,r?"didReinsert":"didInsert",l),null!=u&&yn(u.hooks,"didMount",u,u.data)}function Cn(n,e,t){An(n,e,t?bn(t):null)}function Rn(n){for(var e=0;e<n.body.length;e++){var t=n.body[e],l=t.type;if(l<=C)An(n.el,Sn(t));else if(l===R){l=(r=cn(t.view,t.data,t.key,t.opts)._redraw(n,e,false)).node.type,An(n.el,Sn(r.node))}else if(l===S){var r;(r=t.vm)._update(t.data,n,e),l=r.node.type,An(n.el,r.node.el)}}}function Sn(n,e){return null==n.el&&(n.type===A?(n.el=e||hn(n.tag,n.ns),null!=n.attrs&&dn(n,f),(n.flags&H)===H&&n.body.body(n),s(n.body)?Rn(n):null!=n.body&&(n.el.textContent=n.body)):n.type===o?n.el=e||wn(n.body):n.type===C&&(n.el=e||mn(n.body))),(n.el._node=n).el}function En(n){return n.parent}var Vn=1,jn=2;function Un(o,f,s,d,c,v,y,p){return function(n,e,t,l,r,u){var i,a;if(null!=l[d]){if(null==(i=l[d]._node))return void(l[d]=o(l[d]));if(En(i)!==n)return a=o(l[d]),null!=i.vm?i.vm.unmount(true):xn(e,l[d]),void(l[d]=a)}if(l[c]==r)return jn;if(null==l[c].el)s(e,Sn(l[c]),l[d]),l[c]=f(l[c],t);else if(l[c].el===l[d])l[c]=f(l[c],t),l[d]=o(l[d]);else{if(u||i!==l[y])return u&&null!=l[d]?Dn(o,f,s,d,c,e,t,i,l):Vn;a=l[d],l[d]=o(a),p(e,a,l[v]),l[v]=a}}}function Dn(n,e,t,l,r,u,i,a,o){if(a._lis)t(u,o[r].el,o[l]),o[r]=e(o[r],i);else{var f=g(a.idx,o.tombs);a._lis=true;var s=n(o[l]);t(u,o[l],null!=f?i[o.tombs[f]].el:f),null==f?o.tombs.push(a.idx):o.tombs.splice(f,0,a.idx),o[l]=s}}var In=Un(bn,function(n,e){return e[n.idx+1]},An,"lftSib","lftNode","rgtSib","rgtNode",Cn),Ln=Un(function(n){return n.previousSibling},function(n,e){return e[n.idx-1]},Cn,"rgtSib","rgtNode","lftSib","lftNode",An);function Mn(n,e){var t=e.body,l=n.el,r=n.body,u={lftNode:r[0],rgtNode:r[r.length-1],lftSib:(t[0]||f).el,rgtSib:(t[t.length-1]||f).el};n:while(1){while(1){var i=In(n,l,r,u,null,false);if(i===Vn)break;if(i===jn)break n}while(1){var a=Ln(n,l,r,u,u.lftNode,false);if(a===Vn)break;if(a===jn)break n}Tn(n,l,r,u);break}}function Tn(n,e,t,l){var r=[],u=e.firstChild;do{var i=u._node;i.parent===n&&r.push(i.idx)}while(u=bn(u));for(var a=b(r).map(function(n){return r[n]}),o=0;o<a.length;o++)t[a[o]]._lis=true;l.tombs=a;while(1){if(In(n,e,t,l,null,true)===jn)break}}function On(n){return n.el._node.parent!==n.parent}function Bn(n,e,t){return e[t]}function Fn(n,e,t){for(;t<e.length;t++){var l=e[t];if(null!=l.vm){if(n.type===R&&l.vm.view===n.view&&l.vm.key===n.key||n.type===S&&l.vm===n.vm)return l}else if(!On(l)&&n.tag===l.tag&&n.type===l.type&&n.key===l.key&&(n.flags&~F)==(l.flags&~F))return l}return null}function Yn(n,e,t){if(null==e._keys){if(e[t].key===n.key)return e[t];for(var l={},r=0;r<e.length;r++)l[e[r].key]=r;e._keys=l}return e[e._keys[n.key]]}function qn(n,e){yn(e.hooks,"willRecycle",e,n);var t=n.el=e.el,l=e.body,r=n.body;if((t._node=n).type!==o||r===l){null==n.attrs&&null==e.attrs||dn(n,e);var u=s(l),i=s(r),a=(n.flags&H)===H;u?i||a?Hn(n,e):r!==l&&(null!=r?t.textContent=r:Nn(e)):i?(Nn(e),Rn(n)):r!==l&&(null!=r&&null!=l?t.firstChild.nodeValue=r:t.textContent=r),yn(e.hooks,"didRecycle",e,n)}else t.nodeValue=r}function Hn(n,e){var t=n.body,l=t.length,r=e.body,u=r.length,i=(n.flags&H)===H,a=(n.flags&Y)===Y,o=(n.flags&q)===q,f=!a&&n.type===A,s=true,d=0===u?E:o?Yn:a||i?Bn:Fn;if(f&&0===l)return Nn(e),void(i&&(n.body=[]));var c,v,y=0,p=false,h=0;if(i)var w={key:null},m=n.body=Array(l);for(var b=0;b<l;b++){if(i){var g=false;s&&(o&&(w.key=t.key(b)),c=d(w,r,h)),null!=c?(v=c.idx,t.diff.cmp(b,c)?g=true:((k=c).parent=n,k.idx=b,k._lis=false)):g=true,g&&((k=t.tpl(b)).type===R?k=null!=c?c.vm._update(k.data,n,b).node:cn(k.view,k.data,k.key,k.opts)._redraw(n,b,false).node:(G(k,n,b),k._diff=t.diff.val(b,n),null!=c&&qn(k,c))),m[b]=k}else{var k,_=(k=t[b]).type;if(_<=C)(c=s&&d(k,r,h))&&(qn(k,c),v=c.idx);else if(_===R)(c=s&&d(k,r,h))?(v=c.idx,c.vm._update(k.data,n,b)):cn(k.view,k.data,k.key,k.opts)._redraw(n,b,false);else if(_===S){var x=k.vm,N=j(x);N&&x.node.parent!=e&&(x.unmount(true),N=false),x._update(k.data,n,b,N)}}if(null!=c&&(v===h?++h===u&&u<l&&(c=null,s=false):p=true,!o&&100<u&&p&&++y%10==0))while(h<u&&On(r[h]))h++}f&&Mn(n,e)}function Kn(n,e,t,l){var r=this;r.view=n,r.data=e,r.key=t,l&&(r.opts=l,r.config(l));var u=i(n)?n:n.call(r,r,e,t,l);d(u)?r.render=u:(r.render=u.render,r.config(u)),r.init&&r.init.call(r,r,r.data,r.key,l)}var Pn=Kn.prototype={constructor:Kn,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,refs:null,render:null,mount:function(n,e){var t=this;e?(Nn({el:n,flags:0}),t._redraw(null,null,false),n.nodeName.toLowerCase()!==t.node.tag?(Sn(t.node),An(n.parentNode,t.node.el,n),n.parentNode.removeChild(n)):An(n.parentNode,Sn(t.node,n),n)):(t._redraw(null,null),n&&An(n,t.node.el));n&&pn(t);return t},unmount:function(n){var e=this.node;xn(e.el.parentNode,e.el),e.el=null,n||pn(this)},config:function(n){var e=this;n.init&&(e.init=n.init),n.diff&&d(n.diff)&&(e.diff={val:n.diff,cmp:function(n,e,t){return h(e,t)}}),n.onevent&&(e.onevent=n.onevent),n.hooks&&(e.hooks=v(e.hooks||{},n.hooks))},parent:function(){return D(this.node.parent)},root:function(){var n=this.node;while(n.parent)n=n.parent;return n.vm},redraw:function(n){var e=this;return null==n&&(n=$),n?e._redraw(null,null,j(e)):(e._redrawAsync=e._redrawAsync||w(function(){return e.redraw(true)}))(),e},update:function(n,e){var t=this;return null==e&&(e=$),e?t._update(n,null,null,j(t)):(t._updateAsync=t._updateAsync||w(function(n){return t.update(n,true)}))(n),t},_update:function(n,e,t,l){var r=this;null!=n&&r.data!==n&&(yn(r.hooks,"willUpdate",r,n),r.data=n);return r._redraw(e,t,l)},_redraw:function(n,e,t){var l,r,u=null==n,i=this,a=i.node&&i.node.el&&i.node.el.parentNode,o=null!=i.diff,f=i.node;if(o&&(r=i.diff.val(i,i.data,i.key,n,e),null!=f&&(l=f._diff,!i.diff.cmp(i,l,r))))return Xn(i,f,n,e);a&&yn(i.hooks,"willRedraw",i,i.data);var s=i.render.call(i,i,i.data,i.key,n,e);o&&(s._diff=r);if(s===f)return Xn(i,f,n,e);(i.refs=null)!=i.key&&s.key!==i.key&&(s.key=i.key);i.node=s,n?(G(s,n,e,i),n.body[e]=s):f&&f.parent?(G(s,f.parent,f.idx,i),f.parent.body[f.idx]=s):G(s,null,null,i);if(false!==t)if(f)if(f.tag!==s.tag||f.key!==s.key){f.vm=s.vm=null;var d=f.el.parentNode,c=bn(f.el);xn(d,f.el),An(d,Sn(s),c),f.el=s.el,s.vm=i}else qn(s,f);else Sn(s);a&&yn(i.hooks,"didRedraw",i,i.data),u&&a&&pn(i);return i}};function Xn(n,e,t,l){return null!=t&&((t.body[l]=e).idx=l,e.parent=t,e._lis=false),n}function zn(n,e,t,l){var r,u;return null==t?i(e)?r=e:u=e:(r=e,u=t),K(n,r,u,l)}Pn._redrawAsync=Pn._updateAsync=null,Pn.onevent=E;function Gn(n,e,t,l){this.view=n,this.data=e,this.key=t,this.opts=l}function Jn(n,e){this.vm=n,this.data=e}function Qn(n,e,t){if(i(e)){var l=Object.create(n);l.attrs=v({},n.attrs),null!=e.class&&null!=n._class&&(e.class=n._class+" "+e.class);v(n.attrs,e);dn(n,l),t&&V(n)}else{if(null!=n.vm)return;G(e,n.parent,n.idx,null),qn(n.parent.body[n.idx]=e,n),t&&V(e),pn(D(e))}}Gn.prototype={constructor:Gn,type:R,view:null,data:null,key:null,opts:null},Jn.prototype={constructor:Jn,type:S,vm:null,data:null},L.patch=function(n,e){Qn(this,n,e)},n.ViewModel=Kn,n.VNode=I,n.createView=cn,n.defineElement=zn,n.defineSvgElement=function(n,e,t,l){var r=zn(n,e,t,l);return r.ns="http://www.w3.org/2000/svg",r},n.defineText=M,n.defineComment=function(n){var e=new I;return e.type=C,e.body=n,e},n.defineView=function(n,e,t,l){return new Gn(n,e,t,l)},n.injectView=function(n,e){return new Jn(n,e)},n.injectElement=function(n){var e=new I;return e.type=A,e.el=e.key=n,e},n.list=function(n,e,t){return new P(n,e,t)},n.FIXED_BODY=Y,n.KEYED_LIST=q,n.config=function(n){Z=n.onevent||Z,null!=n.syncRedraw&&($=n.syncRedraw)}});