// https://github.com/domvm/domvm (v3.4.7-dev, nano build)
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(n.domvm={})}(this,function(n){"use strict";var A=1,o=2,C=3,R=4,S=5,e="undefined"!=typeof window,t=e?document:{},u=(e?window:{}).requestAnimationFrame,f={};function E(){}var s=Array.isArray;function a(n){return null!=n&&n.constructor===Object}function r(n,e,t,l){n.splice.apply(n,[t,l].concat(e))}function i(n){var e=typeof n;return"string"===e||"number"===e}function d(n){return"function"==typeof n}function c(n){return"object"==typeof n&&d(n.then)}function v(n){for(var e=arguments,t=1;t<e.length;t++)for(var l in e[t])n[l]=e[t][l];return n}function l(n,e,t){var l;while(l=e.shift())0===e.length?n[l]=t:n[l]=n=n[l]||{}}function y(n,e){for(var t in n)if(n[t]!==e[t])return false;return true}function p(n,e){var t=n.length;if(e.length!==t)return false;for(var l=0;l<t;l++)if(n[l]!==e[l])return false;return true}function h(n){if(!u)return n;var e,t,l;function r(){e=0,n.apply(t,l)}return function(){t=this,l=arguments,e||(e=u(r))}}function w(n,e,t){return function(){return n.apply(t,e)}}function m(n){for(var e,t,l,r=n.slice(),u=[0],a=0,i=0;i<n.length;++i){var o=n[i];if(-1!==o)if(n[l=u[a]]<o)r[i]=l,u[++a]=i;else{e=0,t=a;while(e<t)n[u[l=(e+t)/2|0]]<o?e=l+1:t=l;o<n[u[e]]&&(0<e&&(r[i]=u[e-1]),u[e]=i)}}t=u[a];while(0<=a)t=r[u[a--]=t];return u}function b(n,e){var t,l=0,r=e.length-1;if(r<=2147483647)while(l<=r){if(e[t=l+r>>1]===n)return t;e[t]<n?l=t+1:r=t-1}else while(l<=r){if(e[t=Math.floor((l+r)/2)]===n)return t;e[t]<n?l=t+1:r=t-1}return l==e.length?null:l}function g(n){return"."===n[0]}function k(n){return"o"===n[0]&&"n"===n[1]}function _(n){return"_"===n[0]}function x(n){return"style"===n}function N(n){n&&n.el&&n.el.offsetHeight}function V(n){return null!=n.node&&null!=n.node.el}function j(n,e){switch(e){case"value":case"checked":case"selected":return true}return false}function U(n){n=n||f;while(null==n.vm&&n.parent)n=n.parent;return n.vm}function D(){}var I=D.prototype={constructor:D,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_diff:null,_dead:false,_lis:false,idx:null,parent:null};function L(n){var e=new D;return e.type=o,e.body=n,e}I._class=null;var M={},T=/\[(\w+)(?:=(\w+))?\]/g;function O(n){var e=M[n];if(null==e){var t,l,r,u;M[n]=e={tag:(t=n.match(/^[-\w]+/))?t[0]:"div",id:(l=n.match(/#([-\w]+)/))?l[1]:null,class:(r=n.match(/\.([-\w.]+)/))?r[1].replace(/\./g," "):null,attrs:null};while(u=T.exec(n))null==e.attrs&&(e.attrs={}),e.attrs[u[1]]=u[2]||""}return e}var B=1,F=2,Y=4,q=8;function H(n,e,t,l){var r=new D;r.type=A,r.flags=l||0,r.attrs=e||null;var u=O(n);n=u.tag;var a=null!=u.id,i=null!=u.class,o=null!=u.attrs;if(a||i||o){var f=r.attrs||{};if(a&&null==f.id&&(f.id=u.id),i&&(r._class=u.class,f.class=u.class+(null!=f.class?" "+f.class:"")),o)for(var s in u.attrs)null==f[s]&&(f[s]=u.attrs[s]);r.attrs=f}if(r.tag=n,null!=r.attrs){var d=r.attrs;null!=d._key&&(r.key=d._key),null!=d._ref&&(r.ref=d._ref),null!=d._hooks&&(r.hooks=d._hooks),null!=d._data&&(r.data=d._data),null!=d._flags&&(r.flags=d._flags),null==r.key&&(null!=r.ref?r.key=r.ref:null!=d.id?r.key=d.id:null!=d.name&&(r.key=d.name+("radio"===d.type||"checkbox"===d.type?d.value:"")))}return null!=t&&(r.body=t)instanceof K&&(r.flags=t.flags),r}function K(t,l,e){var r,u=this,a=t.length;u.flags=q,u.items=t,u.length=a,u.key=function(){return null},u.diff={val:function(n,e){return l.val(t[n],e)},cmp:function(n,e){return l.cmp(e._diff,u.diff.val(n))}},u.tpl=function(n){return r(t[n],n)},u.map=function(n){return r=n,u},u.body=function(n){for(var e=[],t=0;t<a;t++){var l=u.tpl(t);l.type!=R&&(l._diff=u.diff.val(t,n)),e.push(l)}n.body=e,G(n)},null!=e&&(u.flags|=Y,u.key=function(n){return e(t[n],n)}),d(l)&&(u.diff={val:function(n){return l(t[n])},cmp:function(n,e){var t=e._diff,l=u.diff.val(n),r=s(t)?p:y;return!(t===l||r(t,l))}})}function P(n,e,t){l(n,("refs."+e).split("."),t)}function X(n){while(n=n.parent)n.flags|=B}function z(n,e,t,l){if(n.type!==S&&n.type!==R){n.parent=e,n.idx=t,n.vm=l,null!=n.ref&&P(U(n),n.ref,n);var r=n.hooks,u=l&&l.hooks;(r&&(r.willRemove||r.didRemove)||u&&(u.willUnmount||u.didUnmount))&&X(n),s(n.body)?G(n):""===n.body?n.body=null:null==n.body||n.body instanceof K||(n.body=""+n.body)}}function G(n){for(var e=n.body,t=0;t<e.length;t++){var l=e[t];false===l||null==l?e.splice(t--,1):s(l)?r(e,l,t--,1):(null==l.type&&(e[t]=l=L(""+l)),l.type===o?null==l.body||""===l.body?e.splice(t--,1):0<t&&e[t-1].type===o?(e[t-1].body+=l.body,e.splice(t--,1)):z(l,n,t,null):z(l,n,t,null))}}function J(n,e){return e}function Q(n,e){var t=(n.attrs||f).style,l=e?(e.attrs||f).style:null;if(null==t||i(t))n.el.style.cssText=t;else{for(var r in t){var u=t[r];(null==l||null!=u&&u!==l[r])&&(n.el.style[r]=J(0,u))}if(l)for(var a in l)null==t[a]&&(n.el.style[a]="")}}var W=E,Z=false;var $={};function nn(n){$[n]||($[n]=true,tn(t,n,un,true))}function en(n,e,t,l){n.removeEventListener(e.slice(2),t,l)}function tn(n,e,t,l){n.addEventListener(e.slice(2),t,l)}function ln(n,e,t,l,r){var u,a,i=n.apply(r,e.concat([t,l,r,r.data]));if(u=r.onevent(t,l,r,r.data,e),a=W.call(null,t,l,r,r.data,e),false===i||false===u||false===a)return t.preventDefault(),t.stopPropagation(),false}function rn(n,e){var t,l,r="on"+n,u=[];while(e)(l=e.attrs)&&(t=l[r])&&s(t)&&u.unshift(t),e=e.parent;return u}function un(n){var e=n.target._node;if(null!=e)for(var t=rn(n.type,e),l=U(e),r=0;r<t.length;r++){if(false===ln(t[r][0],t[r].slice(1),n,e,l))break}}function an(n,e,t,l){if(t!=l){var r=n.el;d(t)?tn(r,e,t,false):null!=t&&nn(e),d(l)&&en(r,e,l,false)}}function on(n,e,t){g(e)&&(e=e.substr(1),t=true),t?n.el[e]="":n.el.removeAttribute(e)}function fn(n,e,t,l){var r=n.el;null!=n.ns?r.setAttribute(e,t):"class"===e?r.className=t:"id"===e||"boolean"==typeof t||l?r[e]=t:"."===e[0]?r[e.substr(1)]=t:r.setAttribute(e,t)}function sn(n,e){var t=n.attrs||f,l=e.attrs||f;if(t===l);else{for(var r in t){var u=t[r];if(null!=u){var a=j(n.tag,r),i=a?n.el[r]:l[r];u===i||(x(r)?Q(n,e):_(r)||(k(r)?an(n,r,u,i):fn(n,r,u,a)))}}for(var r in l)null==t[r]&&(k(r)?an(n,r,t[r],l[r]):_(r)||on(n,r,j(n.tag,r)))}}function dn(n,e,t,l){return n.type===R&&(e=n.data,t=n.key,l=n.opts,n=n.view),new Hn(n,e,t,l)}var cn=[];function vn(n,e,t,l,r){if(null!=n){var u=t.hooks[e];if(u){if("d"!==e[0]||"i"!==e[1]||"d"!==e[2])return u(t,l);r?(N(t.parent),u(t,l)):cn.push([u,t,l])}}}function yn(n){if(cn.length){var e;N(n.node);while(e=cn.shift())e[0](e[1],e[2])}}function pn(n,e){return null!=e?t.createElementNS(e,n):t.createElement(n)}function hn(n){return t.createTextNode(n)}function wn(n){return t.createComment(n)}function mn(n){return n.nextSibling}function bn(n){var e=n.vm,t=null!=e&&vn(e.hooks,"willUnmount",e,e.data),l=vn(n.hooks,"willRemove",n);if((n.flags&B)===B&&s(n.body))for(var r=0;r<n.body.length;r++)bn(n.body[r]);return t||l}function gn(n,e){if(e){var t=n.vm;null!=t&&(t.node=t.refs=null)}var l=n.body;if(s(l))for(var r=0;r<l.length;r++)gn(l[r],true)}function kn(n,e,t){var l=e._node,r=l.vm;if(gn(l,true),(l.flags&B)===B)for(var u=0;u<l.body.length;u++)kn(e,l.body[u].el);delete e._node,n.removeChild(e),vn(l.hooks,"didRemove",l,null,t),null!=r&&(vn(r.hooks,"didUnmount",r,r.data,t),r.node=null)}function _n(n,e){var t=e._node;if(!t._dead){var l=bn(t);null!=l&&c(l)?(t._dead=true,l.then(w(kn,[n,e,true]))):kn(n,e)}}function xn(n){var e=n.el;if(0==(n.flags&B))gn(n,false),e.textContent=null;else{var t=e.firstChild;if(null!=t)do{var l=mn(t);_n(e,t)}while(t=l)}}function Nn(n,e,t){var l=e._node,r=null!=e.parentNode,u=e!==t&&r?null:l.vm;null!=u&&vn(u.hooks,"willMount",u,u.data),vn(l.hooks,r?"willReinsert":"willInsert",l),n.insertBefore(e,t),vn(l.hooks,r?"didReinsert":"didInsert",l),null!=u&&vn(u.hooks,"didMount",u,u.data)}function An(n,e,t){Nn(n,e,t?mn(t):null)}function Cn(n){for(var e=0;e<n.body.length;e++){var t=n.body[e],l=t.type;if(l<=C)Nn(n.el,Rn(t));else if(l===R){l=(r=dn(t.view,t.data,t.key,t.opts)._redraw(n,e,false)).node.type,Nn(n.el,Rn(r.node))}else if(l===S){var r;(r=t.vm)._update(t.data,n,e),l=r.node.type,Nn(n.el,r.node.el)}}}function Rn(n,e){return null==n.el&&(n.type===A?(n.el=e||pn(n.tag,n.ns),null!=n.attrs&&sn(n,f),(n.flags&q)===q&&n.body.body(n),s(n.body)?Cn(n):null!=n.body&&(n.el.textContent=n.body)):n.type===o?n.el=e||hn(n.body):n.type===C&&(n.el=e||wn(n.body))),(n.el._node=n).el}function Sn(n){return n.parent}var En=1,Vn=2;function jn(o,f,s,d,c,v,y,p){return function(n,e,t,l,r,u){var a,i;if(null!=l[d]){if(null==(a=l[d]._node))return void(l[d]=o(l[d]));if(Sn(a)!==n)return i=o(l[d]),null!=a.vm?a.vm.unmount(true):_n(e,l[d]),void(l[d]=i)}if(l[c]==r)return Vn;if(null==l[c].el)s(e,Rn(l[c]),l[d]),l[c]=f(l[c],t);else if(l[c].el===l[d])l[c]=f(l[c],t),l[d]=o(l[d]);else{if(u||a!==l[y])return u&&null!=l[d]?Un(o,f,s,d,c,e,t,a,l):En;i=l[d],l[d]=o(i),p(e,i,l[v]),l[v]=i}}}function Un(n,e,t,l,r,u,a,i,o){if(i._lis)t(u,o[r].el,o[l]),o[r]=e(o[r],a);else{var f=b(i.idx,o.tombs);i._lis=true;var s=n(o[l]);t(u,o[l],null!=f?a[o.tombs[f]].el:f),null==f?o.tombs.push(i.idx):o.tombs.splice(f,0,i.idx),o[l]=s}}var Dn=jn(mn,function(n,e){return e[n.idx+1]},Nn,"lftSib","lftNode","rgtSib","rgtNode",An),In=jn(function(n){return n.previousSibling},function(n,e){return e[n.idx-1]},An,"rgtSib","rgtNode","lftSib","lftNode",Nn);function Ln(n,e){var t=e.body,l=n.el,r=n.body,u={lftNode:r[0],rgtNode:r[r.length-1],lftSib:(t[0]||f).el,rgtSib:(t[t.length-1]||f).el};n:while(1){while(1){var a=Dn(n,l,r,u,null,false);if(a===En)break;if(a===Vn)break n}while(1){var i=In(n,l,r,u,u.lftNode,false);if(i===En)break;if(i===Vn)break n}Mn(n,l,r,u);break}}function Mn(n,e,t,l){var r=[],u=e.firstChild;do{var a=u._node;a.parent===n&&r.push(a.idx)}while(u=mn(u));for(var i=m(r).map(function(n){return r[n]}),o=0;o<i.length;o++)t[i[o]]._lis=true;l.tombs=i;while(1){if(Dn(n,e,t,l,null,true)===Vn)break}}function Tn(n){return n.el._node.parent!==n.parent}function On(n,e,t){return e[t]}function Bn(n,e,t){for(;t<e.length;t++){var l=e[t];if(null!=l.vm){if(n.type===R&&l.vm.view===n.view&&l.vm.key===n.key||n.type===S&&l.vm===n.vm)return l}else if(!Tn(l)&&n.tag===l.tag&&n.type===l.type&&n.key===l.key&&(n.flags&~B)==(l.flags&~B))return l}return null}function Fn(n,e,t){if(null==e._keys){if(e[t].key===n.key)return e[t];for(var l={},r=0;r<e.length;r++)l[e[r].key]=r;e._keys=l}return e[e._keys[n.key]]}function Yn(n,e){vn(e.hooks,"willRecycle",e,n);var t=n.el=e.el,l=e.body,r=n.body;if((t._node=n).type!==o||r===l){null==n.attrs&&null==e.attrs||sn(n,e);var u=s(l),a=s(r),i=(n.flags&q)===q;u?a||i?qn(n,e):r!==l&&(null!=r?t.textContent=r:xn(e)):a?(xn(e),Cn(n)):r!==l&&(null!=r&&null!=l?t.firstChild.nodeValue=r:t.textContent=r),vn(e.hooks,"didRecycle",e,n)}else t.nodeValue=r}function qn(n,e){var t=n.body,l=t.length,r=e.body,u=r.length,a=(n.flags&q)===q,i=(n.flags&F)===F,o=(n.flags&Y)===Y,f=!i&&n.type===A,s=true,d=0===u?E:o?Fn:i||a?On:Bn;if(f&&0===l)return xn(e),void(a&&(n.body=[]));var c,v,y=0,p=false,h=0;if(a)var w={key:null},m=n.body=Array(l);for(var b=0;b<l;b++){if(a){var g=false;s&&(o&&(w.key=t.key(b)),c=d(w,r,h)),null!=c?(v=c.idx,t.diff.cmp(b,c)?g=true:((k=c).parent=n,k.idx=b,k._lis=false)):g=true,g&&((k=t.tpl(b)).type===R?k=null!=c?c.vm._update(k.data,n,b).node:dn(k.view,k.data,k.key,k.opts)._redraw(n,b,false).node:(z(k,n,b),k._diff=t.diff.val(b,n),null!=c&&Yn(k,c))),m[b]=k}else{var k,_=(k=t[b]).type;if(_<=C)(c=s&&d(k,r,h))&&(Yn(k,c),v=c.idx);else if(_===R)(c=s&&d(k,r,h))?(v=c.idx,c.vm._update(k.data,n,b)):dn(k.view,k.data,k.key,k.opts)._redraw(n,b,false);else if(_===S){var x=k.vm,N=V(x);N&&x.node.parent!=e&&(x.unmount(true),N=false),x._update(k.data,n,b,N)}}if(null!=c&&(v===h?++h===u&&u<l&&(c=null,s=false):p=true,!o&&100<u&&p&&++y%10==0))while(h<u&&Tn(r[h]))h++}f&&Ln(n,e)}function Hn(n,e,t,l){var r=this;r.view=n,r.data=e,r.key=t,l&&(r.opts=l,r.config(l));var u=a(n)?n:n.call(r,r,e,t,l);d(u)?r.render=u:(r.render=u.render,r.config(u)),r.init&&r.init.call(r,r,r.data,r.key,l)}var Kn=Hn.prototype={constructor:Hn,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,refs:null,render:null,mount:function(n,e){var t=this;e?(xn({el:n,flags:0}),t._redraw(null,null,false),n.nodeName.toLowerCase()!==t.node.tag?(Rn(t.node),Nn(n.parentNode,t.node.el,n),n.parentNode.removeChild(n)):Nn(n.parentNode,Rn(t.node,n),n)):(t._redraw(null,null),n&&Nn(n,t.node.el));n&&yn(t);return t},unmount:function(n){var e=this.node;_n(e.el.parentNode,e.el),e.el=null,n||yn(this)},config:function(n){var e=this;n.init&&(e.init=n.init),n.diff&&d(n.diff)&&(e.diff={val:n.diff,cmp:function(n,e,t){var l=s(e)?p:y;return!(e===t||l(e,t))}}),n.onevent&&(e.onevent=n.onevent),n.hooks&&(e.hooks=v(e.hooks||{},n.hooks))},parent:function(){return U(this.node.parent)},root:function(){var n=this.node;while(n.parent)n=n.parent;return n.vm},redraw:function(n){var e=this;return null==n&&(n=Z),n?e._redraw(null,null,V(e)):(e._redrawAsync=e._redrawAsync||h(function(){return e.redraw(true)}))(),e},update:function(n,e){var t=this;return null==e&&(e=Z),e?t._update(n,null,null,V(t)):(t._updateAsync=t._updateAsync||h(function(n){return t.update(n,true)}))(n),t},_update:function(n,e,t,l){var r=this;null!=n&&r.data!==n&&(vn(r.hooks,"willUpdate",r,n),r.data=n);return r._redraw(e,t,l)},_redraw:function(n,e,t){var l,r,u=null==n,a=this,i=a.node&&a.node.el&&a.node.el.parentNode,o=null!=a.diff,f=a.node;if(o&&(r=a.diff.val(a,a.data,a.key,n,e),null!=f&&(l=f._diff,!a.diff.cmp(a,l,r))))return Pn(a,f,n,e);i&&vn(a.hooks,"willRedraw",a,a.data);var s=a.render.call(a,a,a.data,a.key,n,e);o&&(s._diff=r);if(s===f)return Pn(a,f,n,e);(a.refs=null)!=a.key&&s.key!==a.key&&(s.key=a.key);a.node=s,n?(z(s,n,e,a),n.body[e]=s):f&&f.parent?(z(s,f.parent,f.idx,a),f.parent.body[f.idx]=s):z(s,null,null,a);if(false!==t)if(f)if(f.tag!==s.tag||f.key!==s.key){f.vm=s.vm=null;var d=f.el.parentNode,c=mn(f.el);_n(d,f.el),Nn(d,Rn(s),c),f.el=s.el,s.vm=a}else Yn(s,f);else Rn(s);i&&vn(a.hooks,"didRedraw",a,a.data),u&&i&&yn(a);return a}};function Pn(n,e,t,l){return null!=t&&((t.body[l]=e).idx=l,e.parent=t,e._lis=false),n}function Xn(n,e,t,l){var r,u;return null==t?a(e)?r=e:u=e:(r=e,u=t),H(n,r,u,l)}Kn._redrawAsync=Kn._updateAsync=null,Kn.onevent=E;function zn(n,e,t,l){this.view=n,this.data=e,this.key=t,this.opts=l}function Gn(n,e){this.vm=n,this.data=e}function Jn(n,e,t){if(a(e)){var l=Object.create(n);l.attrs=v({},n.attrs),null!=e.class&&null!=n._class&&(e.class=n._class+" "+e.class);v(n.attrs,e);sn(n,l),t&&N(n)}else{if(null!=n.vm)return;z(e,n.parent,n.idx,null),Yn(n.parent.body[n.idx]=e,n),t&&N(e),yn(U(e))}}zn.prototype={constructor:zn,type:R,view:null,data:null,key:null,opts:null},Gn.prototype={constructor:Gn,type:S,vm:null,data:null},I.patch=function(n,e){Jn(this,n,e)},n.ViewModel=Hn,n.VNode=D,n.createView=dn,n.defineElement=Xn,n.defineSvgElement=function(n,e,t,l){var r=Xn(n,e,t,l);return r.ns="http://www.w3.org/2000/svg",r},n.defineText=L,n.defineComment=function(n){var e=new D;return e.type=C,e.body=n,e},n.defineView=function(n,e,t,l){return new zn(n,e,t,l)},n.injectView=function(n,e){return new Gn(n,e)},n.injectElement=function(n){var e=new D;return e.type=A,e.el=e.key=n,e},n.list=function(n,e,t){return new K(n,e,t)},n.FIXED_BODY=F,n.KEYED_LIST=Y,n.config=function(n){W=n.onevent||W,null!=n.syncRedraw&&(Z=n.syncRedraw)}});