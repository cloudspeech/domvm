https://github.com/leeoniya/domvm
("object"===typeof module&&"object"===typeof module.exports&&function(g){module.exports=g()}||"function"===typeof define&&function(g){define("domvm",g)}||function(g){window.domvm=g()})(function(){function g(a){return Array.isArray(a)}function t(a){a=typeof a;return"string"==a||"number"==a}function F(a){function b(){c=0;a.apply(d,f)}if(!u.requestAnimationFrame)return a;var c,d,f;return function(){d=this;f=arguments;c||(c=u.requestAnimationFrame(b))}}function v(a,b,c){var d=null!==a.name;if(!c&&d)return null;
b=b||{};null!==a.ref&&a.el&&(b[a.ref]=a.el);g(a.body)&&a.body.forEach(function(a){v(a,b)});return b}function w(a){var b="";switch(a.type){case 1:b+="<"+a.tag;if(a.props)for(var c in a.props)null===a.props[c]||"."===c[0]||"value"!=c&&""===a.props[c]||(b+=" "+c+'="'+a.props[c]+'"');if(a.style){var d="";for(c in a.style)null!==a.style[c]&&(d+=c+": "+a.style[c]+";");b+=' style="'+d+'"'}if(a.svg&&"svg"!==a.tag&&!a.body)return b+"/>";b+=">";break;case 2:return a.body}G.test(a.tag)||(g(a.body)?a.body.forEach(function(a){b+=
w(a)}):b+=a.body||"",b+="</"+a.tag+">");return b}function q(a,b,c){g(a)&&(a=H(a));return m.call(null,a,b,c)}function H(a){return function(b,c,d){return{render:function(){return a}}}}function m(a,b,c){function d(){return{html:e,branch:h,refresh:k,mount:g,import:f}}function f(a){x(h,a);return d()}function e(){return w(h)}function g(a){n(h);a.appendChild(h.el);return d()}function r(){var e=m.apply(null,0==arguments.length?b||[]:arguments),e=y(e,!0,c||null);e.name=e.name||a.name||null;p.on&&(e.onEmit=
p.on);h&&z(h,e,!0);if(c){var f=c.body.indexOf(h);c.body[f]=e}h=e;setTimeout(function(){v(h,A,!0);l&&l()},0);return d()}var A={},k=q.useRaf?F(r):r,p=a(k,A,function(a){for(var b=c;b;){if(b.onEmit&&a in b.onEmit){var d=Array.prototype.slice.call(arguments,1);if(!1===b.onEmit[a].apply(null,d))break}b=c.parent}}),m=p.render,l=p.after,h=null;r();return d()}function y(a,b,c,d){if("function"==typeof a)return m(a,null,c).branch;if(g(a)&&"function"==typeof a[0])return m(a[0],a.slice(1),c).branch;a=I(a,d);d=
d||a.svg;b&&(a.parent=c||null,c=a);if(g(a.body)){var f={},e=!1;a.body=a.body.map(function(a,b){var g=y(a,!1,c,d);null!==g.key&&(f[g.key]=b,e=!0);return g});e&&(a.keyMap=f)}return a}function J(a){if(a in l)return l[a];var b={tag:null,id:null,class:null};b.tag=a.replace(/^([\w\-]+)?(?:#([\w\-]+))?((?:\.[\w\-]+)+)?$/,function(a,d,f,e){f&&(b.id=f);e&&(b.class=e.replace(/\./g," ").trim());return d||"div"});return l[a]=b}function I(a,b){var c={type:null,name:null,key:null,ref:null,tag:null,svg:!1,guard:!1,
dataset:null,style:null,props:null,on:null,onEmit:null,el:null,keyMap:null,body:null};if(g(a)&&a.length){c.type=1;switch(a.length){case 2:g(a[1])?c.body=a[1]:"object"==typeof a[1]?c.props=a[1]:c.body=a[1];break;case 3:c.props=a[1];c.body=a[2];break}var d=a[0];if(/[.#$!]/.test(d)){if(d=J(d),c.tag=d.tag,d.id||d.class)c.props=c.props||{},c.props.id=d.id,c.props.class=d.class}else c.tag=d;if(c.props){d=c.props;if("object"==typeof d.style){var f="",e;for(e in d.style)f+=e+":"+d.style[e]+";";d.style=f}d.on&&
(c.on=d.on);d.data&&(c.dataset=d.data);d._ref&&(c.ref=d._ref);d._key&&(c.key=d._key);d._name&&(c.name=d._name);d._guard&&(c.guard=d._guard);d.on=d.data=d._ref=d._key=d._name=d._guard=null}c.svg=b||"svg"==c.tag}else t(a)?(c.type=2,c.body=a):"object"==typeof a&&a.nodeType&&(c.type=1,c.el=a,c.tag=a.nodeName);return c}function n(a){1==a.type?(a.el||(a.el=a.svg?document.createElementNS("http://www.w3.org/2000/svg",a.tag):document.createElement(a.tag),a.props&&B(a)),g(a.body)?a.body.forEach(function(b){n(b);
a.el.appendChild(b.el)}):t(a.body)&&(a.el.textContent=a.body)):2==a.type&&(a.el=document.createTextNode(a.body))}function x(a,b){a.el=b;var c=b.children;if(g(a.body))for(var d=0;d<a.body.length;d++)x(a.body[d],c[d])}function C(a,b){return null!==b.key&&b.key===a.key||b.type===a.type&&(null!==b.tag&&b.tag===a.tag||null!==b.name&&b.name===a.name)}function K(a,b,c,d,f,e){if(null!==a.key&&c&&a.key in c)return b[c[a.key]];e=0===e?0:e||b.length-1;for(c=f||0;c<=e;c++)if(f=b[c],f.el&&C(f,a)&&(null===f.key||
!d||d&&!(f.key in d)))return f;return null}function z(a,b,c){if(c&&!C(a,b))throw"Cannot reuse dissimilar nodes";L(a,b);if(g(b.body)&&b.body.length)if(g(a.body)&&a.body.length)for(c=0;c<b.body.length;c++){var d=b.body[c],f=K(d,a.body,a.keyMap,b.keyMap);f?z(f,d):n(d)}else n(b);g(a.body)&&(a.body.forEach(function(a){a.el&&(a.el.parentNode&&a.el.parentNode.removeChild(a.el),a.el=null)}),a.body="");if(g(b.body)){var e=b.el.childNodes;b.body.forEach(function(a,c){e[c]!==a.el&&b.el.insertBefore(a.el,e[c])})}}
function L(a,b){b.el=a.el;a.el=null;B(b,a);var c=!g(b.body),d=!g(a.body);if(c&&b.body!==a.body)b.el.textContent=b.body;else if(d&&!c)for(;b.el.firstChild;)b.el.removeChild(b.el.firstChild)}function B(a,b){b=b||{};if(b.props||a.props){var c=b.props||{},d=a.props||{};a.svg?k(a.el,c,d,M,D):k(a.el,c,d,N,E)}(b.dataset||a.dataset)&&k(a.el,b.dataset||{},a.dataset||{},O,P);(b.on||a.on)&&k(a.el,b.on||{},a.on||{},Q,R)}function k(a,b,c,d,f){for(var e in c)null!==c[e]&&(e in b&&c[e]===b[e]||d(a,e,c[e]));for(e in b)null!==
b[e]&&(e in c||f(a,e,b[e]))}function Q(a,b,c){a["on"+b]=c}function R(a,b){a["on"+b]=""}function O(a,b,c){a.dataset[b]=c}function P(a,b){a.dataset[b]=""}function N(a,b,c){"."===b[0]?a[b.substr(1)]=c:""===c&&"value"!==b?E(a,b):a.setAttribute(b,c)}function E(a,b){"."===b[0]?a[b.substr(1)]=null:a.removeAttribute(b)}function M(a,b,c){""===c?D(a,b):a.setAttributeNS(null,b,c)}function D(a,b){a.removeAttributeNS(null,b)}var G=/^(?:img|br|input|col|link|meta|area|base|command|embed|hr|keygen|param|source|track|wbr)$/,
l={},u="undefined"==typeof window?{}:window;q.useRaf=!0;return q});
