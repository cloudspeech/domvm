https://github.com/leeoniya/domvm
("object"===typeof module&&"object"===typeof module.exports&&function(k){module.exports=k()}||"function"===typeof define&&function(k){define("domvm",k)}||function(k){window.domvm=k()})(function(){function k(){}function g(a){return Array.isArray(a)}function r(a){a=typeof a;return"string"==a||"number"==a}function E(a){function b(){c=0;a.apply(d,e)}if(!window.requestAnimationFrame)return a;var c,d,e;return function(){d=this;e=arguments;c||(c=requestAnimationFrame(b))}}function u(a,b,c){var d=null!==
a.name;if(!c&&d)return null;b=b||{};null!==a.ref&&a.el&&(b[a.ref]=a.el);g(a.body)&&a.body.forEach(function(a){u(a,b)});return b}function v(a){var b="";switch(a.type){case 1:b+="<"+a.tag;if(a.props)for(var c in a.props)null===a.props[c]||"value"!=c&&""===a.props[c]||(b+=" "+c+'="'+a.props[c]+'"');if(a.style){var d="";for(c in a.style)null!==a.style[c]&&(d+=c+": "+a.style[c]+";");b+=' style="'+d+'"'}if(a.svg&&!a.body)return b+"/>";b+=">";break;case 2:return a.body}F.test(a.tag)||(g(a.body)?a.body.forEach(function(a){b+=
v(a)}):b+=a.body||"",b+="</"+a.tag+">");return b}function p(a,b,c){function d(){return{html:f,branch:h,refresh:m,mount:g,import:e}}function e(a){w(h,a);return d()}function f(){return v(h)}function g(a){t(h);a.appendChild(h.el);return d()}function n(){var f=q.apply(null,0==arguments.length?b||[]:arguments),e=x(f,!0,c||null);e.name=a.name||l.name||null;null===e.key&&(e.key="key"in f?f.key:"key"in l?l.key:e.key||e.ref||null);l.on&&(e.onEmit=l.on);h&&y(h,e,!0);c&&(f=c.body.indexOf(h),c.body[f]=e);h=e;
setTimeout(function(){u(h,z,!0);r()},0);return d()}var z={},m=p.BENCH?n:E(n),l=a(m,z,function(a){for(var b=c;b;){if(b.onEmit&&a in b.onEmit){var d=Array.prototype.slice.call(arguments,1);if(!1===b.onEmit[a].apply(null,d))break}b=c.parent}}),q=l.render,r=l.after||k,h=null;n();return d()}function x(a,b,c,d){if("function"==typeof a)return p(a,null,c).branch;if(g(a)&&"function"==typeof a[0])return p(a[0],a.slice(1),c).branch;a=G(a,d);d=d||a.svg;b&&(a.parent=c||null,c=a);if(g(a.body)){var e={},f=!1;a.body=
a.body.map(function(a,b){var g=x(a,!1,c,d);null!==g.key&&(e[g.key]=b,f=!0);return g});f&&(a.keyMap=e)}return a}function H(a){if(a in q)return q[a];var b={tag:null,id:null,ref:null,guard:null,classes:null};b.tag=a.replace(/^([\w-]+)?(?:#([\w-]+))?((?:\.[\w-]+)+)?(?:([\$!])([\w-]+))?/,function(a,d,e,f,g,n){e&&(b.id=e);f&&(b.classes=f.replace(/\./g," ").trim());n&&(b.ref=n,"!"==g&&(b.guard=!0));return d||"div"});return q[a]=b}function G(a,b){var c={type:null,name:null,key:null,ref:null,tag:null,svg:!1,
guard:!1,dataset:null,style:null,props:null,on:null,onEmit:null,el:null,keyMap:null,body:null};if(g(a)&&a.length){c.type=1;switch(a.length){case 2:g(a[1])?c.body=a[1]:"object"==typeof a[1]?c.props=a[1]:c.body=a[1];break;case 3:c.props=a[1];c.body=a[2];break}var d=a[0];if(/[.#$!]/.test(d)){if(d=H(d),c.tag=d.tag,c.ref=d.ref,c.guard=d.guard,d.id||d.classes)c.props=c.props||{},c.props.id=d.id,c.props.class=d.classes}else c.tag=d;if(c.props){d=c.props;if("object"==typeof d.style){var e="",f;for(f in d.style)e+=
f+":"+d.style[f]+";";d.style=e}d.on&&(c.on=d.on);d.data&&(c.dataset=d.data);d._ref&&(c.ref=d._ref);d._key&&(c.key=d._key);d._name&&(c.name=d._name);d.on=d.data=d._ref=d._key=d._name=null}c.svg=b||"svg"==c.tag}else r(a)?(c.type=2,c.body=a):"object"==typeof a&&a.nodeType&&(c.type=1,c.el=a,c.tag=a.nodeName);return c}function t(a){1==a.type?(a.el||(a.el=a.svg?document.createElementNS("http://www.w3.org/2000/svg",a.tag):document.createElement(a.tag),a.props&&A(a)),g(a.body)?a.body.forEach(function(b){t(b);
a.el.appendChild(b.el)}):r(a.body)&&(a.el.textContent=a.body)):2==a.type&&(a.el=document.createTextNode(a.body))}function w(a,b){a.el=b;var c=b.children;if(g(a.body))for(var d=0;d<a.body.length;d++)w(a.body[d],c[d])}function B(a,b){return null!==b.key&&b.key===a.key||b.type===a.type&&(null!==b.tag&&b.tag===a.tag||null!==b.name&&b.name===a.name)}function I(a,b,c,d,e,f){if(null!==a.key&&c&&a.key in c)return b[c[a.key]];f=0===f?0:f||b.length-1;for(c=e||0;c<=f;c++)if(e=b[c],e.el&&B(e,a)&&(null===e.key||
!d||d&&!(e.key in d)))return e;return null}function y(a,b,c){if(c&&!B(a,b))throw"Cannot reuse dissimilar nodes";J(a,b);if(g(b.body)&&b.body.length)if(g(a.body)&&a.body.length)for(c=0;c<b.body.length;c++){var d=b.body[c],e=I(d,a.body,a.keyMap,b.keyMap);e?y(e,d):t(d)}else t(b);g(a.body)&&(a.body.forEach(function(a){a.el&&(a.el.parentNode&&a.el.parentNode.removeChild(a.el),a.el=null)}),a.body="");if(g(b.body)){var f=b.el.childNodes;b.body.forEach(function(a,c){f[c]!==a.el&&b.el.insertBefore(a.el,f[c])})}}
function J(a,b){b.el=a.el;a.el=null;A(b,a);var c=!g(b.body),d=!g(a.body);if(c&&b.body!==a.body)b.el.textContent=b.body;else if(d&&!c)for(;b.el.firstChild;)b.el.removeChild(b.el.firstChild)}function A(a,b){b=b||{};if(b.props||a.props){var c=b.props||{},d=a.props||{};a.svg?m(a.el,c,d,K,C):m(a.el,c,d,L,D)}(b.dataset||a.dataset)&&m(a.el,b.dataset||{},a.dataset||{},M,N);(b.on||a.on)&&m(a.el,b.on||{},a.on||{},O,P)}function m(a,b,c,d,e){for(var f in c)null!==c[f]&&(f in b&&c[f]===b[f]||d(a,f,c[f]));for(f in b)null!==
b[f]&&(f in c||e(a,f,b[f]))}function O(a,b,c){a["on"+b]=c}function P(a,b){a["on"+b]=""}function M(a,b,c){a.dataset[b]=c}function N(a,b){a.dataset[b]=""}function L(a,b,c){"."===b[0]?a[b.substr(1)]=c:""===c&&"value"!==b?D(a,b):a.setAttribute(b,c)}function D(a,b){"."===b[0]?a[b.substr(1)]=null:a.removeAttribute(b)}function K(a,b,c){""===c?C(a,b):a.setAttributeNS(null,b,c)}function C(a,b){a.removeAttributeNS(null,b)}var F=/^(?:img|br|input|col|link|meta|area|base|command|embed|hr|keygen|param|source|track|wbr)$/,
q={};p.BENCH=!1;return p});
