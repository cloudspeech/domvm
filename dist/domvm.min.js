https://github.com/leeoniya/domvm
("object"===typeof module&&"object"===typeof module.exports&&function(m){module.exports=m()}||"function"===typeof define&&function(m){define("domvm",m)}||function(m){window.domvm=m()})(function(){function m(){}function g(a){return Array.isArray(a)}function r(a){a=typeof a;return"string"==a||"number"==a}function h(a){return"object"==typeof a}function E(a){function b(){c=0;a.apply(d,e)}if(!window.requestAnimationFrame)return a;var c,d,e;return function(){d=this;e=arguments;c||(c=requestAnimationFrame(b))}}
function v(a,b,c){var d=null!==a.name;if(!c&&d)return null;b=b||{};null!==a.ref&&a.el&&(b[a.ref]=a.el);g(a.body)&&a.body.forEach(function(a){v(a,b)});return b}function w(a){var b="";switch(a.type){case 1:b+="<"+a.tag;if(a.props)for(var c in a.props)null===a.props[c]||"value"!=c&&""===a.props[c]||(b+=" "+c+'="'+a.props[c]+'"');if(a.style){var d="";for(c in a.style)null!==a.style[c]&&(d+=c+": "+a.style[c]+";");b+=' style="'+d+'"'}if(a.svg&&!a.body)return b+"/>";b+=">";break;case 2:return a.body}F.test(a.tag)||
(g(a.body)?a.body.forEach(function(a){b+=w(a)}):b+=a.body||"",b+="</"+a.tag+">");return b}function p(a,b,c){function d(){return{html:f,branch:k,refresh:l,mount:g,import:e}}function e(a){x(k,a);return d()}function f(){return w(k)}function g(a){t(k);a.appendChild(k.el);return d()}function u(){var f=q.apply(null,0==arguments.length?b||[]:arguments),e=y(f,!0,c||null);e.name=a.name||n.name||null;null===e.key&&(e.key="key"in f?f.key:"key"in n?n.key:e.key||e.ref||null);n.on&&(e.onEmit=n.on);k&&z(k,e,!0);
c&&(f=c.body.indexOf(k),c.body[f]=e);k=e;setTimeout(function(){v(k,h,!0);r()},0);return d()}var h={},l=p.BENCH?u:E(u),n=a(l,h,function(a){for(var b=c;b;){if(b.onEmit&&a in b.onEmit){var d=Array.prototype.slice.call(arguments,1);if(!1===b.onEmit[a].apply(null,d))break}b=c.parent}}),q=n.render,r=n.after||m,k=null;u();return d()}function y(a,b,c,d){if("function"==typeof a)return p(a,null,c).branch;if(g(a)&&"function"==typeof a[0])return p(a[0],a.slice(1),c).branch;a=G(a,d);d=d||a.svg;b&&(a.parent=c||
null,c=a);if(g(a.body)){var e={},f=!1;a.body=a.body.map(function(a,b){var g=y(a,!1,c,d);null!==g.key&&(e[g.key]=b,f=!0);return g});f&&(a.keyMap=e)}return a}function H(a){if(a in q)return q[a];var b={tag:null,id:null,ref:null,guard:null,classes:null};b.tag=a.replace(/^([\w-]+)?(?:#([\w-]+))?((?:\.[\w-]+)+)?(?:([\$!])([\w-]+))?/,function(a,d,e,f,g,h){e&&(b.id=e);f&&(b.classes=f.replace(/\./g," ").trim());h&&(b.ref=h,"!"==g&&(b.guard=!0));return d||"div"});return q[a]=b}function G(a,b){var c={type:null,
name:null,key:null,ref:null,tag:null,svg:!1,guard:!1,id:null,dataset:null,style:null,props:null,on:null,onEmit:null,el:null,keyMap:null,body:null};if(g(a)&&a.length){c.type=1;switch(a.length){case 2:g(a[1])?c.body=a[1]:h(a[1])?c.props=a[1]:c.body=a[1];break;case 3:c.props=a[1];c.body=a[2];break}var d=a[0];/[.#$!]/.test(d)?(d=H(d),c.tag=d.tag,c.ref=d.ref,c.guard=d.guard,c.id=d.id,d.classes&&(c.props=c.props||{},c.props.class=d.classes)):c.tag=d;c.props&&"key"in c.props&&(c.key=c.props.key,c.props.key=
null);c.svg=b||"svg"==c.tag}else r(a)?(c.type=2,c.body=a):h(a)&&a.nodeType&&(c.type=1,c.el=a,c.tag=a.nodeName);return c}function t(a){1==a.type?(a.el||(a.el=a.svg?document.createElementNS("http://www.w3.org/2000/svg",a.tag):document.createElement(a.tag),a.props&&A(a)),g(a.body)?a.body.forEach(function(b){t(b);a.el.appendChild(b.el)}):r(a.body)&&(a.el.textContent=a.body)):2==a.type&&(a.el=document.createTextNode(a.body))}function x(a,b){a.el=b;var c=b.children;if(g(a.body))for(var d=0;d<a.body.length;d++)x(a.body[d],
c[d])}function B(a,b){return null!==b.key&&b.key===a.key||b.type===a.type&&(null!==b.tag&&b.tag===a.tag||null!==b.name&&b.name===a.name)}function I(a,b,c,d,e,f){if(null!==a.key&&c&&a.key in c)return b[c[a.key]];f=0===f?0:f||b.length-1;for(c=e||0;c<=f;c++)if(e=b[c],e.el&&B(e,a)&&(null===e.key||!d||d&&!(e.key in d)))return e;return null}function z(a,b,c){if(c&&!B(a,b))throw"Cannot reuse dissimilar nodes";J(a,b);if(g(b.body)&&b.body.length)if(g(a.body)&&a.body.length)for(c=0;c<b.body.length;c++){var d=
b.body[c],e=I(d,a.body,a.keyMap,b.keyMap);e?z(e,d):t(d)}else t(b);g(a.body)&&(a.body.forEach(function(a){a.el&&(a.el.parentNode&&a.el.parentNode.removeChild(a.el),a.el=null)}),a.body="");if(g(b.body)){var f=b.el.childNodes;b.body.forEach(function(a,c){f[c]!==a.el&&b.el.insertBefore(a.el,f[c])})}}function J(a,b){b.el=a.el;a.el=null;A(b,a);var c=!g(b.body),d=!g(a.body);if(c&&b.body!==a.body)b.el.textContent=b.body;else if(d&&!c)for(;b.el.firstChild;)b.el.removeChild(b.el.firstChild)}function A(a,b){b=
b||{};a.id&&a.id!==b.id&&(a.el.id=a.id);if(b.props||a.props){var c=b.props||{},d=a.props||{};if(h(c.style)||h(d.style))l(a.el,c.style||{},d.style||{},K,L),a.style=d.style,c.style=null,d.style=null;if(h(c.data)||h(d.data))l(a.el,c.data||{},d.data||{},M,N),a.dataset=d.data,c.data=null,d.data=null;if(c.on||d.on)l(a.el,c.on||{},d.on||{},O,P),a.on=d.on,c.on=null,d.on=null;a.svg?l(a.el,c,d,Q,C):l(a.el,c,d,R,D)}}function l(a,b,c,d,e){for(var f in c)null!==c[f]&&(f in b&&c[f]===b[f]||d(a,f,c[f]));for(f in b)null!==
b[f]&&(f in c||e(a,f,b[f]))}function O(a,b,c){a["on"+b]=c}function P(a,b){a["on"+b]=""}function M(a,b,c){a.dataset[b]=c}function N(a,b){a.dataset[b]=""}function K(a,b,c){a.style[b]=c}function L(a,b){a.style[b]=""}function R(a,b,c){"."===b[0]?a[b.substr(1)]=c:""===c&&"value"!==b?D(a,b):a.setAttribute(b,c)}function D(a,b){"."===b[0]?a[b.substr(1)]=null:a.removeAttribute(b)}function Q(a,b,c){""===c?C(a,b):a.setAttributeNS(null,b,c)}function C(a,b){a.removeAttributeNS(null,b)}var F=/^(?:img|br|input|col|link|meta|area|base|command|embed|hr|keygen|param|source|track|wbr)$/,
q={};p.BENCH=!1;return p});
