// https://github.com/leeoniya/domvm
("object"===typeof module&&"object"===typeof module.exports&&function(n){module.exports=n()}||"function"===typeof define&&function(n){define("domvm",n)}||function(n){window.domvm=n()})(function(){function n(a,b,c,e,d,f,h){function g(a,b,c){f&&(f.body[h]=null);f=a;h=b;return m(c,!1)}function m(a,e){d=a||d;var g=l.node,v=l.view[3].render.apply(b,d),k=A(v,f,h,l);k.key=p(c)?c:k.key;k.vm=l;l.node=k;if((v=g)&&(k.type!==g.type||k.tag!==g.tag))var v=null,m=!0;B(k,v);f&&(f.body[h]=k);!1!==e&&(g&&w(g),!g&&
t||x(k),m&&(g.el.parentNode.replaceChild(k.el,g.el),g.el=null));setTimeout(function(){l.refs={};C(k,l);var a=l.view[3].after;a&&a.apply(null,void 0)},0);return l}function r(a){var b=null,c=a.split(":");2==c.length&&(a=c[0],b=+c[1]);var c=Array.prototype.slice.call(arguments,1),d=l.node;if(null!==b){for(;b&&d.parent;)d=d.parent,d.vm&&b--;(b=(b=d.vm?d.vm.view[3].on:null)?b[a]:null)&&b.apply(null,c)}else for(;d&&(!d.vm||!(b=(b=d.vm.view[3].on)?b[a]:null)||!1!==b.apply(null,c));)d=d.parent}var t=!f;k(a)&&
(b=a[1],c=a[2],d=a[4],a=a[0]);var l={node:null,view:[a,b,c],redraw:n.useRaf?J(m):m,emit:r,refs:{},html:function(){return D(l.node)},mount:function(a){x(l.node);a.insertBefore(l.node.el,null);return l},attach:function(a){E(l.node,a);return l},destroy:function(a){if(f)if(a){for(a=h+1;a<f.body.length;a++){var b=f.body[a];b.idx=a-1;b.vm&&b.vm.updIdx(b.idx)}f.body.splice(h,1)}else f.body[h]=null;w(l.node,!0);l.node.vm=null;(a=l.view[3].cleanup)&&a.apply(null,void 0)},moveTo:g,updIdx:function(a){h=a},wrapHandler:function(a,
c){var d=p(c)?function(a){return a.target.matches(c)}:q(c)?c:null,e=function(e){c&&!d(e)||!1!==a.call(b,e)||(e.preventDefault(),e.stopPropagation());switch(n.autoRedraw){case 2:m();break;case 1:r.redraw()}};e._fn=a;return e}};a=a.call(b,l,b,c);a=q(a)?{render:a}:a;a.on=a.on||{};a.on._redraw=m;l.view[3]=a;r.create=function(){var a=arguments;return function(){r.apply(null,a)}};r.redraw=function(a){a=p(a)?a:1E3;r("_redraw:"+a)};return f?g(f,h,d):m(d)}function E(a,b){a.el=b;if(k(a.body))for(var c=0;c<
a.body.length;c++){var e=a.body[c];e&&2===e.type&&""===e.body&&b.insertBefore(document.createTextNode(""),b.childNodes[c]||null);E(e,b.childNodes[c])}}function w(a,b){k(a.body)&&(a.body.forEach(function(a,b){a&&(a.vm?a.vm.destroy():a.el&&a.el.parentNode?a.el.parentNode.removeChild(a.el):w(a))}),a.body=null);b&&a.el&&(a.el.parentNode.removeChild(a.el),a.el=null)}function A(a,b,c,e){var d={type:null,name:null,key:null,ref:null,idx:null,parent:null,tag:null,ns:null,guard:!1,props:null,on:null,el:null,
keyMap:null,body:null};if(k(a)&&a.length){d.type=1;switch(a.length){case 2:k(a[1])?d.body=a[1]:t(a[1])?d.props=a[1]:d.body=a[1];break;case 3:d.props=a[1],d.body=a[2]}a=a[0];if(/[.#]/.test(a)){if(a=K(a),d.tag=a.tag,a.id||a.class)d.props=d.props||{},d.props.id=a.id,d.props.class=a.class}else d.tag=a;if(d.props){a=d.props;for(var f in a)u(f)?a[f]=q(a[f])?e.wrapHandler(a[f]):k(a[f])?e.wrapHandler(a[f][0],a[f][1]):null:q(a[f])&&(a[f]=a[f]());if(t(a.style))for(var h in a.style)f=a.style[h],q(f)&&(a.style[h]=
f());d.key=p(a._key)?a._key:p(a._ref)?a._ref:p(a.id)?a.id:p(a.name)?a.name:null;a._ref&&(d.ref=a._ref);a._name&&(d.name=a._name);a._guard&&(d.guard=a._guard);a._ref=a._key=a._name=a._guard=null}}else p(a)&&(d.type=2,d.body=a);d.parent=b;d.idx=c;d.ns=b&&b.ns?b.ns:"svg"===d.tag||"math"===d.tag?d.tag:null;if(k(d.body)){b={};c=!1;h=0;for(var g=d.body.length;h<g;h++){f=d.body[h];var m=null;a=null;k(f)&&k(f[0])&&(g=d.body,g.splice.apply(g,[h,1].concat(f)),g=d.body.length,f=d.body[h]);q(f)&&(f=[f]);k(f)&&
q(f[0])?m=f[2]:(a=A(f,d,h,e),m=a.key);p(m)&&(b[m]=h,c=!0);d.body[h]=a||f}c&&(d.keyMap=b)}return d}function B(a,b){b&&L(b,a);k(a.body)&&a.body.forEach(function(c,e){var d=k(c);if(b){var f=M(c,a,b);if(null!==f){var h=f[1],f=b.body[f[0]];d&&f.vm?2===h?f.vm.moveTo(a,e,c[3]):1===h&&n.apply(null,[c[0],c[1],c[2],c[3],c[4],a,e]):a.body[e]=B(c,f);return}}d&&n.apply(null,[c[0],c[1],c[2],c[3],c[4],a,e])});return a}function x(a){var b=!a.el;1==a.type?(b&&(a.el=a.ns?y.createElementNS(N[a.ns],a.tag):y.createElement(a.tag),
a.vm&&(a.el._vm=a.vm),a.props&&F(a)),k(a.body)?a.body.forEach(function(a,b){x(a)}):b&&p(a.body)&&(a.el.textContent=a.body)):2==a.type&&b&&(a.el=y.createTextNode(a.body));(b=a.parent)&&b.el&&b.el.childNodes[a.idx]!==a.el&&b.el.insertBefore(a.el,b.el.childNodes[a.idx])}function M(a,b,c,e,d){var f=k(a),h=f?a[2]||null:a.key,g=c.keyMap,m=b.keyMap;c=c.body;b=b.body;if(null!==h&&g&&p(g[h]))return[g[h],2];e=e||0;if(e>c.length-1)return null;d=0===d?0:d||c.length-1;for(h=null;e<=d;e++)if(g=c[e],null!==g&&g.el)if(f&&
g.vm){if(g.vm.view[0]===a[0]){if(g.vm.view[1]===a[1])return[e,2];var r=!1;if(n.viewScan)for(var q=0;q<b.length;q++){var l=b[q];if(!l.el&&l.vm&&l.vm.view[0]===g.vm.view[0]&&l.vm.view[1]===g.vm.view[1]){r=!0;break}}r||h||!m||p(m[g.key])||(h=[e,1])}}else if(!(a.type!==g.type||2!==a.type&&(null===a.tag||a.tag!==g.tag)||null!==g.key&&m&&p(m[g.key])))return[e,1];return h}function L(a,b){b.el=a.el;a.el=null;if(2===b.type&&b.body!==a.body)b.el.nodeValue=b.body;else{F(b,a);var c=!k(b.body),e=!k(a.body);c&&
b.body!==a.body?e&&b.el.firstChild?b.el.firstChild.nodeValue=b.body:b.el.textContent=b.body:e&&!c&&(b.el.textContent="")}}function K(a){if(a in z)return z[a];var b={tag:null,id:null,class:null};b.tag=a.replace(/^([\w\-]+)?(?:#([\w\-]+))?((?:\.[\w\-]+)+)?$/,function(a,e,d,f){d&&(b.id=d);f&&(b.class=f.replace(/\./g," ").trim());return e||"div"});return z[a]=b}function u(a){return"on"===a.substr(0,2)}function F(a,b){var c=!b;b=b||{};if(b.props||a.props){var e=b.props||{},d=a.props||{},f=e.style,h=d.style;
if(t(f)||t(h))G(a.el,f||{},h||{},O,P,a.ns,c),e.style=d.style=null;G(a.el,e,d,Q,H,a.ns,c);h&&(d.style=h)}}function G(a,b,c,e,d,f,h){for(var g in c)null!==c[g]&&(g in b&&(u(g)?c[g]._fn===b[g]._fn:c[g]===b[g])||e(a,g,c[g],f,h));for(g in b)null!==b[g]&&(g in c||d(a,g,f,h))}function O(a,b,c){a.style[b]=c}function P(a,b){a.style[b]=""}function Q(a,b,c,e,d){"."===b[0]?(b=b.substr(1),"svg"===e?a[b].baseVal=c:a[b]=c):"class"===b?a.className=c:"id"===b||u(b)?a[b]=c:!1===c?H(a,b,e,d):(!0===c&&(c=""),e?a.setAttributeNS(null,
b,c):a.setAttribute(b,c))}function H(a,b,c,e){e||("."===b[0]?(b=b.substr(1),"svg"===c?a[b].baseVal=null:a[b]=null):"class"===b?a.className="":"id"===b||u(b)?a[b]=null:c?a.removeAttributeNS(null,b):a.removeAttribute(b))}function C(a,b){var c=(a.vm||b).refs;null!==a.ref&&a.el&&(c[a.ref]=a.el);k(a.body)&&a.body.forEach(function(c){C(c,a.vm||b)})}function D(a){var b="";switch(a.type){case 1:b+="<"+a.tag;if(a.props){var c=p(a.props.style)?a.props.style:"",e=t(a.props.style)?a.props.style:null;if(e)for(var d in e)null!==
e[d]&&(c+=d.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+": "+e[d]+";");for(d in a.props)u(d)||(e=a.props[d],q(e)&&(e=e()),t(e)||(!0===e?b+=" "+d:!1!==e&&null!==e&&"."!==d[0]&&(b+=" "+d+'="'+e+'"')));c.length&&(b+=' style="'+c+'"')}if(a.ns&&"svg"!==a.tag&&"math"!==a.tag&&!a.body)return b+"/>";b+=">";break;case 2:return a.body}R.test(a.tag)||(k(a.body)?a.body.forEach(function(a){b+=D(a)}):b+=a.body||"",b+="</"+a.tag+">");return b}function k(a){return Array.isArray(a)}function p(a){var b=typeof a;
return"string"===b||"number"===b&&!isNaN(a)&&Infinity!==a}function t(a){return"[object Object]"===Object.prototype.toString.call(a)}function q(a){return"function"===typeof a}function J(a){function b(){c=0;a.apply(e,d)}if(!I.requestAnimationFrame)return a;var c,e,d;return function(){e=this;d=arguments;c||(c=I.requestAnimationFrame(b))}}var N={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},R=/^(?:img|br|input|col|link|meta|area|base|command|embed|hr|keygen|param|source|track|wbr)$/,
z={},I="undefined"==typeof window?{}:window,y=document;n.viewScan=!1;n.useRaf=!0;n.autoRedraw=0;return n});
