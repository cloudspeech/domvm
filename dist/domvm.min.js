https://github.com/leeoniya/domvm
("object"===typeof module&&"object"===typeof module.exports&&function(e){module.exports=e()}||"function"===typeof define&&function(e){define("domvm",e)}||function(e){window.domvm=e()})(function(){function e(a){return Array.isArray(a)}function t(a){a=typeof a;return"string"==a||"number"==a}function E(a){function b(){c=0;a.apply(d,f)}if(!u.requestAnimationFrame)return a;var c,d,f;return function(){d=this;f=arguments;c||(c=u.requestAnimationFrame(b))}}function v(a,b,c){var d=null!==a.name;if(!c&&d)return null;
b=b||{};null!==a.ref&&a.el&&(b[a.ref]=a.el);e(a.body)&&a.body.forEach(function(a){v(a,b)});return b}function w(a){var b="";switch(a.type){case 1:b+="<"+a.tag;if(a.props)for(var c in a.props){var d=a.props[c];!0===d?b+=" "+c:!1!==d&&null!==d&&"."!==c[0]&&(b+=" "+c+'="'+d+'"')}if(a.style){d="";for(c in a.style)null!==a.style[c]&&(d+=c+": "+a.style[c]+";");b+=' style="'+d+'"'}if(a.svg&&"svg"!==a.tag&&!a.body)return b+"/>";b+=">";break;case 2:return a.body}F.test(a.tag)||(e(a.body)?a.body.forEach(function(a){b+=
w(a)}):b+=a.body||"",b+="</"+a.tag+">");return b}function r(a,b,c){e(a)&&(a=G(a));return l.call(null,a,b,c)}function G(a){return function(b,c,d){return{render:function(){return a}}}}function l(a,b,c){function d(){return{html:g,branch:k,refresh:l,mount:h,import:f}}function f(a){x(k,a);return d()}function g(){return w(k)}function h(a){p(k);a.appendChild(k.el);return d()}function e(){var f=n.apply(null,0==arguments.length?b||[]:arguments),f=y(f,!0,c||null);f.name=f.name||a.name||null;q.on&&(f.onEmit=
q.on);k&&z(k,f,!0);if(c){var g=c.body.indexOf(k);c.body[g]=f}k=f;setTimeout(function(){v(k,A,!0);m&&m()},0);return d()}var A={},l=r.useRaf?E(e):e,q=a(l,A,function(a){for(var b=c;b;){if(b.onEmit&&a in b.onEmit){var d=Array.prototype.slice.call(arguments,1);if(!1===b.onEmit[a].apply(null,d))break}b=c.parent}}),n=q.render,m=q.after,k=null;e();return d()}function y(a,b,c,d){if("function"==typeof a)return l(a,null,c).branch;if(e(a)&&"function"==typeof a[0])return l(a[0],a.slice(1),c).branch;a=H(a,d);d=
d||a.svg;b&&(a.parent=c||null,c=a);if(e(a.body)){var f={},g=!1;a.body=a.body.map(function(a,b){var e=y(a,!1,c,d);null!==e.key&&(f[e.key]=b,g=!0);return e});g&&(a.keyMap=f)}return a}function I(a){if(a in n)return n[a];var b={tag:null,id:null,class:null};b.tag=a.replace(/^([\w\-]+)?(?:#([\w\-]+))?((?:\.[\w\-]+)+)?$/,function(a,d,f,e){f&&(b.id=f);e&&(b.class=e.replace(/\./g," ").trim());return d||"div"});return n[a]=b}function H(a,b){var c={type:null,name:null,key:null,ref:null,tag:null,svg:!1,guard:!1,
dataset:null,style:null,props:null,on:null,onEmit:null,el:null,keyMap:null,body:null};if(e(a)&&a.length){c.type=1;switch(a.length){case 2:e(a[1])?c.body=a[1]:"object"==typeof a[1]?c.props=a[1]:c.body=a[1];break;case 3:c.props=a[1];c.body=a[2];break}var d=a[0];if(/[.#$!]/.test(d)){if(d=I(d),c.tag=d.tag,d.id||d.class)c.props=c.props||{},c.props.id=d.id,c.props.class=d.class}else c.tag=d;if(c.props){d=c.props;if("object"==typeof d.style){var f="",g;for(g in d.style)f+=g+":"+d.style[g]+";";d.style=f}d.on&&
(c.on=d.on);d.data&&(c.dataset=d.data);d._ref&&(c.ref=d._ref);d._key&&(c.key=d._key);d._name&&(c.name=d._name);d._guard&&(c.guard=d._guard);d.on=d.data=d._ref=d._key=d._name=d._guard=null}c.svg=b||"svg"==c.tag}else t(a)?(c.type=2,c.body=a):"object"==typeof a&&a.nodeType&&(c.type=1,c.el=a,c.tag=a.nodeName);return c}function p(a){1==a.type?(a.el||(a.el=a.svg?document.createElementNS("http://www.w3.org/2000/svg",a.tag):document.createElement(a.tag),a.props&&B(a)),e(a.body)?a.body.forEach(function(b){p(b);
a.el.appendChild(b.el)}):t(a.body)&&(a.el.textContent=a.body)):2==a.type&&(a.el=document.createTextNode(a.body))}function x(a,b){a.el=b;var c=b.children;if(e(a.body))for(var d=0;d<a.body.length;d++)x(a.body[d],c[d])}function C(a,b){return null!==b.key&&b.key===a.key||b.type===a.type&&(null!==b.tag&&b.tag===a.tag||null!==b.name&&b.name===a.name)}function J(a,b,c,d,f,e){if(null!==a.key&&c&&a.key in c)return b[c[a.key]];e=0===e?0:e||b.length-1;for(c=f||0;c<=e;c++)if(f=b[c],f.el&&C(f,a)&&(null===f.key||
!d||d&&!(f.key in d)))return f;return null}function z(a,b,c){if(c&&!C(a,b))throw"Cannot reuse dissimilar nodes";K(a,b);if(e(b.body)&&b.body.length)if(e(a.body)&&a.body.length)for(c=0;c<b.body.length;c++){var d=b.body[c],f=J(d,a.body,a.keyMap,b.keyMap);f?z(f,d):p(d)}else p(b);e(a.body)&&(a.body.forEach(function(a){a.el&&(a.el.parentNode&&a.el.parentNode.removeChild(a.el),a.el=null)}),a.body="");if(e(b.body)){var g=b.el.childNodes;b.body.forEach(function(a,c){g[c]!==a.el&&b.el.insertBefore(a.el,g[c])})}}
function K(a,b){b.el=a.el;a.el=null;B(b,a);var c=!e(b.body),d=!e(a.body);if(c&&b.body!==a.body)b.el.textContent=b.body;else if(d&&!c)for(;b.el.firstChild;)b.el.removeChild(b.el.firstChild)}function B(a,b,c){b=b||{};(b.props||a.props)&&m(a.el,b.props||{},a.props||{},L,D,c);(b.dataset||a.dataset)&&m(a.el,b.dataset||{},a.dataset||{},M,N,c);(b.on||a.on)&&m(a.el,b.on||{},a.on||{},O,P,c)}function m(a,b,c,d,e,g){g=g||!1;for(var h in c)null!==c[h]&&(h in b&&c[h]===b[h]||d(a,h,c[h],g));for(h in b)null!==b[h]&&
(h in c||e(a,h,g))}function O(a,b,c,d){a["on"+b]=c}function P(a,b,c){a["on"+b]=""}function M(a,b,c,d){a.dataset[b]=c}function N(a,b,c){a.dataset[b]=""}function L(a,b,c,d){"."===b[0]?a[b.substr(1)]=c:!1===c?D(a,b,d):(!0===c&&(c=""),d?a.setAttributeNS(null,b,c):a.setAttribute(b,c))}function D(a,b,c){"."===b[0]?a[b.substr(1)]=null:c?a.removeAttributeNS(null,b):a.removeAttribute(b)}var F=/^(?:img|br|input|col|link|meta|area|base|command|embed|hr|keygen|param|source|track|wbr)$/,n={},u="undefined"==typeof window?
{}:window;r.useRaf=!0;return r});
