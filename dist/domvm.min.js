https://github.com/leeoniya/domvm
("object"===typeof module&&"object"===typeof module.exports&&function(f){module.exports=f()}||"function"===typeof define&&function(f){define("domvm",f)}||function(f){window.domvm=f()})(function(){function f(a){return Array.isArray(a)}function n(a){a=typeof a;return"string"==a||"number"==a}function k(a){return"object"==typeof a}function m(a){return"function"==typeof a}function G(a){function b(){c=0;a.apply(d,e)}if(!w.requestAnimationFrame)return a;var c,d,e;return function(){d=this;e=arguments;c||
(c=w.requestAnimationFrame(b))}}function x(a,b,c){var d=null!==a.name;if(!c&&d)return null;b=b||{};null!==a.ref&&a.el&&(b[a.ref]=a.el);f(a.body)&&a.body.forEach(function(a){x(a,b)});return b}function y(a){var b="";switch(a.type){case 1:b+="<"+a.tag;if(a.props){var c=n(a.props.style)?a.props.style:"",d=k(a.props.style)?a.props.style:null;if(d)for(var e in d)null!==d[e]&&(c+=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+": "+d[e]+";");for(e in a.props)0!==e.indexOf("on")&&(d=a.props[e],m(d)&&(d=
d()),k(d)||(!0===d?b+=" "+e:!1!==d&&null!==d&&"."!==e[0]&&(b+=" "+e+'="'+d+'"')));c.length&&(b+=' style="'+c+'"')}if(a.svg&&"svg"!==a.tag&&!a.body)return b+"/>";b+=">";break;case 2:return a.body}H.test(a.tag)||(f(a.body)?a.body.forEach(function(a){b+=y(a)}):b+=a.body||"",b+="</"+a.tag+">");return b}function u(a,b,c){f(a)&&(a=I(a));return q.call(null,a,b,c)}function I(a){return function(b,c,d){return{render:function(){return a}}}}function q(a,b,c){function d(){return{html:g,branch:l,redraw:m,mount:f,
import:e}}function e(a){z(l,a);return d()}function g(){return y(l)}function f(a){r(l);a.appendChild(l.el);return d()}function h(a){var b=null,d=a.split(":");2==d.length&&(a=d[0],b=+d[1]);var d=Array.prototype.slice.call(arguments,1),c=l;if(null!==b){for(;--b&&c.parent;)c=c.parent;c.onEmit[a].apply(null,d)}else for(;c&&!(c.onEmit&&a in c.onEmit&&!1===c.onEmit[a].apply(null,d));)c=c.parent}function t(){var e=q.apply(null,0==arguments.length?b||[]:arguments),e=A(e,!0,c||null);e.name=e.name||a.name||
null;e.onEmit=n.on||{};e.onEmit._r=t;l&&B(l,e)&&C(l,e,!0);if(c){var g=c.body.indexOf(l);c.body[g]=e}l=e;setTimeout(function(){x(l,k,!0);p&&p()},0);return d()}var k={};h.event=function(){var a=arguments;return function(){h.apply(null,a)}};h.redraw=function(a){a=a||1E3;return function(){h("_r:"+a)}};var m=u.useRaf?G(t):t,n=a(m,k,h),q=n.render,p=n.after,l=null;t();return d()}function A(a,b,c,d){if(m(a))return q(a,null,c).branch;if(f(a)&&m(a[0]))return q(a[0],a.slice(1),c).branch;a=J(a,d);d=d||a.svg;
b&&(a.parent=c||null,c=a);if(f(a.body)){var e={},g=!1;a.body=a.body.map(function(a,b){var f=A(a,!1,c,d);null!==f.key&&(e[f.key]=b,g=!0);return f});g&&(a.keyMap=e)}return a}function K(a){if(a in p)return p[a];var b={tag:null,id:null,class:null};b.tag=a.replace(/^([\w\-]+)?(?:#([\w\-]+))?((?:\.[\w\-]+)+)?$/,function(a,d,e,g){e&&(b.id=e);g&&(b.class=g.replace(/\./g," ").trim());return d||"div"});return p[a]=b}function J(a,b){var c={type:null,name:null,key:null,ref:null,tag:null,svg:!1,guard:!1,dataset:null,
props:null,on:null,onEmit:null,el:null,keyMap:null,body:null};if(f(a)&&a.length){c.type=1;switch(a.length){case 2:f(a[1])?c.body=a[1]:k(a[1])?c.props=a[1]:c.body=a[1];break;case 3:c.props=a[1];c.body=a[2];break}var d=a[0];if(/[.#]/.test(d)){if(d=K(d),c.tag=d.tag,d.id||d.class)c.props=c.props||{},c.props.id=d.id,c.props.class=d.class}else c.tag=d;if(c.props){var d=c.props,e;for(e in d)m(d[e])&&-1==e.indexOf("on")&&(d[e]=d[e]());if(k(d.style))for(var g in d.style)e=d.style[g],m(e)&&(d.style[g]=e());
d._ref&&(c.ref=d._ref);d._key&&(c.key=d._key);d._name&&(c.name=d._name);d._guard&&(c.guard=d._guard);d.data=d._ref=d._key=d._name=d._guard=null}c.svg=b||"svg"==c.tag}else n(a)?(c.type=2,c.body=a):k(a)&&a.nodeType&&(c.type=1,c.el=a,c.tag=a.nodeName);return c}function r(a){1==a.type?(a.el||(a.el=a.svg?v.createElementNS("http://www.w3.org/2000/svg",a.tag):v.createElement(a.tag),a.props&&D(a)),f(a.body)?a.body.forEach(function(b){r(b);a.el.appendChild(b.el)}):n(a.body)&&(a.el.textContent=a.body)):2==
a.type&&(a.el=v.createTextNode(a.body))}function z(a,b){a.el=b;var c=b.children;if(f(a.body))for(var d=0;d<a.body.length;d++)z(a.body[d],c[d])}function B(a,b){return null!==b.key&&b.key===a.key||b.type===a.type&&(2===b.type||null!==b.tag&&b.tag===a.tag||null!==b.name&&b.name===a.name)}function L(a,b,c,d,e,g){if(null!==a.key&&c&&a.key in c)return b[c[a.key]];e=e||0;if(e>b.length-1)return null;g=0===g?0:g||b.length-1;for(c=e;c<=g;c++)if(e=b[c],e.el&&B(e,a)&&(null===e.key||!d||d&&!(e.key in d)))return e;
return null}function C(a,b){M(a,b);if(f(b.body)&&b.body.length)if(f(a.body)&&a.body.length)for(var c=a.body.length-1,d=0,e=0;d<b.body.length;d++){var g=b.body[d],k=L(g,a.body,a.keyMap,b.keyMap,e);k?(C(k,g),e++):(r(g),d>=c?b.el.appendChild(g.el):b.el.insertBefore(g.el,b.el.childNodes[d]))}else r(b);f(a.body)&&(a.body.forEach(function(a){a.el&&(a.el.parentNode&&a.el.parentNode.removeChild(a.el),a.el=null)}),a.body=null);if(f(b.body)){var h=b.el.childNodes;b.body.forEach(function(a,c){h[c]!==a.el&&b.el.insertBefore(a.el,
h[c])})}}function M(a,b){b.el=a.el;a.el=null;if(2===b.type&&b.body!==a.body)b.el.nodeValue=b.body;else{D(b,a);var c=!f(b.body),d=!f(a.body);if(c&&b.body!==a.body)d&&b.el.firstChild?b.el.firstChild.nodeValue=b.body:b.el.textContent=b.body;else if(d&&!c)for(;b.el.firstChild;)b.el.removeChild(b.el.firstChild)}}function D(a,b){var c=!b;b=b||{};if(b.props||a.props){var d=b.props||{},e=a.props||{},g=d.style,f=e.style;if(k(g)||k(f))E(a.el,g||{},f||{},N,O,a.svg,c),d.style=e.style=null;E(a.el,d,e,P,F,a.svg,
c);f&&(e.style=f)}}function E(a,b,c,d,e,f,k){f=f||!1;for(var h in c)null!==c[h]&&(h in b&&c[h]===b[h]||d(a,h,c[h],f,k));for(h in b)null!==b[h]&&(h in c||e(a,h,f,k))}function N(a,b,c){a.style[b]=c}function O(a,b){a.style[b]=""}function P(a,b,c,d,e){"."===b[0]?a[b.substr(1)]=c:"class"===b?a.className=c:"id"===b||0===b.indexOf("on")?a[b]=c:!1===c?F(a,b,d,e):(!0===c&&(c=""),d?a.setAttributeNS(null,b,c):a.setAttribute(b,c))}function F(a,b,c,d){d||("."===b[0]?a[b.substr(1)]=null:"class"===b?a.className=
"":0===b.indexOf("on")?a[b]=null:c?a.removeAttributeNS(null,b):a.removeAttribute(b))}var H=/^(?:img|br|input|col|link|meta|area|base|command|embed|hr|keygen|param|source|track|wbr)$/,p={},w="undefined"==typeof window?{}:window,v=document;u.useRaf=!0;return u});
