// https://github.com/leeoniya/domvm
("object"===typeof module&&"object"===typeof module.exports&&function(p){module.exports=p()}||"function"===typeof define&&function(p){define("domvm",p)}||function(p){window.domvm=p()})(function(){function p(a,b,d,e,c,f,h){function g(a,b,c){f=a;h=b;return m(c,!1)}function m(a,c){e=a||e;k.refs={};var g=k.node,t=k.view[3].render.apply(b,e),t=A(t,f,h,k);t.key=q(d)?d:t.key;t.vm=k;k.node=t;var l=g;if(g&&(t.type!==g.type||t.tag!==g.tag))var l=null,m=!0;v(t,l);f&&(f.body[h]=t);!1!==c&&(g&&w(g),!g&&H||x(t),
m&&(g.el.parentNode.replaceChild(t.el,g.el),g.el=null));setTimeout(function(){var a=k,b;for(b in a.refs)a.refs[b]=a.refs[b].el;(a=k.view[3].after)&&a.apply(null,void 0)},0);return k}function n(a){var b=null,c=a.split(":");2==c.length&&(a=c[0],b=+c[1]);var c=Array.prototype.slice.call(arguments,1),d=k.node;if(null!==b){for(;b&&d.parent;)d=d.parent,d.vm&&b--;(b=(b=d.vm?d.vm.view[3].on:null)?b[a]:null)&&b.apply(null,c)}else for(;d&&(!d.vm||!(b=(b=d.vm.view[3].on)?b[a]:null)||!1!==b.apply(null,c));)d=
d.parent}var H=!f;l(a)&&(b=a[1],d=a[2],e=a[3],a=a[0]);c=b||null;b=b&&b.ctx&&b.model?b.model:c;var k={ctx:{},node:null,view:[a,b,d],redraw:p.useRaf?I(m):m,emit:n,refs:{},html:function(){return B(k.node)},mount:function(a){x(k.node);a.insertBefore(k.node.el,null);return k},attach:function(a){C(k.node,a);return k},destroy:function(a){if(f)if(a){for(a=h+1;a<f.body.length;a++){var b=f.body[a];b.idx=a-1;b.vm&&b.vm.updIdx(b.idx)}f.body.splice(h,1)}else f.body[h]=null;w(k.node,!0);k.node.vm=null;(a=k.view[3].cleanup)&&
a.apply(null,void 0)},moveTo:g,updIdx:function(a){h=a}};a=a.call(k.ctx,k,c,d);a=r(a)?{render:a}:a;a.on=a.on||{};a.on._redraw=k.redraw;k.view[3]=a;n.redraw=function(a){a=q(a)?a:1E3;n("_redraw:"+a)};return f?g(f,h,e):m(e)}function C(a,b){a.el=b;if(l(a.body))for(var d=0;d<a.body.length;d++){var e=a.body[d];e&&2===e.type&&""===e.body&&b.insertBefore(document.createTextNode(""),b.childNodes[d]||null);C(e,b.childNodes[d])}}function w(a,b){l(a.body)&&(a.body.forEach(function(a,b){a&&(a.vm&&!a.moved?a.vm.destroy():
a.el&&a.el.parentNode?a.el.parentNode.removeChild(a.el):w(a))}),a.body=null);a.vm=null;b&&a.el&&(a.el.parentNode.removeChild(a.el),a.el=null)}function A(a,b,d,e){var c=a;a={type:null,key:null,ref:null,idx:null,parent:null,moved:!1,tag:null,ns:null,guard:!1,props:null,el:null,keyMap:null,body:null};r(c)&&(c=c());if(l(c)&&c.length){a.type=1;switch(c.length){case 2:l(c[1])?a.body=c[1]:n(c[1])?a.props=c[1]:a.body=c[1];break;case 3:a.props=c[1],a.body=c[2]}c=c[0];if(/[.#]/.test(c)){if(c=J(c),a.tag=c.tag,
c.id||c["class"])a.props=a.props||{},a.props.id=c.id,a.props["class"]=c["class"]}else a.tag=c;if(a.props){var c=a.props,f;for(f in c)u(f)?c[f]=K(c[f],e.view[1]||null):r(c[f])&&(c[f]=c[f]());if(n(c.style))for(var h in c.style)f=c.style[h],r(f)&&(c.style[h]=f());a.key=q(c._key)?c._key:q(c._ref)?c._ref:q(c.id)?c.id:q(c.name)?c.name:null;c._ref&&(a.ref=c._ref);c._guard&&(a.guard=c._guard);c._ref=c._key=c._guard=null}r(a.body)&&(a.body=a.body())}else q(c)&&(a.type=2,a.body=c);null!==a.ref&&(e.refs[a.ref]=
a);a.parent=b;a.idx=d;a.ns=b&&b.ns?b.ns:"svg"===a.tag||"math"===a.tag?a.tag:null;if(l(a.body)){b={};d=!1;h=0;for(c=a.body.length;h<c;h++){f=a.body[h];var g=null,m=null;l(f)&&l(f[0])?(c=a.body,c.splice.apply(c,[h,1].concat(f)),c=a.body.length,h--):(l(f)&&r(f[0])?g=f[2]:n(f)&&r(f.redraw)?(f.moveTo(a,h),m=f.node,g=f.view[2]):(m=A(f,a,h,e),g=m.key),q(g)&&(b[g]=h,d=!0),a.body[h]=m||f)}d&&(a.keyMap=b)}return a}function v(a,b){b&&L(b,a);l(a.body)&&a.body.forEach(function(d,e){var c=l(d);if(b){var f=M(d,
a,b);if(null!==f){var h=f[1],f=b.body[f[0]];c&&f.vm?2===h?f.vm.moveTo(a,e,d[3]):1===h&&p.apply(null,[d[0],d[1],d[2],d[3],d[4],a,e]):a.body[e]=v(d,f);return}}c?p.apply(null,[d[0],d[1],d[2],d[3],d[4],a,e]):a.body[e]=v(d)});return a}function x(a){var b=!a.el;1==a.type?(b&&(a.el=a.ns?y.createElementNS(N[a.ns],a.tag):y.createElement(a.tag),a.vm&&(a.el._vm=a.vm),a.props&&D(a)),l(a.body)?a.body.forEach(x):b&&q(a.body)&&(a.el.textContent=a.body)):2==a.type&&b&&(a.el=y.createTextNode(a.body));(b=a.parent)&&
b.el&&b.el.childNodes[a.idx]!==a.el&&b.el.insertBefore(a.el,b.el.childNodes[a.idx])}function M(a,b,d,e,c){var f=l(a),h=f?a[2]||null:a.key,g=d.keyMap,m=b.keyMap;d=d.body;b=b.body;if(null!==h&&g&&q(g[h]))return[g[h],2];e=e||0;if(e>d.length-1)return null;c=0===c?0:c||d.length-1;for(h=null;e<=c;e++)if(g=d[e],null!==g&&g.el)if(f&&g.vm){if(g.vm.view[0]===a[0]){if(g.vm.view[1]===a[1])return[e,2];var n=!1;if(p.viewScan)for(var r=0;r<b.length;r++){var k=b[r];if(!k.el&&k.vm&&k.vm.view[0]===g.vm.view[0]&&k.vm.view[1]===
g.vm.view[1]){n=!0;break}}n||h||!m||q(m[g.key])||(h=[e,1])}}else if(!(a.type!==g.type||2!==a.type&&(null===a.tag||a.tag!==g.tag)||null!==g.key&&m&&q(m[g.key])))return[e,1];return h}function L(a,b){b.el=a.el;a.el=null;if(2===b.type&&b.body!==a.body)b.el.nodeValue=b.body;else{D(b,a);var d=!l(b.body),e=!l(a.body);d&&b.body!==a.body?e&&b.el.firstChild?b.el.firstChild.nodeValue=b.body:b.el.textContent=b.body:e&&!d&&(b.el.textContent="");a.moved=!0}}function J(a){if(a in z)return z[a];var b={tag:null,id:null,
"class":null};b.tag=a.replace(/^([\w\-]+)?(?:#([\w\-]+))?((?:\.[\w\-]+)+)?$/,function(a,e,c,f){c&&(b.id=c);f&&(b["class"]=f.replace(/\./g," ").trim());return e||"div"});return z[a]=b}function u(a){return"on"===a.substr(0,2)}function K(a,b){return function(d){var e;if(r(a))e=a.call(b,d);else if(n(a))for(var c in a)d.target.matches(c)&&(e=a[c].call(b,d));!1===e&&(d.preventDefault(),d.stopPropagation())}}function D(a,b){var d=!b;b=b||{};if(b.props||a.props){var e=b.props||{},c=a.props||{},f=e.style,
h=c.style;if(n(f)||n(h))E(a.el,f||{},h||{},O,P,a.ns,d),e.style=c.style=null;E(a.el,e,c,Q,F,a.ns,d);h&&(c.style=h)}}function E(a,b,d,e,c,f,h){for(var g in d)null!==d[g]&&(g in b&&d[g]===b[g]||e(a,g,d[g],f,h));for(g in b)null!==b[g]&&(g in d||c(a,g,f,h))}function O(a,b,d){a.style[b]=d}function P(a,b){a.style[b]=""}function Q(a,b,d,e,c){"."===b[0]?(b=b.substr(1),"svg"===e?a[b].baseVal=d:a[b]=d):"class"===b?a.className=d:"id"===b||u(b)?a[b]=d:!1===d?F(a,b,e,c):(!0===d&&(d=""),a.setAttribute(b,d))}function F(a,
b,d,e){e||("."===b[0]?(b=b.substr(1),"svg"===d?a[b].baseVal=null:a[b]=null):"class"===b?a.className="":"id"===b||u(b)?a[b]=null:a.removeAttribute(b))}function B(a){var b="";switch(a.type){case 1:b+="<"+a.tag;if(a.props){var d=q(a.props.style)?a.props.style:"",e=n(a.props.style)?a.props.style:null;if(e)for(var c in e)null!==e[c]&&(d+=c.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+": "+e[c]+";");for(c in a.props)u(c)||(e=a.props[c],r(e)&&(e=e()),n(e)||(!0===e?b+=" "+c:!1!==e&&null!==e&&"."!==c[0]&&
(b+=" "+c+'="'+e+'"')));d.length&&(b+=' style="'+d+'"')}if(a.ns&&"svg"!==a.tag&&"math"!==a.tag&&!a.body)return b+"/>";b+=">";break;case 2:return a.body}R.test(a.tag)||(l(a.body)?a.body.forEach(function(a){b+=B(a)}):b+=a.body||"",b+="</"+a.tag+">");return b}function l(a){return a instanceof Array}function q(a){a=typeof a;return"string"===a||"number"===a}function n(a){return"object"===typeof a&&null!==a&&!l(a)}function r(a){return"function"===typeof a}function I(a){function b(){d=0;a.apply(e,c)}if(!G.requestAnimationFrame)return a;
var d,e,c;return function(){e=this;c=arguments;d||(d=G.requestAnimationFrame(b))}}var N={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},R=/^(?:img|br|input|col|link|meta|area|base|command|embed|hr|keygen|param|source|track|wbr)$/,z={},G="undefined"==typeof window?{}:window,y=document;p.viewScan=!1;p.useRaf=!0;return p});
