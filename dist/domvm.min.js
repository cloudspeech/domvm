https://github.com/leeoniya/domvm
("object"===typeof module&&"object"===typeof module.exports&&function(f){module.exports=f()}||"function"===typeof define&&function(f){define("domvm",f)}||function(f){window.domvm=f()})(function(){function f(a){return Array.isArray(a)}function n(a){a=typeof a;return"string"==a||"number"==a}function k(a){return null!==a&&"object"==typeof a}function m(a){return"function"==typeof a}function G(a){function b(){d=0;a.apply(c,e)}if(!w.requestAnimationFrame)return a;var d,c,e;return function(){c=this;e=arguments;
d||(d=w.requestAnimationFrame(b))}}function x(a,b,d){var c=null!==a.name;if(!d&&c)return null;b=b||{};null!==a.ref&&a.el&&(b[a.ref]=a.el);f(a.body)&&a.body.forEach(function(a){x(a,b)});return b}function y(a){var b="";switch(a.type){case 1:b+="<"+a.tag;if(a.props){var d=n(a.props.style)?a.props.style:"",c=k(a.props.style)?a.props.style:null;if(c)for(var e in c)null!==c[e]&&(d+=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+": "+c[e]+";");for(e in a.props)0!==e.indexOf("on")&&(c=a.props[e],m(c)&&
(c=c()),k(c)||(!0===c?b+=" "+e:!1!==c&&null!==c&&"."!==e[0]&&(b+=" "+e+'="'+c+'"')));d.length&&(b+=' style="'+d+'"')}if(a.svg&&"svg"!==a.tag&&!a.body)return b+"/>";b+=">";break;case 2:return a.body}H.test(a.tag)||(f(a.body)?a.body.forEach(function(a){b+=y(a)}):b+=a.body||"",b+="</"+a.tag+">");return b}function u(a,b,d){f(a)&&(a=I(a));return q.call(null,a,b,d)}function I(a){return function(b,d,c){return{render:function(){return a}}}}function q(a,b,d){function c(){return{html:g,branch:l,redraw:m,mount:f,
attach:e}}function e(a){z(l,a);return c()}function g(){return y(l)}function f(a){r(l);a.appendChild(l.el);return c()}function h(a){var b=null,c=a.split(":");2==c.length&&(a=c[0],b=+c[1]);var c=Array.prototype.slice.call(arguments,1),d=l;if(null!==b){for(;--b&&d.parent;)d=d.parent;d.onEmit[a].apply(null,c)}else for(;d&&!(d.onEmit&&a in d.onEmit&&!1===d.onEmit[a].apply(null,c));)d=d.parent}function t(e){e=q.apply(null,e||b||[]);e=A(e,!0,d||null);e.name=e.name||a.name||null;e.onEmit=n.on||{};e.onEmit._redraw=
t;l&&B(l,e)&&C(l,e,!0);if(d){var g=d.body.indexOf(l);d.body[g]=e}l=e;setTimeout(function(){x(l,k,!0);p&&p()},0);return c()}var k={};h.event=function(){var a=arguments;return function(){h.apply(null,a)}};h.redraw=function(a){a=a||1E3;return function(){h("_redraw:"+a)}};var m=u.useRaf?G(t):t,n=a(m,k,h),q=n.render,p=n.after,l=null;t();return c()}function A(a,b,d,c){if(m(a))return q(a,null,d).branch;if(f(a)&&m(a[0]))return q(a[0],a[1]||[],d).branch;a=J(a,c);c=c||a.svg;b&&(a.parent=d||null,d=a);if(f(a.body)){var e=
{},g=!1;a.body=a.body.map(function(a,b){var f=A(a,!1,d,c);null!==f.key&&(e[f.key]=b,g=!0);return f});g&&(a.keyMap=e)}return a}function K(a){if(a in p)return p[a];var b={tag:null,id:null,class:null};b.tag=a.replace(/^([\w\-]+)?(?:#([\w\-]+))?((?:\.[\w\-]+)+)?$/,function(a,c,e,g){e&&(b.id=e);g&&(b.class=g.replace(/\./g," ").trim());return c||"div"});return p[a]=b}function J(a,b){var d={type:null,name:null,key:null,ref:null,tag:null,svg:!1,guard:!1,dataset:null,props:null,on:null,onEmit:null,el:null,
keyMap:null,body:null};if(f(a)&&a.length){d.type=1;switch(a.length){case 2:f(a[1])?d.body=a[1]:k(a[1])?d.props=a[1]:d.body=a[1];break;case 3:d.props=a[1];d.body=a[2];break}var c=a[0];if(/[.#]/.test(c)){if(c=K(c),d.tag=c.tag,c.id||c.class)d.props=d.props||{},d.props.id=c.id,d.props.class=c.class}else d.tag=c;if(d.props){var c=d.props,e;for(e in c)m(c[e])&&-1==e.indexOf("on")&&(c[e]=c[e]());if(k(c.style))for(var g in c.style)e=c.style[g],m(e)&&(c.style[g]=e());d.key=c._key||c._ref||c.id||c.name||null;
c._ref&&(d.ref=c._ref);c._name&&(d.name=c._name);c._guard&&(d.guard=c._guard);c.data=c._ref=c._key=c._name=c._guard=null}d.svg=b||"svg"==d.tag}else n(a)?(d.type=2,d.body=a):k(a)&&a.nodeType&&(d.type=1,d.el=a,d.tag=a.nodeName);return d}function r(a){1==a.type?(a.el||(a.el=a.svg?v.createElementNS("http://www.w3.org/2000/svg",a.tag):v.createElement(a.tag),a.props&&D(a)),f(a.body)?a.body.forEach(function(b){r(b);a.el.appendChild(b.el)}):n(a.body)&&(a.el.textContent=a.body)):2==a.type&&(a.el=v.createTextNode(a.body))}
function z(a,b){a.el=b;var d=b.children;if(f(a.body))for(var c=0;c<a.body.length;c++)z(a.body[c],d[c])}function B(a,b){return null!==b.key&&b.key===a.key||b.type===a.type&&(2===b.type||null!==b.tag&&b.tag===a.tag||null!==b.name&&b.name===a.name)}function L(a,b,d,c,e,g){if(null!==a.key&&d&&a.key in d)return b[d[a.key]];e=e||0;if(e>b.length-1)return null;g=0===g?0:g||b.length-1;for(d=e;d<=g;d++)if(e=b[d],e.el&&B(e,a)&&(null===e.key||!c||c&&!(e.key in c)))return e;return null}function C(a,b){M(a,b);
if(f(b.body)&&b.body.length)if(f(a.body)&&a.body.length)for(var d=a.body.length-1,c=0,e=0;c<b.body.length;c++){var g=b.body[c],k=L(g,a.body,a.keyMap,b.keyMap,e);k?(C(k,g),e++):(r(g),c>=d?b.el.appendChild(g.el):b.el.insertBefore(g.el,b.el.childNodes[c]))}else r(b);f(a.body)&&(a.body.forEach(function(a){a.el&&(a.el.parentNode&&a.el.parentNode.removeChild(a.el),a.el=null)}),a.body=null);if(f(b.body)){var h=b.el.childNodes;b.body.forEach(function(a,c){h[c]!==a.el&&b.el.insertBefore(a.el,h[c])})}}function M(a,
b){b.el=a.el;a.el=null;if(2===b.type&&b.body!==a.body)b.el.nodeValue=b.body;else{D(b,a);var d=!f(b.body),c=!f(a.body);if(d&&b.body!==a.body)c&&b.el.firstChild?b.el.firstChild.nodeValue=b.body:b.el.textContent=b.body;else if(c&&!d)for(;b.el.firstChild;)b.el.removeChild(b.el.firstChild)}}function D(a,b){var d=!b;b=b||{};if(b.props||a.props){var c=b.props||{},e=a.props||{},g=c.style,f=e.style;if(k(g)||k(f))E(a.el,g||{},f||{},N,O,a.svg,d),c.style=e.style=null;E(a.el,c,e,P,F,a.svg,d);f&&(e.style=f)}}function E(a,
b,d,c,e,f,k){f=f||!1;for(var h in d)null!==d[h]&&(h in b&&d[h]===b[h]||c(a,h,d[h],f,k));for(h in b)null!==b[h]&&(h in d||e(a,h,f,k))}function N(a,b,d){a.style[b]=d}function O(a,b){a.style[b]=""}function P(a,b,d,c,e){"."===b[0]?a[b.substr(1)]=d:"class"===b?a.className=d:"id"===b||0===b.indexOf("on")?a[b]=d:!1===d?F(a,b,c,e):(!0===d&&(d=""),c?a.setAttributeNS(null,b,d):a.setAttribute(b,d))}function F(a,b,d,c){c||("."===b[0]?a[b.substr(1)]=null:"class"===b?a.className="":0===b.indexOf("on")?a[b]=null:
d?a.removeAttributeNS(null,b):a.removeAttribute(b))}var H=/^(?:img|br|input|col|link|meta|area|base|command|embed|hr|keygen|param|source|track|wbr)$/,p={},w="undefined"==typeof window?{}:window,v=document;u.useRaf=!0;return u});
