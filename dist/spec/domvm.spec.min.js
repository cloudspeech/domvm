// https://github.com/leeoniya/domvm (3.x-dev, spec build)

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.domvm=n()}(this,function(){"use strict";function e(){}function n(e){return null!=e&&e.constructor===Object}function t(e,n,t,r){e.splice.apply(e,[t,r].concat(n))}function r(e){return"function"==typeof e}function l(e){for(var n=arguments,t=1;t<n.length;t++)for(var r in n[t])e[r]=n[t][r];return e}function i(e,n){for(var t=[],r=n;r<e.length;r++)t.push(e[r]);return t}function o(e,n){for(var t in e)if(e[t]!==n[t])return!1;return!0}function a(e,n){var t=e.length;if(n.length!==t)return!1;for(var r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}function u(e){function n(){t=0,e.apply(r,l)}if(!we)return e;var t,r,l;return function(){r=this,l=arguments,t||(t=we(n))}}function s(e){return"o"===e[0]&&"n"===e[1]}function f(e){return"_"===e[0]}function d(e){return"style"===e}function c(e){e&&e.el&&e.el.offsetHeight}function h(e){return null!=e.node&&null!=e.node.el}function v(e,n){switch(n){case"value":case"checked":case"selected":return!0}return!1}function y(e){for(e=e||ke;null==e.vm&&e.parent;)e=e.parent;return e.vm}function p(){}function m(e){var n=new p;return n.type=ve,n.body=e,n}function b(e,n){var t=Te(e,function(e){t&&(null!=n.node&&n.redraw(),Re(t))});return xe(e)}function g(e,n){var t=Te(e,function(e){t&&null!=n.node&&n.redraw()});return t}function _(e,n){if(Se.warnings&&r(Se[e])){var t=Se[e].apply(null,n);t&&(t[0]=e+": "+(Se.verbose?t[0]:""),console.warn.apply(console,t))}}function w(e,n,t,r){var l=new p;l.type=he,l.flags=r||0,l.attrs=n||null;var i=function(e){var n=De[e];if(null==n){var t,r,l,i;for(De[e]=n={tag:(t=e.match(/^[-\w]+/))?t[0]:"div",id:(r=e.match(/#([-\w]+)/))?r[1]:null,class:(l=e.match(/\.([-\w.]+)/))?l[1].replace(/\./g," "):null,attrs:null};i=Ce.exec(e);)null==n.attrs&&(n.attrs={}),n.attrs[i[1]]=i[2]||""}return n}(e);l.tag=i.tag;var o=null!=i.id,a=null!=i.class,u=null!=i.attrs;if(o||a||u){var s=l.attrs||{};if(o&&null==s.id&&(s.id=i.id),a&&(l._class=i.class,s.class=i.class+(null!=s.class?" "+s.class:"")),u)for(var f in i.attrs)null==s[f]&&(s[f]=i.attrs[f]);l.attrs=s}var d=l.attrs;return null!=d&&(null!=d._key&&(l.key=d._key),null!=d._ref&&(l.ref=d._ref),null!=d._hooks&&(l.hooks=d._hooks),null!=d._data&&(l.data=d._data),null!=d._flags&&(l.flags=d._flags),null==l.key&&(null!=l.ref?l.key=l.ref:null!=d.id?l.key=d.id:null!=d.name&&(l.key=d.name+("radio"===d.type||"checkbox"===d.type?d.value:"")))),null!=t&&(l.body=t),"svg"===l.tag?setTimeout(function(){null==l.ns&&_("SVG_WRONG_FACTORY",[l])},16):/^(?:input|textarea|select|datalist|keygen|output)$/.test(l.tag)&&null==l.key&&_("UNKEYED_INPUT",[l]),l}function k(e,n,r,l){if(e.type!==me&&e.type!==pe){e.parent=n,e.idx=r,e.vm=l,null!=e.ref&&function(e,n,t){!function(e,n,t){for(var r;r=n.shift();)0===n.length?e[r]=t:e[r]=e=e[r]||{}}(e,["refs"].concat(n.split(".")),t)}(y(e),e.ref,e);var i=e.hooks,o=l&&l.hooks;(i&&(i.willRemove||i.didRemove)||o&&(o.willUnmount||o.didUnmount))&&function(e){for(;e=e.parent;)e.flags|=Ie}(e),Ee(e.body)?function(e){for(var n=e.body,r=0;r<n.length;r++){var l=n[r];!1===l||null==l?n.splice(r--,1):Ee(l)?(0!==r&&r!==n.length-1||_("ARRAY_FLATTENED",[e,l]),t(n,l,r--,1)):(null==l.type&&(n[r]=l=m(""+l)),l.type===ve?null==l.body||""===l.body?n.splice(r--,1):r>0&&n[r-1].type===ve?(_("ADJACENT_TEXT",[e,n[r-1].body,l.body]),n[r-1].body+=l.body,n.splice(r--,1)):k(l,e,r,null):k(l,e,r,null))}}(e):""===e.body?e.body=null:Ne(e.body)&&(e.body=b(e.body,y(e)))}}function E(e,n){return isNaN(n)||Ye[e]?n:n+"px"}function A(e,n){var t=(e.attrs||ke).style,r=n?(n.attrs||ke).style:null;if(null==t||function(e){var n=typeof e;return"string"===n||"number"===n}(t))e.el.style.cssText=t;else{for(var l in t){var i=t[l];Ne(i)&&(i=b(i,y(e))),(null==r||null!=i&&i!==r[l])&&(e.el.style[l]=E(l,i))}if(r)for(var o in r)null==t[o]&&(e.el.style[o]="")}}function N(e,n,t,r,l){if(null!=e){var i=t.hooks[n];if(i){if("d"!==n[0]||"i"!==n[1]||"d"!==n[2])return i(t,r);l?c(t.parent)&&i(t,r):Ue.push([i,t,r])}}}function x(e){if(Ue.length){c(e.node);for(var n;n=Ue.shift();)n[0](n[1],n[2])}}function T(e){return e.nextSibling}function R(e){var n=e.vm,t=null!=n&&N(n.hooks,"willUnmount",n,n.data),r=N(e.hooks,"willRemove",e);if((e.flags&Ie)===Ie&&Ee(e.body))for(var l=0;l<e.body.length;l++)R(e.body[l]);return t||r}function D(e,n,t){var r=n._node,l=r.vm;if(Ee(r.body))if((r.flags&Ie)===Ie)for(var i=0;i<r.body.length;i++)D(n,r.body[i].el);else S(r);delete n._node,e.removeChild(n),N(r.hooks,"didRemove",r,null,t),null!=l&&(N(l.hooks,"didUnmount",l,l.data,t),l.node=null)}function C(e,n){var t=n._node;if(!t._dead){var l=R(t);null!=l&&function(e){return"object"==typeof e&&r(e.then)}(l)?(t._dead=!0,l.then(function(e,n,t){return function(){return e.apply(t,n)}}(D,[e,n,!0]))):D(e,n)}}function S(e){for(var n=e.body,t=0;t<n.length;t++){var r=n[t];delete r.el._node,null!=r.vm&&(r.vm.node=null),Ee(r.body)&&S(r)}}function I(e){var n=e.el;if(0==(e.flags&Ie))Ee(e.body)&&S(e),n.textContent=null;else{var t=n.firstChild;do{var r=T(t);C(n,t)}while(t=r)}}function M(e,n,t){var r=n._node,l=null!=n.parentNode,i=n!==t&&l?null:r.vm;null!=i&&N(i.hooks,"willMount",i,i.data),N(r.hooks,l?"willReinsert":"willInsert",r),e.insertBefore(n,t),N(r.hooks,l?"didReinsert":"didInsert",r),null!=i&&N(i.hooks,"didMount",i,i.data)}function O(e,n,t){M(e,n,t?T(t):null)}function L(e,n,t){e[n]=t}function Y(e,n,t,r,l){var i=e.apply(l,n.concat([t,r,l,l.data]));l.onevent(t,r,l,l.data,n),je.call(null,t,r,l,l.data,n),!1===i&&(t.preventDefault(),t.stopPropagation())}function U(e){var n,t,r=function(e){for(;null==e._node;)e=e.parentNode;return e._node}(e.target),l=y(r),i=e.currentTarget._node.attrs["on"+e.type];if(Ee(i))Y(n=i[0],t=i.slice(1),e,r,l);else for(var o in i)if(e.target.matches(o)){var a=i[o];Ee(a)?(n=a[0],t=a.slice(1)):(n=a,t=[]),Y(n,t,e,r,l)}}function H(e,t,l,i){if(l!==i){r(l)&&r(i)&&i.name==l.name&&_("INLINE_HANDLER",[e,i,l]),null==i||null==l||Ee(i)==Ee(l)&&n(i)==n(l)&&r(i)==r(l)||_("MISMATCHED_HANDLER",[e,i,l]);var o=e.el;null==l||r(l)?L(o,t,l):null==i&&L(o,t,U)}}function j(e,n,t){"."===n[0]&&(n=n.substr(1),t=!0),t?e.el[n]="":e.el.removeAttribute(n)}function V(e,n,t,r,l){var i=e.el;null!=e.ns?i.setAttribute(n,t):"class"===n?i.className=t:"id"===n||"boolean"==typeof t||r?i[n]=t:"."===n[0]?i[n.substr(1)]=t:i.setAttribute(n,t)}function F(e,n,t){var r=e.attrs||ke,l=n.attrs||ke;if(r===l)_("REUSED_ATTRS",[e]);else{for(var i in r){var o=r[i];if(null!=o){var a=v(e.tag,i),u=a?e.el[i]:l[i];Ne(o)&&(r[i]=o=b(o,y(e))),o===u||(d(i)?A(e,n):f(i)||(s(i)?H(e,i,o,u):V(e,i,o,a)))}}for(var i in l)null==r[i]&&!f(i)&&j(e,i,v(e.tag,i)||s(i))}}function P(e,n,t,r){return e.type===pe&&(n=e.data,t=e.key,r=e.opts,e=e.view),new Z(e,n,t,r)}function G(e){for(var n=0;n<e.body.length;n++){var t=e.body[n],r=t.type;if(r<=ye)M(e.el,W(t));else if(r===pe){r=(l=P(t.view,t.data,t.key,t.opts)._redraw(e,n,!1)).node.type,M(e.el,W(l.node))}else if(r===me){var l;(l=t.vm)._redraw(e,n),r=l.node.type,M(e.el,l.node.el)}}}function W(e,n){return null==e.el&&(e.type===he?(e.el=n||function(e,n){return null!=n?_e.createElementNS(n,e):_e.createElement(e)}(e.tag,e.ns),null!=e.attrs&&F(e,ke),(e.flags&Le)===Le&&e.body.body(e),Ee(e.body)?G(e):null!=e.body&&(e.el.textContent=e.body)):e.type===ve?e.el=n||function(e){return _e.createTextNode(e)}(e.body):e.type===ye&&(e.el=n||function(e){return _e.createComment(e)}(e.body))),e.el._node=e,e.el}function z(e,n,t,r,l,i,o,a){return function(u,s,f,d,c,h){var v,y;if(null!=d[r]){if(null==(v=d[r]._node))return _("FOREIGN_ELEMENT",[d[r]]),void(d[r]=e(d[r]));if(function(e){return e.parent}(v)!==u)return y=e(d[r]),null!=v.vm?v.vm.unmount(!0):C(s,d[r]),void(d[r]=y)}if(d[l]==c)return Fe;if(null==d[l].el)t(s,W(d[l]),d[r]),d[l]=n(d[l],f);else if(d[l].el===d[r])d[l]=n(d[l],f),d[r]=e(d[r]);else{if(h||v!==d[o])return null!=d[l].vm&&_("ALREADY_HYDRATED",[d[l].vm]),h&&null!=d[r]?function(e,n,t,r,l,i,o,a,u){if(a._lis)t(i,u[l].el,u[r]),u[l]=n(u[l],o);else{var s=function(e,n){var t,r=0,l=n.length-1;if(l<=2147483647)for(;r<=l;){if(t=r+l>>1,n[t]===e)return t;n[t]<e?r=t+1:l=t-1}else for(;r<=l;){if(t=Math.floor((r+l)/2),n[t]===e)return t;n[t]<e?r=t+1:l=t-1}return r==n.length?null:r}(a.idx,u.tombs);a._lis=!0;var f=e(u[r]);t(i,u[r],null!=s?o[u.tombs[s]].el:s),null==s?u.tombs.push(a.idx):u.tombs.splice(s,0,a.idx),u[r]=f}}(e,n,t,r,l,s,f,v,d):Ve;y=d[r],d[r]=e(y),a(s,y,d[i]),d[i]=y}}}function B(e,n){var t=n.body,r=e.el,l=e.body,i={lftNode:l[0],rgtNode:l[l.length-1],lftSib:(t[0]||ke).el,rgtSib:(t[t.length-1]||ke).el};e:for(;;){for(;;){var o=Pe(e,r,l,i,null,!1);if(o===Ve)break;if(o===Fe)break e}for(;;){var a=Ge(e,r,l,i,i.lftNode,!1);if(a===Ve)break;if(a===Fe)break e}!function(e,n,t,r){for(var l=Array.prototype.slice.call(n.childNodes),i=[],o=0;o<l.length;o++){var a=l[o]._node;a.parent===e&&i.push(a.idx)}for(var u=function(e){var n=e.slice(),t=[];t.push(0);for(var r,l,i=0,o=e.length;i<o;++i){var a=t[t.length-1];if(e[a]<e[i])n[i]=a,t.push(i);else{for(r=0,l=t.length-1;r<l;){var u=(r+l)/2|0;e[t[u]]<e[i]?r=u+1:l=u}e[i]<e[t[r]]&&(r>0&&(n[i]=t[r-1]),t[r]=i)}}for(l=t[(r=t.length)-1];r-- >0;)t[r]=l,l=n[l];return t}(i).map(function(e){return i[e]}),s=0;s<u.length;s++)t[u[s]]._lis=!0;r.tombs=u;for(;;){var f=Pe(e,n,t,r,null,!0);if(f===Fe)break}}(e,r,l,i);break}}function K(e){return e.el._node.parent!==e.parent}function X(e,n,t){return n[t]}function $(e,n,t){for(;t<n.length;t++){var r=n[t];if(null!=r.vm){if(e.type===pe&&r.vm.view===e.view&&r.vm.key===e.key||e.type===me&&r.vm===e.vm)return r}else if(!K(r)&&e.tag===r.tag&&e.type===r.type&&e.key===r.key&&(e.flags&~Ie)==(r.flags&~Ie))return r}return null}function q(e,n,t){if(null==n._keys){if(n[t].key===e.key)return n[t];for(var r={},l=0;l<n.length;l++)r[n[l].key]=l;n._keys=r}return n[n._keys[e.key]]}function J(n,t){N(t.hooks,"willRecycle",t,n);var r=n.el=t.el,l=t.body,i=n.body;if(r._node=n,n.type!==ve||i===l){null==n.attrs&&null==t.attrs||F(n,t);var o=Ee(l),a=Ee(i),u=(n.flags&Le)===Le;o?a||u?function(n,t){var r=n.body,l=r.length,i=t.body,o=i.length,a=(n.flags&Le)===Le,u=(n.flags&Me)===Me,s=(n.flags&Oe)===Oe,f=!u&&n.type===he,d=!0,c=0===o?e:s?q:u||a?X:$;if(f&&0===l)return I(t),void(a&&(n.body=[]));var v,y,p=0,m=!1,b=0;if(a)var g={key:null},_=Array(l);for(var w=0;w<l;w++){if(a){var E=!1,A=null;d&&(s&&(g.key=r.key(w)),v=c(g,i,b)),null!=v?(y=v.idx,!0===(A=r.diff(w,v))?((N=v).parent=n,N.idx=w,N._lis=!1):E=!0):E=!0,E&&(k(N=r.tpl(w),n,w),N._diff=null!=A?A:r.diff(w),null!=v&&J(N,v)),_[w]=N}else{var N=r[w],x=N.type;if(x<=ye)(v=d&&c(N,i,b))&&(J(N,v),y=v.idx);else if(x===pe){if(v=d&&c(N,i,b)){y=v.idx;var T=v.vm._update(N.data,n,w)}else var T=P(N.view,N.data,N.key,N.opts)._redraw(n,w,!1);x=T.node.type}else if(x===me){var R=h(N.vm),T=N.vm._update(N.data,n,w,R);x=T.node.type}}if(null!=v&&(y===b?++b===o&&l>o&&(v=null,d=!1):m=!0,!s&&o>100&&m&&++p%10==0))for(;b<o&&K(i[b]);)b++}a&&(n.body=_);f&&B(n,t)}(n,t):i!==l&&(null!=i?r.textContent=i:I(t)):a?(I(t),G(n)):i!==l&&(null!=i&&null!=l?r.firstChild.nodeValue=i:r.textContent=i),N(t.hooks,"didRecycle",t,n)}else r.nodeValue=i}function Z(e,t,l,i){var o=this;o.view=e,o.data=t,o.key=l,Ne(t)&&(o._stream=g(t,o)),i&&(o.opts=i,o.config(i));var a=n(e)?e:e.call(o,o,t,l,i);r(a)?o.render=a:(o.render=a.render,o.config(a)),o._redrawAsync=u(function(e){return o.redraw(!0)}),o._updateAsync=u(function(e){return o.update(e,!0)}),o.init&&o.init.call(o,o,o.data,o.key,i)}function Q(e,n,t,r){return null!=t&&(t.body[r]=n,n.idx=r,n.parent=t,n._lis=!1),e}function ee(e,t,r,l){var i,o;return null==r?n(t)?i=t:o=t:(i=t,o=r),w(e,i,o,l)}function ne(e,n,t,r){this.view=e,this.data=n,this.key=t,this.opts=r}function te(e){this.vm=e}function re(e,n){var t=e.body;if(Ee(t))for(var r=0;r<t.length;r++){var l=t[r];null!=l.vm?n.push(l.vm):re(l,n)}return n}function le(e){var t,r,l=arguments,o=l.length;if(o>1){var a=1;n(l[1])&&(r=l[1],a=2),t=o!==a+1||l[a]instanceof p||l[a]instanceof ne||l[a]instanceof te?i(l,a):l[a]}return w(e,r,t)}function ie(e,n){e.el=n,n._node=e;var t=e.attrs;for(var r in t){var l=t[r],i=v(e.tag,r);d(r)||f(r)||(s(r)?H(e,r,l):null!=l&&i&&V(e,r,l,i))}if((e.flags&Le)===Le&&e.body.body(e),Ee(e.body)&&e.body.length>0){var o=n.firstChild,a=0,u=e.body[a];do{u.type===pe?u=P(u.view,u.data,u.key,u.opts)._redraw(e,a,!1).node:u.type===me&&(u=u.node||u._redraw(e,a,!1).node),"table"===e.tag&&"tr"===u.tag&&_("ATTACH_IMPLICIT_TBODY",[e,u]),ie(u,o)}while((o=o.nextSibling)&&(u=e.body[++a]))}}function oe(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function ae(e){var n="";for(var t in e)null!=e[t]&&(n+=oe(t)+": "+E(t,e[t])+"; ");return n}function ue(e){return null==e?"":""+e}function se(e){e=ue(e);for(var n=0,t="";n<e.length;n++)switch(e[n]){case"&":t+="&amp;";break;case"<":t+="&lt;";break;case">":t+="&gt;";break;default:t+=e[n]}return t}function fe(e){e=ue(e);for(var n=0,t="";n<e.length;n++)t+='"'===e[n]?"&quot;":e[n];return t}function de(e,n){for(var t="",r=0;r<e.length;r++)t+=ce(e[r],n);return t}function ce(e,n){var t,r;switch(e.type){case pe:t=P(e.view,e.data,e.key,e.opts).html(n);break;case me:t=e.vm.html();break;case he:if(null!=e.el&&null==e.tag){t=e.el.outerHTML;break}var l="";l+="<"+e.tag;var i=e.attrs,o=null!=i;if(o){for(var a in i)if(!(s(a)||"."===a[0]||"_"===a[0]||!1===n&&v(e.tag,a))){var u=i[a];"style"!==a||null==u?!0===u?l+=" "+se(a)+'=""':!1===u||null!=u&&(l+=" "+se(a)+'="'+fe(u)+'"'):r="object"==typeof u?ae(u):u}null!=r&&(l+=' style="'+fe(r.trim())+'"')}if(null==e.body&&null!=e.ns&&"svg"!==e.tag)return l+"/>";l+=">",Xe[e.tag]||(o&&null!=i[$e]?l+=i[$e]:Ee(e.body)?l+=de(e.body,n):(e.flags&Le)===Le?(e.body.body(e),l+=de(e.body,n)):l+=se(e.body),l+="</"+e.tag+">"),t=l;break;case ve:t=se(e.body);break;case ye:t="\x3c!--"+se(e.body)+"--\x3e"}return t}var he=1,ve=2,ye=3,pe=4,me=5,be="undefined"!=typeof window,ge=be?window:{},_e=be?document:{},we=ge.requestAnimationFrame,ke={},Ee=Array.isArray,Ae=p.prototype={constructor:p,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,_dead:!1,_lis:!1,idx:null,parent:null},Ne=function(){return!1},xe=e,Te=e,Re=e,De={},Ce=/\[(\w+)(?:=(\w+))?\]/g,Se={syncRedraw:!1,warnings:!0,verbose:!0,mutations:!0,DATA_REPLACED:function(e,n,t){if(r(e.view)&&e.view.length>1){return["A view's data was replaced. The data originally passed to the view closure during init is now stale. You may want to rely only on the data passed to render() or vm.data.",e,n,t]}},UNKEYED_INPUT:function(e){return["Unkeyed <input> detected. Consider adding a name, id, _key, or _ref attr to avoid accidental DOM recycling between different <input> types.",e]},UNMOUNTED_REDRAW:function(e){return["Invoking redraw() of an unmounted (sub)view may result in errors.",e]},INLINE_HANDLER:function(e,n,t){return["Anonymous event handlers get re-bound on each redraw, consider defining them outside of templates for better reuse.",e,n,t]},MISMATCHED_HANDLER:function(e,n,t){return["Patching of different event handler styles is not fully supported for performance reasons. Ensure that handlers are defined using the same style.",e,n,t]},SVG_WRONG_FACTORY:function(e){return["<svg> defined using domvm.defineElement. Use domvm.defineSvgElement for <svg> & child nodes.",e]},FOREIGN_ELEMENT:function(e){return["domvm stumbled upon an element in its DOM that it didn't create, which may be problematic. You can inject external elements into the vtree using domvm.injectElement.",e]},REUSED_ATTRS:function(e){return["Attrs objects may only be reused if they are truly static, as a perf optimization. Mutating & reusing them will have no effect on the DOM due to 0 diff.",e]},ADJACENT_TEXT:function(e,n,t){return["Adjacent text nodes will be merged. Consider concatentating them yourself in the template for improved perf.",e,n,t]},ARRAY_FLATTENED:function(e,n){return["Arrays within templates will be flattened. When they are leading or trailing, it's easy and more performant to just .concat() them in the template.",e,n]},ALREADY_HYDRATED:function(e){return["A child view failed to mount because it was already hydrated. Make sure not to invoke vm.redraw() or vm.update() on unmounted views.",e]},ATTACH_IMPLICIT_TBODY:function(e,n){return["<table><tr> was detected in the vtree, but the DOM will be <table><tbody><tr> after HTML's implicit parsing. You should create the <tbody> vnode explicitly to avoid SSR/attach() failures.",e,n]}},Ie=1,Me=2,Oe=4,Le=8,Ye={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,order:!0,lineClamp:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ue=[],He={},je=e,Ve=1,Fe=2,Pe=z(T,function(e,n){return n[e.idx+1]},M,"lftSib","lftNode","rgtSib","rgtNode",O),Ge=z(function(e){return e.previousSibling},function(e,n){return n[e.idx-1]},O,"rgtSib","rgtNode","lftSib","lftNode",M),We=null,ze=Z.prototype={constructor:Z,_diff:null,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,onevent:e,refs:null,render:null,mount:function(e,n){return Se.mutations&&We.start(),n?(I({el:e,flags:0}),this._redraw(null,null,!1),e.nodeName.toLowerCase()!==this.node.tag?(W(this.node),M(e.parentNode,this.node.el,e),e.parentNode.removeChild(e)):M(e.parentNode,W(this.node,e),e)):(this._redraw(null,null),e&&M(e,this.node.el)),e&&x(this),Se.mutations&&console.log(We.end()),this},unmount:function(e){Ne(this._stream)&&Re(this._stream);var n=this.node;C(n.el.parentNode,n.el),e||x(this)},config:function(e){e.init&&(this.init=e.init),e.diff&&(this.diff=e.diff),e.onevent&&(this.onevent=e.onevent),e.hooks&&(this.hooks=l(this.hooks||{},e.hooks)),e.onemit&&(this.onemit=l(this.onemit||{},e.onemit))},parent:function(){return y(this.node.parent)},root:function(){for(var e=this.node;e.parent;)e=e.parent;return e.vm},redraw:function(e){Se.syncRedraw&&(e=!0);return e?this._redraw(null,null,h(this)):this._redrawAsync(),this},update:function(e,n){Se.syncRedraw&&(n=!0);return n?this._update(e,null,null,h(this)):this._updateAsync(e),this},_update:function(e,n,t,r){return null!=e&&this.data!==e&&(_("DATA_REPLACED",[this,this.data,e]),N(this.hooks,"willUpdate",this,e),this.data=e,Ne(this._stream)&&Re(this._stream),Ne(e)&&(this._stream=g(e,this))),this._redraw(n,t,r)},_redraw:function(e,n,t){var r=null==e,l=this.node&&this.node.el&&this.node.el.parentNode;r&&this.node&&this.node.el&&!this.node.el.parentNode&&_("UNMOUNTED_REDRAW",[this]);var i,u,s=this.node;if(null!=this.diff&&(i=this._diff,this._diff=u=this.diff(this,this.data),null!=s)){var f=Ee(i)?a:o;if(i===u||f(i,u))return Q(this,s,e,n)}l&&N(this.hooks,"willRedraw",this,this.data);var d=this.render.call(this,this,this.data,i,u);if(d===s)return Q(this,s,e,n);if(this.refs=null,null!=this.key&&d.key!==this.key&&(d.key=this.key),this.node=d,e?(k(d,e,n,this),e.body[n]=d):s&&s.parent?(k(d,s.parent,s.idx,this),s.parent.body[s.idx]=d):k(d,null,null,this),!1!==t)if(s)if(s.tag!==d.tag||s.key!==d.key){s.vm=d.vm=null;var c=s.el.parentNode,h=T(s.el);C(c,s.el),M(c,W(d),h),s.el=d.el,d.vm=this}else J(d,s);else W(d);return l&&N(this.hooks,"didRedraw",this,this.data),r&&l&&x(this),this},_redrawAsync:null,_updateAsync:null},Be="http://www.w3.org/2000/svg";ne.prototype={constructor:ne,type:pe,view:null,data:null,key:null,opts:null},te.prototype={constructor:te,type:me,vm:null};var Ke={config:function(e){je=e.onevent||je,e.onemit&&function(e){l(He,e)}(e.onemit),e.stream&&function(e){Ne=e.is,xe=e.val,Te=e.sub,Re=e.unsub}(e.stream)},ViewModel:Z,VNode:p,createView:P,defineElement:ee,defineSvgElement:function(e,n,t,r){var l=ee(e,n,t,r);return l.ns=Be,l},defineText:m,defineComment:function(e){var n=new p;return n.type=ye,n.body=e,n},defineView:function(e,n,t,r){return new ne(e,n,t,r)},injectView:function(e){return new te(e)},injectElement:function(e){var n=new p;return n.type=he,n.el=n.key=e,n},lazyList:function(e,n){var t=e.length,r={items:e,length:t,key:function(t){return n.key(e[t],t)},diff:function(t,r){var l=n.diff(e[t],t);if(null==r)return l;var i=r._diff;return(l===i||Ee(i)?a(l,i):o(l,i))||l},tpl:function(t){return n.tpl(e[t],t)},map:function(e){return n.tpl=e,r},body:function(e){for(var n=Array(t),l=0;l<t;l++){var i=r.tpl(l);i._diff=r.diff(l),n[l]=i,k(i,e,l)}e.body=n}};return r},FIXED_BODY:Me,DEEP_REMOVE:Ie,KEYED_LIST:Oe,LAZY_LIST:Le};Ae.patch=function(e,n){!function(e,n,t){if(null!=n.type){if(null!=e.vm)return;k(n,e.parent,e.idx,null),e.parent.body[e.idx]=n,J(n,e),t&&c(n),x(y(n))}else{var r=Object.create(e);r.attrs=l({},e.attrs);var i=l(e.attrs,n);if(null!=e._class){var o=i.class;i.class=null!=o&&""!==o?e._class+" "+o:e._class}F(e,r),t&&c(e)}}(this,e,n)},ze.emit=function(e){var n=this,t=n,r=i(arguments,1).concat(t,t.data);do{var l=n.onemit,o=l?l[e]:null;if(o){o.apply(n,r);break}}while(n=n.parent());He[e]&&He[e].apply(n,r)},ze.onemit=null,ze.body=function(){return re(this.node,[])},Ke.defineElementSpread=le,Ke.defineSvgElementSpread=function(){var e=le.apply(null,arguments);return e.ns=Be,e},ze._stream=null;var Xe={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},$e=".innerHTML";return ze.attach=function(e){return null==this.node&&this._redraw(null,null,!1),ie(this.node,e),this},ze.html=function(e){return null==this.node&&this._redraw(null,null,!1),ce(this.node,e)},Ae.html=function(e){return ce(this,e)},Ke.DEVMODE=Se,Ke});