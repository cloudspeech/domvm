// https://github.com/leeoniya/domvm (2.x-dev, server)
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.domvm=e()}(this,function(){"use strict";function n(){}function e(n){return null!=n}function t(n){return null!=n&&n.constructor===Object}function r(n,e,t,r){n.splice.apply(n,[t,r].concat(e))}function l(n){var e=typeof n;return"string"===e||"number"===e}function o(n){return"function"==typeof n}function u(n){return"object"==typeof n&&o(n.then)}function i(n){for(var e=arguments,t=1;t<e.length;t++)for(var r in e[t])n[r]=e[t][r];return n}function a(n,e,t){for(var r;r=e.shift();)0===e.length?n[r]=t:n[r]=n=n[r]||{}}function f(n,e){for(var t=[],r=e;r<n.length;r++)t.push(n[r]);return t}function s(n,e){for(var t in n)if(n[t]!==e[t])return!1;return!0}function d(n,e){var t=n.length;if(e.length!==t)return!1;for(var r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}function c(n){function e(){t=0,n.apply(r,l)}if(!Jn)return n;var t,r,l;return function(){r=this,l=arguments,t||(t=Jn(e))}}function v(n,e,t){return function(){return n.apply(t,e)}}function y(n,e,t,r){return function(l,u){return void 0!==l&&l!==n&&(n=l,!1!==u&&o(e)&&e.apply(t,r)),n}}function p(n,e){var t,r=0,l=n.length-1;if(l<=2147483647)for(;r<=l;){if(t=r+l>>1,n[t].key===e)return t;n[t].key<e?r=t+1:l=t-1}else for(;r<=l;){if(t=Math.floor((r+l)/2),n[t].key===e)return t;n[t].key<e?r=t+1:l=t-1}return-1}function h(n){return"o"===n[0]&&"n"===n[1]}function m(n){return"_"===n[0]}function b(n){return"style"===n}function k(n){n&&n.el&&n.el.offsetHeight}function w(n,e){switch(e){case"value":case"checked":case"selected":return!0}return!1}function g(n){for(n=n||Qn;null==n.vm&&n.parent;)n=n.parent;return n.vm}function _(n,e){return isNaN(e)||ee[n]?e:e+"px"}function x(n){var e=te[n];if(null==e){var t,r,l,o;for(te[n]=e={tag:(t=n.match(/^[-\w]+/))?t[0]:"div",id:(r=n.match(/#([-\w]+)/))?r[1]:null,class:(l=n.match(/\.([-\w.]+)/))?l[1].replace(/\./g," "):null,attrs:null};o=re.exec(n);)null==e.attrs&&(e.attrs={}),e.attrs[o[1]]=o[2]||""}return e}function C(n){le=n.is,oe=n.val,ue=n.sub,ie=n.unsub}function N(n,e){var t=ue(n,function(n){t&&(null!=e.node&&e.redraw(),ie(t))});return oe(n)}function S(n,e){var t=(n.attrs||Qn).style,r=e?(e.attrs||Qn).style:null;if(null==t||l(t))n.el.style.cssText=t;else{for(var o in t){var u=t[o];le(u)&&(u=N(u,g(n))),(null==r||null!=u&&u!==r[o])&&(n.el.style[o]=_(o,u))}if(r)for(var i in r)null==t[i]&&(n.el.style[i]="")}}function A(n,e,t,r,l){if(!n)return e(t,r);l?k(t.parent)&&e(t,r):ae.push([e,t,r])}function E(n,e,t,r){var l=e.hooks[n];if(l){var o="d"===n[0]&&"i"===n[1]&&"d"===n[2];return ne(l)?l.map(function(n){return A(o,n,e,t)}):A(o,l,e,t,r)}}function R(){}function I(n,t,r,l){var o=new R;o.type=Yn,e(l)&&(o.flags=l),o.attrs=t;var u=x(n);if(o.tag=u.tag,u.id||u.class||u.attrs){var i=o.attrs||{};if(u.id&&!e(i.id)&&(i.id=u.id),u.class&&(o._class=u.class,i.class=u.class+(e(i.class)?" "+i.class:"")),u.attrs)for(var a in u.attrs)e(i[a])||(i[a]=u.attrs[a]);o.attrs=i}var f=o.attrs;return e(f)&&(e(f._key)&&(o.key=f._key),e(f._ref)&&(o.ref=f._ref),e(f._hooks)&&(o.hooks=f._hooks),e(f._raw)&&(o.raw=f._raw),e(f._data)&&(o.data=f._data),e(f._flags)&&(o.flags=f._flags),e(o.key)||(e(o.ref)?o.key=o.ref:e(f.id)?o.key=f.id:e(f.name)&&(o.key=f.name))),null!=r&&(o.body=r),o}function M(n){for(;null==n._node;)n=n.parentNode;return n._node}function T(n,e){return null!=e?ve.createElementNS(e,n):ve.createElement(n)}function V(n){return ve.createTextNode(n)}function j(n){return ve.createComment(n)}function L(n){return n.nextSibling}function H(n){return n.previousSibling}function O(n){var e=n.hooks,t=n.vm;t&&t.hooks&&E("willUnmount",t);var r=e&&E("willRemove",n);if((n.flags&de)===de&&ne(n.body))for(var l=0;l<n.body.length;l++)O(n.body[l]);return r}function D(n,e,t){var r=e._node,l=r.hooks,o=r.vm;if((r.flags&de)===de&&ne(r.body))for(var u=0;u<r.body.length;u++)D(e,r.body[u].el);n.removeChild(e),l&&E("didRemove",r,null,t),o&&o.hooks&&E("didUnmount",o,null,t)}function z(n,e){var t=e._node,r=(t.hooks,O(t));null!=r&&u(r)?r.then(v(D,[n,e,!0])):D(n,e)}function F(n){var e=n.el;if(0==(n.flags&de))e.textContent=null;else for(;e.firstChild;)z(e,e.firstChild)}function U(n,e,t){var r=e._node,l=r.hooks,o=null!=e.parentNode,u=(e===t||!o)&&r.vm;u&&u.hooks&&E("willMount",u),l&&E(o?"willReinsert":"willInsert",r),n.insertBefore(e,t),l&&E(o?"didReinsert":"didInsert",r),u&&u.hooks&&E("didMount",u)}function P(n,e,t){U(n,e,t?L(t):null)}function q(n){i(ye,n)}function B(n,e,t){n[e]=t}function G(n,e,t){var r=M(n.target),l=g(r),o=e.apply(null,t.concat(n,r,l));ye.onevent.apply(null,[n,r,l].concat(t)),!1===o&&(n.preventDefault(),n.stopPropagation())}function Y(n,e){return function(t){G(t,n,e)}}function $(n){return function(e){for(var t in n)if(e.target.matches(t)){var r=n[t],l=ne(r);G(e,l?r[0]:r,l?r.slice(1):[])}}}function K(n,e,t,r){if(t!==r){var l=n.el;ne(t)?(null==r||!d(t,r))&&B(l,e,Y(t[0],t.slice(1))):o(t)&&t!==r?B(l,e,Y(t,[])):B(l,e,$(t))}}function W(n,e,t){t?n.el[e]="":n.el.removeAttribute(e)}function X(n,e,t,r){var l=n.el;null==t?W(n,e):null!=n.ns?l.setAttribute(e,t):"class"===e?l.className=t:"id"===e||"boolean"==typeof t||r?l[e]=t:"."===e[0]?l[e.substr(1)]=t:l.setAttribute(e,t)}function Z(n,e){var t=n.attrs||Qn,r=e.attrs||Qn;if(t===r);else{for(var l in t){var o=t[l],u=w(n.tag,l),i=u?n.el[l]:r[l];le(o)&&(t[l]=o=N(o,g(n))),o===i||(b(l)?S(n,e):m(l)||(h(l)?K(n,l,o,i):X(n,l,o,u)))}for(var l in r)!(l in t)&&!m(l)&&W(n,l,w(n.tag,l)||h(l))}}function J(n,e,t,r){if(n.type===Wn)e=n.model,t=n.key,r=n.opts,n=n.view;else if(n.prototype._isClass)return new n(e,t,r);return new gn(n,e,t,r)}function Q(n){var e=n.attrs;for(var t in e){var r=e[t],l=w(n.tag,t);le(r)&&(e[t]=r=N(r,g(n))),b(t)?S(n):m(t)||(h(t)?K(n,t,r):null!=r&&X(n,t,r,l))}}function nn(n){for(var e=0;e<n.body.length;e++){var t=n.body[e],r=t.type;if(r<=Kn)U(n.el,en(t));else if(r===Wn)r=(l=J(t.view,t.model,t.key,t.opts)._redraw(n,e,!1)).node.type,U(n.el,en(l.node));else if(r===Xn){var l=t.vm;l._redraw(n,e),r=l.node.type,U(n.el,l.node.el)}}}function en(n,e){return null==n.el&&(n.type===Yn?(n.el=e||T(n.tag,n.ns),null!=n.attrs&&Q(n),ne(n.body)?nn(n):null!=n.body&&""!==n.body&&(n.raw?n.el.innerHTML=n.body:n.el.textContent=n.body)):n.type===$n?n.el=e||V(n.body):n.type===Kn&&(n.el=e||j(n.body))),n.el._node=n,n.el}function tn(n,e){return e[n.idx+1]}function rn(n,e){return e[n.idx-1]}function ln(n){return n.parent}function on(n,e,t,r){var l=H(t),o=L(r);return n(l,o),{lftSib:l?L(l):e.firstChild,rgtSib:o?H(o):e.lastChild}}function un(n,e,t,r,l){var o=l.idx===t.idx+1,u=!o&&e._node===l,i=!!o||r._node===t;return u||i?on(function(t,l){i&&U(n,r,e),u&&U(n,e,l)},n,e,r):null}function an(n,e,t,r){return on(function(t,l){for(var o,u=e;u!==l;u=L(u)){e=o=u;for(var i=L(u);i!==l;i=L(i))r(o,i)>0&&(o=i);o!==u&&(U(n,o,e),u=o)}},n,e,t)}function fn(n,e){return n._node.idx-e._node.idx}function sn(n,e){var t,r,l,o,u=n.el,i=n.body,a=e.body,f=i[0],s=i[i.length-1],d=(a[0]||Qn).el,c=(a[a.length-1]||Qn).el;n:for(;;){for(;;){if(d){if(null==(l=d._node)){d=L(d);continue}if(ln(l)!==n){r=L(d),null!=l.vm?l.vm.unmount(!0):z(u,d),d=r;continue}}if(null==f)break n;if(null==f.el)U(u,en(f),d),f=tn(f,i);else{if(f.el!==d)break;f=tn(f,i),d=L(d)}}for(;;){if(c){if(null==(o=c._node)){c=H(c);continue}if(ln(o)!==n){r=H(c),null!=o.vm?o.vm.unmount(!0):z(u,c),c=r;continue}}if(s===f)break n;if(null==s.el)P(u,en(s),c),s=rn(s,i);else{if(s.el!==c)break;s=rn(s,i),c=H(c)}}(t=un(u,d,f,c,s))?(d=t.lftSib,c=t.rgtSib):(d=(t=an(u,d,c,fn)).lftSib,c=t.rgtSib)}}function dn(n,e,t,r){for(;t<e.length;t++){var l=e[t];if(n.type===Wn&&null!=l.vm){var o=l.vm;if(o.view===n.view&&o.key===n.key)return l}if(l.el._node===l&&n.tag===l.tag&&n.type===l.type&&n.vm===l.vm){if(n.key===l.key)return l;if(null==l.key)return l}}return null}function cn(n,e){var t=p(e,n.key);return t>-1?e[t]:null}function vn(n,e,t){e.hooks&&E("willRecycle",e,n);var r=n.el=e.el,l=e.body,o=n.body;if(r._node=n,n.type!==$n||o===l){null==n.attrs&&null==e.attrs||Z(n,e);var u=ne(l),i=ne(o);u?i?pn(n,e,t):o!==l&&(null!=o?n.raw?r.innerHTML=o:r.textContent=o:F(e)):i?(F(e),nn(n)):o!==l&&(n.raw?r.innerHTML=o:e.raw?r.textContent=o:r.firstChild?r.firstChild.nodeValue=o:r.textContent=o),e.hooks&&E("didRecycle",e,n)}else r.nodeValue=o}function yn(n,e){return n.key>e.key?1:n.key<e.key?-1:0}function pn(n,e,t){var r=n.body,l=r.length,o=e.type===Yn&&0==(e.flags&se);if(o&&0===l)F(e);else{var u=(e.flags&ce)===ce;if(u){(i=e.body.slice()).sort(yn);a=cn}else var i=e.body,a=dn;for(var f,s=0,d=0;d<l;d++){var c=r[d],v=c.type;if(v<=Kn)(f=a(c,i,s))&&vn(c,f);else if(v===Wn){if(f=a(c,i,s))y=f.vm._update(c.model,n,d);else var y=J(c.view,c.model,c.key,c.opts)._redraw(n,d,!1);v=y.node.type}else v===Xn&&(v=(y=c.vm._update(c.model,n,d)).node.type);u||null==f||f.idx!==s||s++}o&&sn(n,e)}}function hn(n){var e=new R;return e.type=$n,e.body=n,e}function mn(n,e,t){a(n,["refs"].concat(e.split(".")),t)}function bn(n){for(;n=n.parent;)n.flags|=de}function kn(n,e,t,r){n.type!==Xn&&n.type!==Wn&&(n.parent=e,n.idx=t,n.vm=r,null!=n.ref&&mn(g(n),n.ref,n),(n.hooks&&n.hooks.willRemove||r&&r.hooks&&r.hooks.willUnmount)&&bn(n),ne(n.body)?wn(n):le(n.body)&&(n.body=N(n.body,g(n))))}function wn(n){for(var e=n.body,t=0;t<e.length;t++){var l=e[t];!1===l||null==l?e.splice(t--,1):ne(l)?r(e,l,t--,1):(null==l.type&&(e[t]=l=hn(""+l)),l.type===$n?null==l.body||""===l.body?e.splice(t--,1):t>0&&e[t-1].type===$n?(e[t-1].body+=l.body,e.splice(t--,1)):kn(l,n,t,null):kn(l,n,t,null))}}function gn(n,e,t,r){var l=this;if(l.view=n,l.model=e,l.key=null==t?e:t,n.prototype._isClass){var u=l.diff;null!=u&&u!==pe.diff&&(l.diff=pe.diff.bind(l),l.diff(u))}else{var a=n.call(l,l,e,t,r);o(a)?l.render=a:(a.diff&&(l.diff(a.diff),delete a.diff),i(l,a))}r&&(l.opts=r,r.hooks&&l.hook(r.hooks),r.diff&&l.diff(r.diff)),l._redrawAsync=c(function(n){return l._redraw()}),l._updateAsync=c(function(n){return l._update(n)});var f=l.hooks;f&&f.didInit&&f.didInit.call(l,l,e,t,r)}function _n(n){if(ae.length){k(n.node);for(var e;e=ae.shift();)e[0](e[1],e[2])}}function xn(n,e){var t=this;return e?(F({el:n,flags:0}),t._redraw(null,null,!1),n.nodeName.toLowerCase()!==t.node.tag?(en(t.node),U(n.parentNode,t.node.el,n),n.parentNode.removeChild(n)):U(n.parentNode,en(t.node,n),n)):(t._redraw(null,null),n&&U(n,t.node.el)),n&&_n(t),t}function Cn(n){var e=this,t=e.node;z(t.el.parentNode,t.el),n||_n(e)}function Nn(n,e,t){var r=null==n,l=this,o=l.node&&l.node.el&&l.node.el.parentNode,u=l.node;if(o&&null!=l._diff&&l._diff())return u&&n&&(n.body[e]=u,u.idx=e,u.parent=n),l;o&&l.hooks&&E("willRedraw",l),l.refs=null;var i=l.render.call(l,l,l.model,l.key);if(!1!==l.key&&null!=l.key&&i.key!==l.key&&(i.key=l.key),l.node=i,n?(kn(i,n,e,l),n.body[e]=i):u&&u.parent?(kn(i,u.parent,u.idx,l),u.parent.body[u.idx]=i):kn(i,null,null,l),!1!==t)if(u)if(u.tag!==i.tag){u.vm=i.vm=null;var a=u.el.parentNode,f=L(u.el);z(a,u.el),U(a,en(i),f),u.el=i.el,i.vm=l}else vn(i,u,r);else en(i);return o&&l.hooks&&E("didRedraw",l),r&&o&&_n(l),l}function Sn(n,e,t,r){var l=this;return null!=n&&l.model!==n&&(l.hooks&&E("willUpdate",l,n),l.model=n),l._redraw(e,t,r)}function An(n,e,r,l){var o,u;return null==r?t(e)?o=e:u=e:(o=e,u=r),I(n,o,u,l)}function En(n,e,t,r){var l=An(n,e,t,r);return l.ns=he,l}function Rn(n){var e=new R;return e.type=Kn,e.body=n,e}function In(n,e,t,r){this.view=n,this.model=e,this.key=null==t?e:t,this.opts=r}function Mn(n,e,t,r){return new In(n,e,t,r)}function Tn(n){this.vm=n}function Vn(n){return new Tn(n)}function jn(n){var e=new R;return e.type=Yn,e.el=e.key=n,e}function Ln(n,e){if(null!=e.type){if(null!=n.vm)return;kn(e,n.parent,n.idx,null),n.parent.body[n.idx]=e,vn(e,n),_n(g(e))}else{var t=Object.create(n);t.attrs=i({},n.attrs);var r=i(n.attrs,e);if(null!=n._class){var l=r.class;r.class=null!=l&&""!==l?n._class+" "+l:n._class}Z(n,t)}}function Hn(n){var e=arguments,t=this;do{var r=t.events,l=r?r[n]:null;if(l){l.apply(null,f(e,1));break}}while(t=t.parent())}function On(n,e){var t=this;if(null==t.events&&(t.events={}),l(n))t.events[n]=e;else{var r=n;for(var n in r)t.on(n,r[n])}}function Dn(n,e){var t=n.body;if(ne(t))for(var r=0;r<t.length;r++){var l=t[r];null!=l.vm?e.push(l.vm):Dn(l,e)}return e}function zn(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Fn(n){var e="";for(var t in n)null!=n[t]&&(e+=zn(t)+": "+_(t,n[t])+"; ");return e}function Un(n){return null==n?"":""+n}function Pn(n){n=Un(n);for(var e=0,t="";e<n.length;e++)switch(n[e]){case"&":t+="&amp;";break;case"<":t+="&lt;";break;case">":t+="&gt;";break;default:t+=n[e]}return t}function qn(n){n=Un(n);for(var e=0,t="";e<n.length;e++)t+='"'===n[e]?"&quot;":n[e];return t}function Bn(n,e){for(var t="",r=0;r<n.length;r++)t+=Gn(n[r],e);return t}function Gn(n,e){var t,r;switch(n.type){case Wn:t=J(n.view,n.model,n.key,n.opts).html(e);break;case Xn:t=n.vm.html();break;case Yn:if(null!=n.el&&null==n.tag){t=n.el.outerHTML;break}var l="";if(l+="<"+n.tag,null!=n.attrs){for(var o in n.attrs)if(!(h(o)||"."===o[0]||"_"===o[0]||!1===e&&w(n.tag,o))){var u=n.attrs[o];"style"!==o||null==u?!0===u?l+=" "+Pn(o)+'=""':!1===u||null!=u&&(l+=" "+Pn(o)+'="'+qn(u)+'"'):r="object"==typeof u?Fn(u):u}null!=r&&(l+=' style="'+qn(r.trim())+'"')}if(null==n.body&&null!=n.ns&&"svg"!==n.tag)return l+"/>";l+=">",be[n.tag]||(ne(n.body)?l+=Bn(n.body,e):l+=n.raw?n.body:Pn(n.body),l+="</"+n.tag+">"),t=l;break;case $n:t=Pn(n.body);break;case Kn:t="\x3c!--"+Pn(n.body)+"--\x3e"}return t}var Yn=1,$n=2,Kn=3,Wn=4,Xn=5,Zn="undefined"!=typeof window,Jn=(Zn?window:{}).requestAnimationFrame,Qn={},ne=Array.isArray,ee={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,columnCount:!0,counterIncrement:!0,flex:!0,flexGrow:!0,flexOrder:!0,flexPositive:!0,flexShrink:!0,float:!0,fontWeight:!0,gridColumn:!0,lineHeight:!0,lineClamp:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,transform:!0,transformOrigin:!0,widows:!0,zIndex:!0,zoom:!0},te={},re=/\[(\w+)(?:=(\w+))?\]/g,le=function(){return!1},oe=null,ue=null,ie=null,ae=[],fe=R.prototype={constructor:R,type:null,vm:null,key:null,ref:null,data:null,hooks:null,raw:!1,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,idx:null,parent:null},se=1,de=2,ce=4,ve=Zn?document:null,ye={onevent:n},pe=gn.prototype={constructor:gn,_isClass:!1,view:null,key:null,model:null,opts:null,node:null,hooks:null,render:null,parent:function(){return g(this.node.parent)},root:function(){for(var n=this.node;n.parent;)n=n.parent;return n.vm},api:null,refs:null,mount:xn,unmount:Cn,redraw:function(n){var e=this;return n?e._redraw():e._redrawAsync(),e},update:function(n,e){var t=this;return e?t._update(n):t._updateAsync(n),t},_update:Sn,_redraw:Nn,_redrawAsync:null,_updateAsync:null,hook:function(n){this.hooks=this.hooks||i({},this.hooks,n)}},he="http://www.w3.org/2000/svg";In.prototype={constructor:In,type:Wn,view:null,model:null,key:null,opts:null},Tn.prototype={constructor:Tn,type:Xn,vm:null};var me={config:q,ViewModel:gn,VNode:R,createView:J,defineElement:An,defineSvgElement:En,defineText:hn,defineComment:Rn,defineView:Mn,injectView:Vn,injectElement:jn,FIXED_BODY:se,DEEP_REMOVE:de,KEYED_LIST:ce};pe._diff=null,pe.diff=function(n){var e=this;if(o(n))t=n;else var t=n.vals,r=n.then;var l=t.call(e,e,e.model,e.key,e.opts),u=ne(l)?d:s;e._diff=function(){var n=t.call(e,e,e.model,e.key,e.opts),o=l===n||u(l,n);return o||(null!=r&&!1===r.call(e,e,l,n)&&(o=!0),l=n),o}},fe.patch=function(n){return Ln(this,n)},pe.events=null,pe.emit=Hn,pe.on=On,pe.body=function(){return Dn(this.node,[])},"undefined"!=typeof flyd&&C({is:function(n){return flyd.isStream(n)},val:function(n){return n()},sub:function(n,e){return flyd.on(e,n)},unsub:function(n){return n.end(!0)}}),me.streamCfg=C,me.prop=y,pe.html=function(n){var e=this;return null==e.node&&e._redraw(null,null,!1),Gn(e.node,n)},fe.html=function(n){return Gn(this,n)};var be={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};return me});
//# sourceMappingURL=domvm.server.min.js.map
